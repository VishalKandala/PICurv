<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PICurv: postprocessing_kernels.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PICurv
   &#160;<span id="projectnumber">0.1.0</span>
   </div>
   <div id="projectbrief">A Parallel Particle-In-Cell Solver for Curvilinear LES</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('postprocessing__kernels_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">postprocessing_kernels.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="postprocessing__kernels_8h_source.html">postprocessing_kernels.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for postprocessing_kernels.c:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="postprocessing__kernels_8c__incl.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
</div>
<p><a href="postprocessing__kernels_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="postprocessing__kernels_8c.html#ae60511a9aa5cbf216a00a1bb81006bc5">__FUNCT__</a>&#160;&#160;&#160;&quot;DimensionalizeField&quot;</td></tr>
<tr class="separator:ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="postprocessing__kernels_8c.html#ae60511a9aa5cbf216a00a1bb81006bc5">__FUNCT__</a>&#160;&#160;&#160;&quot;DimensionalizeAllLoadedFields&quot;</td></tr>
<tr class="separator:ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="postprocessing__kernels_8c.html#ae60511a9aa5cbf216a00a1bb81006bc5">__FUNCT__</a>&#160;&#160;&#160;&quot;ComputeNodalAverage&quot;</td></tr>
<tr class="separator:ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="postprocessing__kernels_8c.html#ae60511a9aa5cbf216a00a1bb81006bc5">__FUNCT__</a>&#160;&#160;&#160;&quot;ComputeQCriterion&quot;</td></tr>
<tr class="separator:ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="postprocessing__kernels_8c.html#ae60511a9aa5cbf216a00a1bb81006bc5">__FUNCT__</a>&#160;&#160;&#160;&quot;NormalizeRelativeField&quot;</td></tr>
<tr class="separator:ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="postprocessing__kernels_8c.html#ae60511a9aa5cbf216a00a1bb81006bc5">__FUNCT__</a>&#160;&#160;&#160;&quot;ComputeSpecificKE&quot;</td></tr>
<tr class="separator:ae60511a9aa5cbf216a00a1bb81006bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ab72ef98f3a415dddd8e609e95a1aeac6"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="postprocessing__kernels_8c.html#ab72ef98f3a415dddd8e609e95a1aeac6">DimensionalizeField</a> (<a class="el" href="variables_8h.html#structUserCtx">UserCtx</a> *user, const char *field_name)</td></tr>
<tr class="memdesc:ab72ef98f3a415dddd8e609e95a1aeac6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Scales a specified field from non-dimensional to dimensional units in-place.  <a href="postprocessing__kernels_8c.html#ab72ef98f3a415dddd8e609e95a1aeac6">More...</a><br /></td></tr>
<tr class="separator:ab72ef98f3a415dddd8e609e95a1aeac6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac5e15eee2694bd1b1dfc8a62d4393b48"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="postprocessing__kernels_8c.html#ac5e15eee2694bd1b1dfc8a62d4393b48">DimensionalizeAllLoadedFields</a> (<a class="el" href="variables_8h.html#structUserCtx">UserCtx</a> *user)</td></tr>
<tr class="memdesc:ac5e15eee2694bd1b1dfc8a62d4393b48"><td class="mdescLeft">&#160;</td><td class="mdescRight">Orchestrates the dimensionalization of all relevant fields loaded from a file.  <a href="postprocessing__kernels_8c.html#ac5e15eee2694bd1b1dfc8a62d4393b48">More...</a><br /></td></tr>
<tr class="separator:ac5e15eee2694bd1b1dfc8a62d4393b48"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad5b0c0f1721b13944b83a57f2471cd02"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="postprocessing__kernels_8c.html#ad5b0c0f1721b13944b83a57f2471cd02">ComputeNodalAverage</a> (<a class="el" href="variables_8h.html#structUserCtx">UserCtx</a> *user, const char *in_field_name, const char *out_field_name)</td></tr>
<tr class="memdesc:ad5b0c0f1721b13944b83a57f2471cd02"><td class="mdescLeft">&#160;</td><td class="mdescRight">Computes node-centered data by averaging 8 surrounding cell-centered values, exactly replicating the legacy code's indexing and boundary handling.  <a href="postprocessing__kernels_8c.html#ad5b0c0f1721b13944b83a57f2471cd02">More...</a><br /></td></tr>
<tr class="separator:ad5b0c0f1721b13944b83a57f2471cd02"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a303c5afb89d6fdaab3e40f9371d8f1b2"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="postprocessing__kernels_8c.html#a303c5afb89d6fdaab3e40f9371d8f1b2">ComputeQCriterion</a> (<a class="el" href="variables_8h.html#structUserCtx">UserCtx</a> *user)</td></tr>
<tr class="memdesc:a303c5afb89d6fdaab3e40f9371d8f1b2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Computes the Q-Criterion, a scalar value identifying vortex cores.  <a href="postprocessing__kernels_8c.html#a303c5afb89d6fdaab3e40f9371d8f1b2">More...</a><br /></td></tr>
<tr class="separator:a303c5afb89d6fdaab3e40f9371d8f1b2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a86d13bca79c1355ce808509a999a1d88"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="postprocessing__kernels_8c.html#a86d13bca79c1355ce808509a999a1d88">NormalizeRelativeField</a> (<a class="el" href="variables_8h.html#structUserCtx">UserCtx</a> *user, const char *relative_field_name)</td></tr>
<tr class="memdesc:a86d13bca79c1355ce808509a999a1d88"><td class="mdescLeft">&#160;</td><td class="mdescRight">Normalizes a relative field by subtracting a reference value.  <a href="postprocessing__kernels_8c.html#a86d13bca79c1355ce808509a999a1d88">More...</a><br /></td></tr>
<tr class="separator:a86d13bca79c1355ce808509a999a1d88"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a37ee1aa2e642bbfd24a6faf33a92568c"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="postprocessing__kernels_8c.html#a37ee1aa2e642bbfd24a6faf33a92568c">ComputeSpecificKE</a> (<a class="el" href="variables_8h.html#structUserCtx">UserCtx</a> *user, const char *velocity_field, const char *ske_field)</td></tr>
<tr class="memdesc:a37ee1aa2e642bbfd24a6faf33a92568c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Computes the specific kinetic energy (KE per unit mass) for each particle.  <a href="postprocessing__kernels_8c.html#a37ee1aa2e642bbfd24a6faf33a92568c">More...</a><br /></td></tr>
<tr class="separator:a37ee1aa2e642bbfd24a6faf33a92568c"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="ae60511a9aa5cbf216a00a1bb81006bc5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae60511a9aa5cbf216a00a1bb81006bc5">&#9670;&nbsp;</a></span>__FUNCT__ <span class="overload">[1/6]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __FUNCT__&#160;&#160;&#160;&quot;DimensionalizeField&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="postprocessing__kernels_8c_source.html#l00478">478</a> of file <a class="el" href="postprocessing__kernels_8c_source.html">postprocessing_kernels.c</a>.</p>

</div>
</div>
<a id="ae60511a9aa5cbf216a00a1bb81006bc5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae60511a9aa5cbf216a00a1bb81006bc5">&#9670;&nbsp;</a></span>__FUNCT__ <span class="overload">[2/6]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __FUNCT__&#160;&#160;&#160;&quot;DimensionalizeAllLoadedFields&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="postprocessing__kernels_8c_source.html#l00478">478</a> of file <a class="el" href="postprocessing__kernels_8c_source.html">postprocessing_kernels.c</a>.</p>

</div>
</div>
<a id="ae60511a9aa5cbf216a00a1bb81006bc5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae60511a9aa5cbf216a00a1bb81006bc5">&#9670;&nbsp;</a></span>__FUNCT__ <span class="overload">[3/6]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __FUNCT__&#160;&#160;&#160;&quot;ComputeNodalAverage&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="postprocessing__kernels_8c_source.html#l00478">478</a> of file <a class="el" href="postprocessing__kernels_8c_source.html">postprocessing_kernels.c</a>.</p>

</div>
</div>
<a id="ae60511a9aa5cbf216a00a1bb81006bc5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae60511a9aa5cbf216a00a1bb81006bc5">&#9670;&nbsp;</a></span>__FUNCT__ <span class="overload">[4/6]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __FUNCT__&#160;&#160;&#160;&quot;ComputeQCriterion&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="postprocessing__kernels_8c_source.html#l00478">478</a> of file <a class="el" href="postprocessing__kernels_8c_source.html">postprocessing_kernels.c</a>.</p>

</div>
</div>
<a id="ae60511a9aa5cbf216a00a1bb81006bc5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae60511a9aa5cbf216a00a1bb81006bc5">&#9670;&nbsp;</a></span>__FUNCT__ <span class="overload">[5/6]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __FUNCT__&#160;&#160;&#160;&quot;NormalizeRelativeField&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="postprocessing__kernels_8c_source.html#l00478">478</a> of file <a class="el" href="postprocessing__kernels_8c_source.html">postprocessing_kernels.c</a>.</p>

</div>
</div>
<a id="ae60511a9aa5cbf216a00a1bb81006bc5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae60511a9aa5cbf216a00a1bb81006bc5">&#9670;&nbsp;</a></span>__FUNCT__ <span class="overload">[6/6]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __FUNCT__&#160;&#160;&#160;&quot;ComputeSpecificKE&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="postprocessing__kernels_8c_source.html#l00478">478</a> of file <a class="el" href="postprocessing__kernels_8c_source.html">postprocessing_kernels.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="ab72ef98f3a415dddd8e609e95a1aeac6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab72ef98f3a415dddd8e609e95a1aeac6">&#9670;&nbsp;</a></span>DimensionalizeField()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode DimensionalizeField </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>field_name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Scales a specified field from non-dimensional to dimensional units in-place. </p>
<p>This function acts as a dispatcher. It takes the string name of a field, identifies the corresponding PETSc Vec object and the correct physical scaling factor (e.g., U_ref for velocity, P_ref for pressure), and then performs an in-place VecScale operation. It correctly handles the different physical dimensions of Cartesian velocity vs. contravariant volume flux.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">user</td><td>The <a class="el" href="variables_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> containing the PETSc Vecs to be modified. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">field_name</td><td>The case-insensitive string name of the field to dimensionalize (e.g., "Ucat", "P", "Ucont", "Coordinates", "ParticlePosition", "ParticleVelocity"). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode </dd></dl>

<p class="definition">Definition at line <a class="el" href="postprocessing__kernels_8c_source.html#l00020">20</a> of file <a class="el" href="postprocessing__kernels_8c_source.html">postprocessing_kernels.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;{</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;    PetscErrorCode ierr;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    <a class="code" href="variables_8h.html#structSimCtx">SimCtx</a>         *simCtx = user-&gt;<a class="code" href="variables_8h.html#a322702c716e6e140d71515d0b3e111b1">simCtx</a>;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;    Vec            target_vec = NULL;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;    PetscReal      scale_factor = 1.0;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;    <span class="keywordtype">char</span>           field_type[64] = <span class="stringliteral">&quot;Unknown&quot;</span>;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;    PetscBool      is_swarm_field = PETSC_FALSE; <span class="comment">// Flag for special swarm handling</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span>     *swarm_field_name = NULL;    <span class="comment">// Name of the field within the swarm</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160; </div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;    PetscFunctionBeginUser;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;    <a class="code" href="logging_8h.html#ace99f3e207ccb2e46e9b782f9e57732e">PROFILE_FUNCTION_BEGIN</a>;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    <span class="keywordflow">if</span> (!user) SETERRQ(PETSC_COMM_SELF, PETSC_ERR_ARG_NULL, <span class="stringliteral">&quot;UserCtx is NULL.&quot;</span>);</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;    <span class="keywordflow">if</span> (!field_name) SETERRQ(PETSC_COMM_SELF, PETSC_ERR_ARG_NULL, <span class="stringliteral">&quot;field_name is NULL.&quot;</span>);</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160; </div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;    <span class="comment">// --- 1. Identify the target Vec and the correct scaling factor ---</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;    <span class="keywordflow">if</span> (strcasecmp(field_name, <span class="stringliteral">&quot;Ucat&quot;</span>) == 0) {</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        target_vec = user-&gt;<a class="code" href="variables_8h.html#aa1823d873982755996b7335f43732af4">Ucat</a>;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        scale_factor = simCtx-&gt;<a class="code" href="variables_8h.html#aa24a988353f69e0cf76b358d10fd374a">scaling</a>.<a class="code" href="variables_8h.html#aecd5e36365d3d40c5e7e707a93668e92">U_ref</a>;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;        strcpy(field_type, <span class="stringliteral">&quot;Cartesian Velocity (L/T)&quot;</span>);</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcasecmp(field_name, <span class="stringliteral">&quot;Ucont&quot;</span>) == 0) {</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        target_vec = user-&gt;<a class="code" href="variables_8h.html#a69c3a361d1aac3bdc14f971bda57e032">Ucont</a>;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;        scale_factor = simCtx-&gt;<a class="code" href="variables_8h.html#aa24a988353f69e0cf76b358d10fd374a">scaling</a>.<a class="code" href="variables_8h.html#aecd5e36365d3d40c5e7e707a93668e92">U_ref</a> * simCtx-&gt;<a class="code" href="variables_8h.html#aa24a988353f69e0cf76b358d10fd374a">scaling</a>.<a class="code" href="variables_8h.html#a443db716c1f9b5d3046639bd63241a93">L_ref</a> * simCtx-&gt;<a class="code" href="variables_8h.html#aa24a988353f69e0cf76b358d10fd374a">scaling</a>.<a class="code" href="variables_8h.html#a443db716c1f9b5d3046639bd63241a93">L_ref</a>;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        strcpy(field_type, <span class="stringliteral">&quot;Contravariant Volume Flux (L^3/T)&quot;</span>);</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcasecmp(field_name, <span class="stringliteral">&quot;P&quot;</span>) == 0) {</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        target_vec = user-&gt;<a class="code" href="variables_8h.html#a5a73aa2bc6be44bc1ff8847cf0a1b6af">P</a>;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        scale_factor = simCtx-&gt;<a class="code" href="variables_8h.html#aa24a988353f69e0cf76b358d10fd374a">scaling</a>.<a class="code" href="variables_8h.html#ade74d185e7611423c6126ec505309a47">P_ref</a>;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        strcpy(field_type, <span class="stringliteral">&quot;Pressure (M L^-1 T^-2)&quot;</span>);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcasecmp(field_name, <span class="stringliteral">&quot;Coordinates&quot;</span>) == 0) {</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        ierr = DMGetCoordinates(user-&gt;<a class="code" href="variables_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;target_vec); CHKERRQ(ierr);</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        scale_factor = simCtx-&gt;<a class="code" href="variables_8h.html#aa24a988353f69e0cf76b358d10fd374a">scaling</a>.<a class="code" href="variables_8h.html#a443db716c1f9b5d3046639bd63241a93">L_ref</a>;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        strcpy(field_type, <span class="stringliteral">&quot;Grid Coordinates (L)&quot;</span>);</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcasecmp(field_name, <span class="stringliteral">&quot;ParticlePosition&quot;</span>) == 0) {</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        is_swarm_field = PETSC_TRUE;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        swarm_field_name = <span class="stringliteral">&quot;position&quot;</span>;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        scale_factor = simCtx-&gt;<a class="code" href="variables_8h.html#aa24a988353f69e0cf76b358d10fd374a">scaling</a>.<a class="code" href="variables_8h.html#a443db716c1f9b5d3046639bd63241a93">L_ref</a>;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;        strcpy(field_type, <span class="stringliteral">&quot;Particle Position (L)&quot;</span>);</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcasecmp(field_name, <span class="stringliteral">&quot;ParticleVelocity&quot;</span>) == 0) {</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        is_swarm_field = PETSC_TRUE;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        swarm_field_name = <span class="stringliteral">&quot;velocity&quot;</span>;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        scale_factor = simCtx-&gt;<a class="code" href="variables_8h.html#aa24a988353f69e0cf76b358d10fd374a">scaling</a>.<a class="code" href="variables_8h.html#aecd5e36365d3d40c5e7e707a93668e92">U_ref</a>;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;        strcpy(field_type, <span class="stringliteral">&quot;Particle Velocity (L/T)&quot;</span>);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;        <a class="code" href="logging_8h.html#a672ff9c400e2307306b36415d4fefcb9">LOG</a>(<a class="code" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a8f6fe15bfe15104da6d1b360194a5400">LOG_WARNING</a>, <span class="stringliteral">&quot;DimensionalizeField: Unknown or unhandled field_name &#39;%s&#39;. Field will not be scaled.\n&quot;</span>, field_name);</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        <a class="code" href="logging_8h.html#a5fe7257f46131945aacf9a35e9de5874">PROFILE_FUNCTION_END</a>;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;        PetscFunctionReturn(0);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    }</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    </div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;    <span class="comment">// --- 2. Check for trivial scaling ---</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="keywordflow">if</span> (PetscAbsReal(scale_factor - 1.0) &lt; PETSC_MACHINE_EPSILON) {</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        <a class="code" href="logging_8h.html#a672ff9c400e2307306b36415d4fefcb9">LOG</a>(<a class="code" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;DimensionalizeField: Scaling factor for &#39;%s&#39; is 1.0. Skipping operation.\n&quot;</span>, field_name);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;        <a class="code" href="logging_8h.html#a5fe7257f46131945aacf9a35e9de5874">PROFILE_FUNCTION_END</a>;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        PetscFunctionReturn(0);</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;    }</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160; </div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="comment">// --- 3. Perform the in-place scaling operation ---</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;    <a class="code" href="logging_8h.html#a672ff9c400e2307306b36415d4fefcb9">LOG</a>(<a class="code" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;Scaling &#39;%s&#39; field (%s) by factor %.4e.\n&quot;</span>, field_name, field_type, scale_factor);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160; </div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordflow">if</span> (is_swarm_field) {</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;        <span class="comment">// Special handling for DMSwarm fields</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        ierr = DMSwarmCreateGlobalVectorFromField(user-&gt;<a class="code" href="variables_8h.html#a1675749ea3b2429f00405a1ee3203d18">swarm</a>, swarm_field_name, &amp;target_vec); CHKERRQ(ierr);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        ierr = VecScale(target_vec, scale_factor); CHKERRQ(ierr);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;        ierr = DMSwarmDestroyGlobalVectorFromField(user-&gt;<a class="code" href="variables_8h.html#a1675749ea3b2429f00405a1ee3203d18">swarm</a>, swarm_field_name, &amp;target_vec); CHKERRQ(ierr);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;        <span class="comment">// Standard handling for PETSc Vecs</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        <span class="keywordflow">if</span> (target_vec) {</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;            ierr = VecScale(target_vec, scale_factor); CHKERRQ(ierr);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;            SETERRQ(PETSC_COMM_WORLD, PETSC_ERR_ARG_WRONGSTATE, <span class="stringliteral">&quot;Target vector for field &#39;%s&#39; was not found or is NULL.&quot;</span>, field_name);</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        }</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    }</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    </div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    <span class="comment">// --- 4. Post-scaling updates for special cases ---</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    <span class="keywordflow">if</span> (strcasecmp(field_name, <span class="stringliteral">&quot;Coordinates&quot;</span>) == 0) {</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        Vec l_coords;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        ierr = DMGetCoordinates(user-&gt;<a class="code" href="variables_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;target_vec); CHKERRQ(ierr); <span class="comment">// Re-get the global vector</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;        ierr = DMGetCoordinatesLocal(user-&gt;<a class="code" href="variables_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;l_coords); CHKERRQ(ierr);</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        ierr = DMGlobalToLocalBegin(user-&gt;<a class="code" href="variables_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, target_vec, INSERT_VALUES, l_coords); CHKERRQ(ierr);</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;        ierr = DMGlobalToLocalEnd(user-&gt;<a class="code" href="variables_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, target_vec, INSERT_VALUES, l_coords); CHKERRQ(ierr);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    }</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160; </div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <a class="code" href="logging_8h.html#a5fe7257f46131945aacf9a35e9de5874">PROFILE_FUNCTION_END</a>;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    PetscFunctionReturn(0);</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="postprocessing__kernels_8c_ab72ef98f3a415dddd8e609e95a1aeac6_icgraph.svg" width="436" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ac5e15eee2694bd1b1dfc8a62d4393b48"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac5e15eee2694bd1b1dfc8a62d4393b48">&#9670;&nbsp;</a></span>DimensionalizeAllLoadedFields()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode DimensionalizeAllLoadedFields </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Orchestrates the dimensionalization of all relevant fields loaded from a file. </p>
<p>This function is intended to be called in the post-processor immediately after all solver output has been read into memory. It calls <a class="el" href="postprocessing__kernels_8c.html#ab72ef98f3a415dddd8e609e95a1aeac6" title="Scales a specified field from non-dimensional to dimensional units in-place.">DimensionalizeField()</a> for each of the core physical quantities to convert the entire loaded state from non-dimensional to dimensional units, preparing it for analysis and visualization.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">user</td><td>The <a class="el" href="variables_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> containing all the fields to be dimensionalized. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode </dd></dl>

<p class="definition">Definition at line <a class="el" href="postprocessing__kernels_8c_source.html#l00118">118</a> of file <a class="el" href="postprocessing__kernels_8c_source.html">postprocessing_kernels.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;{</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    PetscErrorCode ierr;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;    <a class="code" href="variables_8h.html#structSimCtx">SimCtx</a>         *simCtx = user-&gt;<a class="code" href="variables_8h.html#a322702c716e6e140d71515d0b3e111b1">simCtx</a>;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160; </div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;    PetscFunctionBeginUser;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <a class="code" href="logging_8h.html#ace99f3e207ccb2e46e9b782f9e57732e">PROFILE_FUNCTION_BEGIN</a>;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160; </div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <a class="code" href="logging_8h.html#a672ff9c400e2307306b36415d4fefcb9">LOG</a>(<a class="code" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;--- Converting all loaded fields to dimensional units ---\n&quot;</span>);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160; </div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    <span class="comment">// Scale the grid itself first</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    ierr = <a class="code" href="postprocessing__kernels_8c.html#ab72ef98f3a415dddd8e609e95a1aeac6">DimensionalizeField</a>(user, <span class="stringliteral">&quot;Coordinates&quot;</span>); CHKERRQ(ierr);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160; </div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;    <span class="comment">// Scale primary fluid fields</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    ierr = <a class="code" href="postprocessing__kernels_8c.html#ab72ef98f3a415dddd8e609e95a1aeac6">DimensionalizeField</a>(user, <span class="stringliteral">&quot;Ucat&quot;</span>); CHKERRQ(ierr);</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;    ierr = <a class="code" href="postprocessing__kernels_8c.html#ab72ef98f3a415dddd8e609e95a1aeac6">DimensionalizeField</a>(user, <span class="stringliteral">&quot;Ucont&quot;</span>); CHKERRQ(ierr);</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    ierr = <a class="code" href="postprocessing__kernels_8c.html#ab72ef98f3a415dddd8e609e95a1aeac6">DimensionalizeField</a>(user, <span class="stringliteral">&quot;P&quot;</span>); CHKERRQ(ierr);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160; </div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="comment">// If particles are present, scale their fields</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="keywordflow">if</span> (simCtx-&gt;<a class="code" href="variables_8h.html#a5eedf611da6dd4f59cc65753b777b957">np</a> &gt; 0 &amp;&amp; user-&gt;<a class="code" href="variables_8h.html#a1675749ea3b2429f00405a1ee3203d18">swarm</a>) {</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;        ierr = <a class="code" href="postprocessing__kernels_8c.html#ab72ef98f3a415dddd8e609e95a1aeac6">DimensionalizeField</a>(user, <span class="stringliteral">&quot;ParticlePosition&quot;</span>); CHKERRQ(ierr);</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;        ierr = <a class="code" href="postprocessing__kernels_8c.html#ab72ef98f3a415dddd8e609e95a1aeac6">DimensionalizeField</a>(user, <span class="stringliteral">&quot;ParticleVelocity&quot;</span>); CHKERRQ(ierr);</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;    }</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160; </div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <a class="code" href="logging_8h.html#a672ff9c400e2307306b36415d4fefcb9">LOG</a>(<a class="code" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;--- Field dimensionalization complete ---\n&quot;</span>);</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160; </div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <a class="code" href="logging_8h.html#a5fe7257f46131945aacf9a35e9de5874">PROFILE_FUNCTION_END</a>;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    PetscFunctionReturn(0);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="postprocessing__kernels_8c_ac5e15eee2694bd1b1dfc8a62d4393b48_cgraph.svg" width="436" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="ad5b0c0f1721b13944b83a57f2471cd02"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad5b0c0f1721b13944b83a57f2471cd02">&#9670;&nbsp;</a></span>ComputeNodalAverage()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode ComputeNodalAverage </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>in_field_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>out_field_name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Computes node-centered data by averaging 8 surrounding cell-centered values, exactly replicating the legacy code's indexing and boundary handling. </p>
<p>This kernel uses a stencil that averages the 8 cells from the corner (i,j,k) to (i+1, j+1, k+1) and stores the result at the output node (i,j,k). This matches the legacy code's behavior. It operates on the full range of output nodes necessary for the subsampled grid, preventing zero-padding at the boundaries.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">user</td><td>The <a class="el" href="variables_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a>, providing access to DMs and Vecs. </td></tr>
    <tr><td class="paramname">in_field_name</td><td>The string name of the source Vec (e.g., "P", "Ucat"). </td></tr>
    <tr><td class="paramname">out_field_name</td><td>The string name of the destination Vec (e.g., "P_nodal"). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode </dd></dl>

<p class="definition">Definition at line <a class="el" href="postprocessing__kernels_8c_source.html#l00166">166</a> of file <a class="el" href="postprocessing__kernels_8c_source.html">postprocessing_kernels.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;{</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    PetscErrorCode ierr;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;    Vec            in_vec_local = NULL, out_vec_global = NULL;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;    DM             dm_in = NULL, dm_out = NULL;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    PetscInt       dof = 0;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160; </div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    PetscFunctionBeginUser;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <a class="code" href="logging_8h.html#ace99f3e207ccb2e46e9b782f9e57732e">PROFILE_FUNCTION_BEGIN</a>;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;-&gt; KERNEL: Running ComputeNodalAverage on &#39;%s&#39; -&gt; &#39;%s&#39;.\n&quot;</span>, in_field_name, out_field_name);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160; </div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <span class="comment">// --- 1. Map string names to PETSc objects ---</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="keywordflow">if</span> (strcasecmp(in_field_name, <span class="stringliteral">&quot;P&quot;</span>) == 0)             { in_vec_local = user-&gt;<a class="code" href="variables_8h.html#a95078248cc49ce19d5d05b14e1701888">lP</a>;         dm_in = user-&gt;<a class="code" href="variables_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>;   dof = 1; }</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcasecmp(in_field_name, <span class="stringliteral">&quot;Ucat&quot;</span>) == 0)    { in_vec_local = user-&gt;<a class="code" href="variables_8h.html#ace2eeedc863d73caaf51bb83aa993e44">lUcat</a>;      dm_in = user-&gt;<a class="code" href="variables_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>;  dof = 3; }</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    <span class="comment">// ... (add other fields as needed) ...</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="keywordflow">else</span> SETERRQ(PETSC_COMM_WORLD, PETSC_ERR_ARG_WRONG, <span class="stringliteral">&quot;Unknown input field name for nodal averaging: %s&quot;</span>, in_field_name);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160; </div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="keywordflow">if</span> (strcasecmp(out_field_name, <span class="stringliteral">&quot;P_nodal&quot;</span>) == 0)      { out_vec_global = user-&gt;<a class="code" href="variables_8h.html#a0d09ddf5e31ea3cfcab2c6bbc59b64cd">P_nodal</a>;    dm_out = user-&gt;<a class="code" href="variables_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>; }</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcasecmp(out_field_name, <span class="stringliteral">&quot;Ucat_nodal&quot;</span>) == 0) { out_vec_global = user-&gt;<a class="code" href="variables_8h.html#a585521a5dbb55ae244e34a354ac93e3f">Ucat_nodal</a>; dm_out = user-&gt;<a class="code" href="variables_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>; }</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    <span class="comment">// ... (add other fields as needed) ...</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    <span class="keywordflow">else</span> SETERRQ(PETSC_COMM_WORLD, PETSC_ERR_ARG_WRONG, <span class="stringliteral">&quot;Unknown output field name for nodal averaging: %s&quot;</span>, out_field_name);</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160; </div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    <span class="comment">// --- 2. Ensure Input Data Ghosts are Up-to-Date ---</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    ierr = <a class="code" href="setup_8h.html#ad5f82951adcce74b3d37cb5880acf43a">UpdateLocalGhosts</a>(user, in_field_name); CHKERRQ(ierr);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160; </div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;    <span class="comment">// --- 3. Get DMDA info and array pointers ---</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    DMDALocalInfo info;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    ierr = DMDAGetLocalInfo(dm_out, &amp;info); CHKERRQ(ierr);</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160; </div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordflow">if</span> (dof == 1) { <span class="comment">// --- Scalar Field Averaging ---</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        <span class="keyword">const</span> PetscReal ***l_in_arr;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;        PetscReal       ***g_out_arr;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;        ierr = DMDAVecGetArrayRead(dm_in,in_vec_local, (<span class="keywordtype">void</span>*)&amp;l_in_arr); CHKERRQ(ierr);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;        ierr = DMDAVecGetArray(dm_out,out_vec_global, (<span class="keywordtype">void</span>*)&amp;g_out_arr); CHKERRQ(ierr);</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160; </div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;        <span class="comment">// Loop over the output NODE locations. The loop bounds match the required</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;        <span class="comment">// size of the final subsampled grid.</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        <span class="keywordflow">for</span> (PetscInt k = info.zs; k &lt; info.zs + info.zm - 1; k++) {</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;            <span class="keywordflow">for</span> (PetscInt j = info.ys; j &lt; info.ys + info.ym - 1; j++) {</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                <span class="keywordflow">for</span> (PetscInt i = info.xs; i &lt; info.xs + info.xm - 1; i++) {</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                    g_out_arr[k][j][i] = 0.125 * (l_in_arr[k][j][i]     + l_in_arr[k][j][i+1] +</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                                                  l_in_arr[k][j+1][i]   + l_in_arr[k][j+1][i+1] +</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                                                  l_in_arr[k+1][j][i]   + l_in_arr[k+1][j][i+1] +</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                                                  l_in_arr[k+1][j+1][i] + l_in_arr[k+1][j+1][i+1]);</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                }</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            }</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;        }</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        ierr = DMDAVecRestoreArrayRead(dm_in,in_vec_local, (<span class="keywordtype">void</span>*)&amp;l_in_arr); CHKERRQ(ierr);</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;        ierr = DMDAVecRestoreArray(dm_out,out_vec_global, (<span class="keywordtype">void</span>*)&amp;g_out_arr); CHKERRQ(ierr);</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160; </div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dof == 3) { <span class="comment">// --- Vector Field Averaging ---</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <span class="keyword">const</span> <a class="code" href="variables_8h.html#structCmpnts">Cmpnts</a> ***l_in_arr;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        <a class="code" href="variables_8h.html#structCmpnts">Cmpnts</a>       ***g_out_arr;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;        ierr = DMDAVecGetArrayRead(dm_in,in_vec_local, (<span class="keywordtype">void</span>*)&amp;l_in_arr); CHKERRQ(ierr);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        ierr = DMDAVecGetArray(dm_out,out_vec_global, (<span class="keywordtype">void</span>*)&amp;g_out_arr); CHKERRQ(ierr);</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160; </div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        <span class="keywordflow">for</span> (PetscInt k = info.zs; k &lt; info.zs + info.zm - 1; k++) {</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;            <span class="keywordflow">for</span> (PetscInt j = info.ys; j &lt; info.ys + info.ym - 1; j++) {</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                <span class="keywordflow">for</span> (PetscInt i = info.xs; i &lt; info.xs + info.xm - 1; i++) {</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                    g_out_arr[k][j][i].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = 0.125 * (l_in_arr[k][j][i].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + l_in_arr[k][j][i+1].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> +</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                                                    l_in_arr[k][j+1][i].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + l_in_arr[k][j+1][i+1].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> +</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                                                    l_in_arr[k+1][j][i].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + l_in_arr[k+1][j][i+1].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> +</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                                                    l_in_arr[k+1][j+1][i].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + l_in_arr[k+1][j+1][i+1].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>);</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160; </div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                    g_out_arr[k][j][i].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = 0.125 * (l_in_arr[k][j][i].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + l_in_arr[k][j][i+1].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> +</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                                                    l_in_arr[k][j+1][i].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + l_in_arr[k][j+1][i+1].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> +</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                                                    l_in_arr[k+1][j][i].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + l_in_arr[k+1][j][i+1].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> +</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                                                    l_in_arr[k+1][j+1][i].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + l_in_arr[k+1][j+1][i+1].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>);</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160; </div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                    g_out_arr[k][j][i].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = 0.125 * (l_in_arr[k][j][i].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + l_in_arr[k][j][i+1].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> +</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                                                    l_in_arr[k][j+1][i].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + l_in_arr[k][j+1][i+1].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> +</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                                                    l_in_arr[k+1][j][i].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + l_in_arr[k+1][j][i+1].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> +</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                                                    l_in_arr[k+1][j+1][i].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + l_in_arr[k+1][j+1][i+1].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                }</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            }</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        }</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        ierr = DMDAVecRestoreArrayRead(dm_in,in_vec_local, (<span class="keywordtype">void</span>*)&amp;l_in_arr); CHKERRQ(ierr);</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        ierr = DMDAVecRestoreArray(dm_out,out_vec_global, (<span class="keywordtype">void</span>*)&amp;g_out_arr); CHKERRQ(ierr);</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    }</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <a class="code" href="logging_8h.html#a5fe7257f46131945aacf9a35e9de5874">PROFILE_FUNCTION_END</a>;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    PetscFunctionReturn(0);</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="postprocessing__kernels_8c_ad5b0c0f1721b13944b83a57f2471cd02_cgraph.svg" width="578" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="postprocessing__kernels_8c_ad5b0c0f1721b13944b83a57f2471cd02_icgraph.svg" width="562" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a303c5afb89d6fdaab3e40f9371d8f1b2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a303c5afb89d6fdaab3e40f9371d8f1b2">&#9670;&nbsp;</a></span>ComputeQCriterion()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode ComputeQCriterion </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Computes the Q-Criterion, a scalar value identifying vortex cores. </p>
<p>This function is self-contained. It ensures all its required input data (Ucat and grid metrics) have up-to-date ghost values before proceeding with the calculation. The result is stored in the global vector user-&gt;Qcrit.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">user</td><td>The <a class="el" href="variables_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a>, providing access to all necessary data. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode </dd></dl>

<p class="definition">Definition at line <a class="el" href="postprocessing__kernels_8c_source.html#l00262">262</a> of file <a class="el" href="postprocessing__kernels_8c_source.html">postprocessing_kernels.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;{</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    PetscErrorCode ierr;</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;    DMDALocalInfo  info;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="keyword">const</span> <a class="code" href="variables_8h.html#structCmpnts">Cmpnts</a>   ***lucat, ***lcsi, ***leta, ***lzet;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    <span class="keyword">const</span> PetscReal***laj, ***lnvert;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    PetscReal      ***gq;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160; </div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    PetscFunctionBeginUser;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;    <a class="code" href="logging_8h.html#ace99f3e207ccb2e46e9b782f9e57732e">PROFILE_FUNCTION_BEGIN</a>;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;-&gt; KERNEL: Running ComputeQCriterion.\n&quot;</span>);</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160; </div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="comment">// --- 1. Ensure all required ghost values are up-to-date ---</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    ierr = <a class="code" href="setup_8h.html#ad5f82951adcce74b3d37cb5880acf43a">UpdateLocalGhosts</a>(user, <span class="stringliteral">&quot;Ucat&quot;</span>);  CHKERRQ(ierr);</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;    ierr = <a class="code" href="setup_8h.html#ad5f82951adcce74b3d37cb5880acf43a">UpdateLocalGhosts</a>(user, <span class="stringliteral">&quot;Csi&quot;</span>);   CHKERRQ(ierr);</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    ierr = <a class="code" href="setup_8h.html#ad5f82951adcce74b3d37cb5880acf43a">UpdateLocalGhosts</a>(user, <span class="stringliteral">&quot;Eta&quot;</span>);   CHKERRQ(ierr);</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    ierr = <a class="code" href="setup_8h.html#ad5f82951adcce74b3d37cb5880acf43a">UpdateLocalGhosts</a>(user, <span class="stringliteral">&quot;Zet&quot;</span>);   CHKERRQ(ierr);</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;    ierr = <a class="code" href="setup_8h.html#ad5f82951adcce74b3d37cb5880acf43a">UpdateLocalGhosts</a>(user, <span class="stringliteral">&quot;Aj&quot;</span>);    CHKERRQ(ierr);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;    ierr = <a class="code" href="setup_8h.html#ad5f82951adcce74b3d37cb5880acf43a">UpdateLocalGhosts</a>(user, <span class="stringliteral">&quot;Nvert&quot;</span>); CHKERRQ(ierr);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160; </div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;    <span class="comment">// --- 2. Get DMDA info and array pointers ---</span></div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    ierr = DMDAGetLocalInfo(user-&gt;<a class="code" href="variables_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;info); CHKERRQ(ierr);</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    </div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;    ierr = DMDAVecGetArrayRead(user-&gt;<a class="code" href="variables_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code" href="variables_8h.html#ace2eeedc863d73caaf51bb83aa993e44">lUcat</a>,  (<span class="keywordtype">void</span>*)&amp;lucat);   CHKERRQ(ierr);</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    ierr = DMDAVecGetArrayRead(user-&gt;<a class="code" href="variables_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code" href="variables_8h.html#a9693ebf5c9ea601d5ebaf6d24cc60721">lCsi</a>,   (<span class="keywordtype">void</span>*)&amp;lcsi);    CHKERRQ(ierr);</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    ierr = DMDAVecGetArrayRead(user-&gt;<a class="code" href="variables_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code" href="variables_8h.html#ad4296b10d8eb7b065165582f5cc85897">lEta</a>,   (<span class="keywordtype">void</span>*)&amp;leta);    CHKERRQ(ierr);</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;    ierr = DMDAVecGetArrayRead(user-&gt;<a class="code" href="variables_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code" href="variables_8h.html#a414751d7a391a78834cdce87b52a066f">lZet</a>,   (<span class="keywordtype">void</span>*)&amp;lzet);    CHKERRQ(ierr);</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    ierr = DMDAVecGetArrayRead(user-&gt;<a class="code" href="variables_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>,  user-&gt;<a class="code" href="variables_8h.html#acb5123619f6844033498dbbd1f46b8d0">lAj</a>,    (<span class="keywordtype">void</span>*)&amp;laj);     CHKERRQ(ierr);</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;    ierr = DMDAVecGetArrayRead(user-&gt;<a class="code" href="variables_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>,  user-&gt;<a class="code" href="variables_8h.html#a2f213dcdaf9617bfb44e4f22857f2e56">lNvert</a>, (<span class="keywordtype">void</span>*)&amp;lnvert);  CHKERRQ(ierr);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    ierr = DMDAVecGetArray(user-&gt;<a class="code" href="variables_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>,  user-&gt;<a class="code" href="variables_8h.html#a70969e8333ab8fd8eb60acc1f22f830a">Qcrit</a>, (<span class="keywordtype">void</span>*)&amp;gq);       CHKERRQ(ierr);</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160; </div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    <span class="comment">// --- 3. Define Loop Bounds for INTERIOR Cells ---</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    PetscInt i_start = (info.xs == 0) ? 1 : info.xs;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;    PetscInt i_end   = (info.xs + info.xm == info.mx) ? info.mx - 1 : info.xs + info.xm;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    PetscInt j_start = (info.ys == 0) ? 1 : info.ys;</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    PetscInt j_end   = (info.ys + info.ym == info.my) ? info.my - 1 : info.ys + info.ym;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    PetscInt k_start = (info.zs == 0) ? 1 : info.zs;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    PetscInt k_end   = (info.zs + info.zm == info.mz) ? info.mz - 1 : info.zs + info.zm;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160; </div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="comment">// --- 4. Main Computation Loop ---</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    <span class="keywordflow">for</span> (PetscInt k = k_start; k &lt; k_end; k++) {</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        <span class="keywordflow">for</span> (PetscInt j = j_start; j &lt; j_end; j++) {</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;            <span class="keywordflow">for</span> (PetscInt i = i_start; i &lt; i_end; i++) {</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;                </div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;                <span class="comment">// Calculate velocity derivatives in computational space (central differences)</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;                PetscReal uc = 0.5 * (lucat[k][j][i+1].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - lucat[k][j][i-1].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>);</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;                PetscReal vc = 0.5 * (lucat[k][j][i+1].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - lucat[k][j][i-1].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>);</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;                PetscReal wc = 0.5 * (lucat[k][j][i+1].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - lucat[k][j][i-1].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160; </div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;                PetscReal ue = 0.5 * (lucat[k][j+1][i].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - lucat[k][j-1][i].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>);</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;                PetscReal ve = 0.5 * (lucat[k][j+1][i].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - lucat[k][j-1][i].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>);</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;                PetscReal we = 0.5 * (lucat[k][j+1][i].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - lucat[k][j-1][i].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160; </div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                PetscReal uz = 0.5 * (lucat[k+1][j][i].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> - lucat[k-1][j][i].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>);</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;                PetscReal vz = 0.5 * (lucat[k+1][j][i].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> - lucat[k-1][j][i].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>);</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;                PetscReal wz = 0.5 * (lucat[k+1][j][i].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> - lucat[k-1][j][i].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160; </div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;                <span class="comment">// Average metrics to the cell center</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;                PetscReal csi1 = 0.5 * (lcsi[k][j][i].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + lcsi[k][j][i-1].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>) * laj[k][j][i];</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;                PetscReal csi2 = 0.5 * (lcsi[k][j][i].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + lcsi[k][j][i-1].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>) * laj[k][j][i];</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;                PetscReal csi3 = 0.5 * (lcsi[k][j][i].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + lcsi[k][j][i-1].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>) * laj[k][j][i];</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;                </div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;                PetscReal eta1 = 0.5 * (leta[k][j][i].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + leta[k][j-1][i].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>) * laj[k][j][i];</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;                PetscReal eta2 = 0.5 * (leta[k][j][i].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + leta[k][j-1][i].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>) * laj[k][j][i];</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                PetscReal eta3 = 0.5 * (leta[k][j][i].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + leta[k][j-1][i].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>) * laj[k][j][i];</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160; </div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;                PetscReal zet1 = 0.5 * (lzet[k][j][i].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + lzet[k-1][j][i].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>) * laj[k][j][i];</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                PetscReal zet2 = 0.5 * (lzet[k][j][i].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + lzet[k-1][j][i].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>) * laj[k][j][i];</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                PetscReal zet3 = 0.5 * (lzet[k][j][i].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + lzet[k-1][j][i].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>) * laj[k][j][i];</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160; </div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                <span class="comment">// Calculate velocity gradient tensor components d_ij = du_i/dx_j</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                PetscReal d11 = uc * csi1 + ue * eta1 + uz * zet1;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;                PetscReal d12 = uc * csi2 + ue * eta2 + uz * zet2;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                PetscReal d13 = uc * csi3 + ue * eta3 + uz * zet3;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160; </div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                PetscReal d21 = vc * csi1 + ve * eta1 + vz * zet1;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                PetscReal d22 = vc * csi2 + ve * eta2 + vz * zet2;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                PetscReal d23 = vc * csi3 + ve * eta3 + vz * zet3;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                </div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                PetscReal d31 = wc * csi1 + we * eta1 + wz * zet1;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                PetscReal d32 = wc * csi2 + we * eta2 + wz * zet2;</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                PetscReal d33 = wc * csi3 + we * eta3 + wz * zet3;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160; </div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                <span class="comment">// Strain-Rate Tensor S_ij = 0.5 * (d_ij + d_ji)</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                PetscReal s11 = d11;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                PetscReal s12 = 0.5 * (d12 + d21);</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                PetscReal s13 = 0.5 * (d13 + d31);</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                PetscReal s22 = d22;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                PetscReal s23 = 0.5 * (d23 + d32);</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                PetscReal s33 = d33;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160; </div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                <span class="comment">// Vorticity Tensor Omega_ij = 0.5 * (d_ij - d_ji)</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                PetscReal w12 = 0.5 * (d12 - d21);</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                PetscReal w13 = 0.5 * (d13 - d31);</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                PetscReal w23 = 0.5 * (d23 - d32);</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160; </div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                <span class="comment">// Squared norms of the tensors</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                PetscReal s_norm_sq = s11*s11 + s22*s22 + s33*s33 + 2.0*(s12*s12 + s13*s13 + s23*s23);</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                PetscReal w_norm_sq = 2.0 * (w12*w12 + w13*w13 + w23*w23);</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                </div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                gq[k][j][i] = 0.5 * (w_norm_sq - s_norm_sq);</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160; </div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                <span class="keywordflow">if</span> (lnvert[k][j][i] &gt; 0.1) {</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                    gq[k][j][i] = 0.0;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                }</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;            }</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;        }</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;    }</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160; </div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <span class="comment">// --- 5. Restore arrays ---</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    ierr = DMDAVecRestoreArrayRead(user-&gt;<a class="code" href="variables_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code" href="variables_8h.html#ace2eeedc863d73caaf51bb83aa993e44">lUcat</a>,  (<span class="keywordtype">void</span>*)&amp;lucat);   CHKERRQ(ierr);</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    ierr = DMDAVecRestoreArrayRead(user-&gt;<a class="code" href="variables_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code" href="variables_8h.html#a9693ebf5c9ea601d5ebaf6d24cc60721">lCsi</a>,   (<span class="keywordtype">void</span>*)&amp;lcsi);    CHKERRQ(ierr);</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    ierr = DMDAVecRestoreArrayRead(user-&gt;<a class="code" href="variables_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code" href="variables_8h.html#ad4296b10d8eb7b065165582f5cc85897">lEta</a>,   (<span class="keywordtype">void</span>*)&amp;leta);    CHKERRQ(ierr);</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    ierr = DMDAVecRestoreArrayRead(user-&gt;<a class="code" href="variables_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, user-&gt;<a class="code" href="variables_8h.html#a414751d7a391a78834cdce87b52a066f">lZet</a>,   (<span class="keywordtype">void</span>*)&amp;lzet);    CHKERRQ(ierr);</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    ierr = DMDAVecRestoreArrayRead(user-&gt;<a class="code" href="variables_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>,  user-&gt;<a class="code" href="variables_8h.html#acb5123619f6844033498dbbd1f46b8d0">lAj</a>,    (<span class="keywordtype">void</span>*)&amp;laj);     CHKERRQ(ierr);</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;    ierr = DMDAVecRestoreArrayRead(user-&gt;<a class="code" href="variables_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>,  user-&gt;<a class="code" href="variables_8h.html#a2f213dcdaf9617bfb44e4f22857f2e56">lNvert</a>, (<span class="keywordtype">void</span>*)&amp;lnvert);  CHKERRQ(ierr);</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    ierr = DMDAVecRestoreArray(user-&gt;<a class="code" href="variables_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>,  user-&gt;<a class="code" href="variables_8h.html#a70969e8333ab8fd8eb60acc1f22f830a">Qcrit</a>, (<span class="keywordtype">void</span>*)&amp;gq);       CHKERRQ(ierr);</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160; </div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    <a class="code" href="logging_8h.html#a5fe7257f46131945aacf9a35e9de5874">PROFILE_FUNCTION_END</a>;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;    PetscFunctionReturn(0);</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="postprocessing__kernels_8c_a303c5afb89d6fdaab3e40f9371d8f1b2_cgraph.svg" width="552" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="postprocessing__kernels_8c_a303c5afb89d6fdaab3e40f9371d8f1b2_icgraph.svg" width="536" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a86d13bca79c1355ce808509a999a1d88"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a86d13bca79c1355ce808509a999a1d88">&#9670;&nbsp;</a></span>NormalizeRelativeField()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode NormalizeRelativeField </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>relative_field_name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Normalizes a relative field by subtracting a reference value. </p>
<p>This kernel finds the relative field at a specific grid point (i,j,k) and subtracts this value from the entire field. The reference point is configurable via command-line options (-ip, -jp, -kp). The operation is performed in-place on the provided relative field vector.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">user</td><td>The <a class="el" href="variables_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a>, providing access to DMs and Vecs. </td></tr>
    <tr><td class="paramname">relative_field_name</td><td>The string name of the relative field Vec to normalize (e.g., "P"). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode </dd></dl>

<p class="definition">Definition at line <a class="el" href="postprocessing__kernels_8c_source.html#l00398">398</a> of file <a class="el" href="postprocessing__kernels_8c_source.html">postprocessing_kernels.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;{</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    PetscErrorCode ierr;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    Vec            P_vec = NULL;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    PetscMPIInt    rank;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    PetscInt       ip=1, jp=1, kp=1; <span class="comment">// Default reference point</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    PetscReal      p_ref = 0.0;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    PetscInt       ref_point_global_idx[1];</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    PetscScalar    ref_value_local[1];</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    IS             is_from, is_to;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    VecScatter     scatter_ctx;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    Vec            ref_vec_seq;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <a class="code" href="variables_8h.html#structPostProcessParams">PostProcessParams</a> *pps = user-&gt;<a class="code" href="variables_8h.html#a322702c716e6e140d71515d0b3e111b1">simCtx</a>-&gt;<a class="code" href="variables_8h.html#acf6d729ae4d0d996d6b056ccc5438995">pps</a>;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160; </div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="comment">// Fetch referenc point from pps.</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    ip = pps-&gt;<a class="code" href="variables_8h.html#a529f45c4ddf21ba85640423978d30ada">reference</a>[0];</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    jp = pps-&gt;<a class="code" href="variables_8h.html#a529f45c4ddf21ba85640423978d30ada">reference</a>[1];</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    kp = pps-&gt;<a class="code" href="variables_8h.html#a529f45c4ddf21ba85640423978d30ada">reference</a>[2];</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160; </div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    PetscFunctionBeginUser;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    <a class="code" href="logging_8h.html#ace99f3e207ccb2e46e9b782f9e57732e">PROFILE_FUNCTION_BEGIN</a>;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;-&gt; KERNEL: Running NormalizeRelativeField on &#39;%s&#39;.\n&quot;</span>, relative_field_name);</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160; </div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="comment">// --- 1. Map string argument to the PETSc Vec ---</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="keywordflow">if</span> (strcasecmp(relative_field_name, <span class="stringliteral">&quot;P&quot;</span>) == 0) {</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;        P_vec = user-&gt;<a class="code" href="variables_8h.html#a5a73aa2bc6be44bc1ff8847cf0a1b6af">P</a>;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;        SETERRQ(PETSC_COMM_SELF, 1, <span class="stringliteral">&quot;NormalizeRelativeField only supports the primary &#39;P&#39; field , not &#39;%s&#39; currently.&quot;</span>, relative_field_name);</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    }</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160; </div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="comment">// --- 2. Get reference point from options and calculate its global DA index ---</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    ierr = MPI_Comm_rank(PETSC_COMM_WORLD, &amp;rank); CHKERRQ(ierr);</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160; </div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    <span class="comment">// Convert the (i,j,k) logical grid coordinates to the global 1D index used by the DMDA vector</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    ref_point_global_idx[0] = kp * (user-&gt;<a class="code" href="variables_8h.html#ad1904cdee33ebeffba809c883f7e9641">IM</a> * user-&gt;<a class="code" href="variables_8h.html#aa55a2a246e904b3569075eb4de0092a6">JM</a>) + jp * user-&gt;<a class="code" href="variables_8h.html#ad1904cdee33ebeffba809c883f7e9641">IM</a> + ip;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160; </div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    <span class="comment">// --- 3. Robustly Scatter the single reference value to rank 0 ---</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    <span class="comment">// Create an Index Set (IS) for the source point (from the global vector)</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    ierr = ISCreateGeneral(PETSC_COMM_WORLD, 1, ref_point_global_idx, PETSC_COPY_VALUES, &amp;is_from); CHKERRQ(ierr);</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160; </div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="comment">// Create a sequential vector on rank 0 to hold the result</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    ierr = VecCreateSeq(PETSC_COMM_SELF, 1, &amp;ref_vec_seq); CHKERRQ(ierr);</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    </div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;    <span class="comment">// Create an Index Set for the destination point (index 0 of the new sequential vector)</span></div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    PetscInt dest_idx[1] = {0};</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    ierr = ISCreateGeneral(PETSC_COMM_SELF, 1, dest_idx, PETSC_COPY_VALUES, &amp;is_to); CHKERRQ(ierr);</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160; </div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="comment">// Create the scatter context and perform the scatter</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    ierr = VecScatterCreate(P_vec, is_from, ref_vec_seq, is_to, &amp;scatter_ctx); CHKERRQ(ierr);</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    ierr = VecScatterBegin(scatter_ctx, P_vec, ref_vec_seq, INSERT_VALUES, SCATTER_FORWARD); CHKERRQ(ierr);</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    ierr = VecScatterEnd(scatter_ctx, P_vec, ref_vec_seq, INSERT_VALUES, SCATTER_FORWARD); CHKERRQ(ierr);</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160; </div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="comment">// On rank 0, get the value. On other ranks, this will do nothing.</span></div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <span class="keywordflow">if</span> (rank == 0) {</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;        ierr = VecGetValues(ref_vec_seq, 1, dest_idx, ref_value_local); CHKERRQ(ierr);</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;        p_ref = ref_value_local[0];</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;%s reference point (%&quot;</span> PetscInt_FMT <span class="stringliteral">&quot;, %&quot;</span> PetscInt_FMT <span class="stringliteral">&quot;, %&quot;</span> PetscInt_FMT <span class="stringliteral">&quot;) has value %g.\n&quot;</span>, relative_field_name, jp, kp, ip, p_ref);</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    }</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    </div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="comment">// --- 4. Broadcast the reference value from rank 0 to all other processes ---</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    ierr = MPI_Bcast(&amp;p_ref, 1, MPIU_REAL, 0, PETSC_COMM_WORLD); CHKERRQ(ierr);</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160; </div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    <span class="comment">// --- 5. Perform the normalization (in-place shift) on the full distributed vector ---</span></div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    ierr = VecShift(P_vec, -p_ref); CHKERRQ(ierr);</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;    <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;%s field normalized by subtracting %g.\n&quot;</span>, relative_field_name, p_ref);</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    </div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <span class="comment">// --- 6. Cleanup ---</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    ierr = ISDestroy(&amp;is_from); CHKERRQ(ierr);</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    ierr = ISDestroy(&amp;is_to); CHKERRQ(ierr);</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    ierr = VecScatterDestroy(&amp;scatter_ctx); CHKERRQ(ierr);</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    ierr = VecDestroy(&amp;ref_vec_seq); CHKERRQ(ierr);</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160; </div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <a class="code" href="logging_8h.html#a5fe7257f46131945aacf9a35e9de5874">PROFILE_FUNCTION_END</a>;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    PetscFunctionReturn(0);</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="postprocessing__kernels_8c_a86d13bca79c1355ce808509a999a1d88_icgraph.svg" width="563" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a37ee1aa2e642bbfd24a6faf33a92568c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a37ee1aa2e642bbfd24a6faf33a92568c">&#9670;&nbsp;</a></span>ComputeSpecificKE()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode ComputeSpecificKE </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>velocity_field</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>ske_field</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Computes the specific kinetic energy (KE per unit mass) for each particle. </p>
<p>This kernel calculates SKE = 0.5 * |velocity|^2. It requires that the velocity field exists and will populate the specific kinetic energy field. The output field must be registered before this kernel is called.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">user</td><td>The <a class="el" href="variables_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> containing the DMSwarm. </td></tr>
    <tr><td class="paramname">velocity_field</td><td>The name of the input vector field for particle velocity. </td></tr>
    <tr><td class="paramname">ske_field</td><td>The name of the output scalar field to store specific KE. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode </dd></dl>

<p class="definition">Definition at line <a class="el" href="postprocessing__kernels_8c_source.html#l00491">491</a> of file <a class="el" href="postprocessing__kernels_8c_source.html">postprocessing_kernels.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;{</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    PetscErrorCode ierr;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    PetscInt n_local;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <span class="keyword">const</span> PetscScalar (*vel_arr)[3]; <span class="comment">// Access velocity as array of 3-component vectors</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    PetscScalar *ske_arr;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160; </div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    PetscFunctionBeginUser;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <a class="code" href="logging_8h.html#ace99f3e207ccb2e46e9b782f9e57732e">PROFILE_FUNCTION_BEGIN</a>;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;    <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;-&gt; KERNEL: Running ComputeSpecificKE (&#39;%s&#39; -&gt; &#39;%s&#39;).\n&quot;</span>, velocity_field, ske_field);</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160; </div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;    <span class="comment">// Get local data arrays from the DMSwarm</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    ierr = DMSwarmGetLocalSize(user-&gt;<a class="code" href="variables_8h.html#a1675749ea3b2429f00405a1ee3203d18">swarm</a>, &amp;n_local); CHKERRQ(ierr);</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <span class="keywordflow">if</span> (n_local == 0) PetscFunctionReturn(0);</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160; </div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <span class="comment">// Get read-only access to velocity and write access to the output field</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;    ierr = DMSwarmGetField(user-&gt;<a class="code" href="variables_8h.html#a1675749ea3b2429f00405a1ee3203d18">swarm</a>, velocity_field, NULL, NULL, (<span class="keyword">const</span> <span class="keywordtype">void</span>**)&amp;vel_arr); CHKERRQ(ierr);</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    ierr = DMSwarmGetField(user-&gt;<a class="code" href="variables_8h.html#a49a63fad0d45e1bfc78e69a022c9a9e5">post_swarm</a>, ske_field, NULL, NULL, (<span class="keywordtype">void</span>**)&amp;ske_arr); CHKERRQ(ierr);</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160; </div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    <span class="comment">// Main computation loop</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;    <span class="keywordflow">for</span> (PetscInt p = 0; p &lt; n_local; p++) {</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;        <span class="keyword">const</span> PetscScalar u = vel_arr[p][0];</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        <span class="keyword">const</span> PetscScalar v = vel_arr[p][1];</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        <span class="keyword">const</span> PetscScalar w = vel_arr[p][2];</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        <span class="keyword">const</span> PetscScalar vel_sq = u*u + v*v + w*w;</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;        ske_arr[p] = 0.5 * vel_sq;</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    }</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160; </div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    <span class="comment">// Restore arrays</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    ierr = DMSwarmRestoreField(user-&gt;<a class="code" href="variables_8h.html#a1675749ea3b2429f00405a1ee3203d18">swarm</a>, velocity_field, NULL, NULL, (<span class="keyword">const</span> <span class="keywordtype">void</span>**)&amp;vel_arr); CHKERRQ(ierr);</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    ierr = DMSwarmRestoreField(user-&gt;<a class="code" href="variables_8h.html#a49a63fad0d45e1bfc78e69a022c9a9e5">post_swarm</a>, ske_field, NULL, NULL, (<span class="keywordtype">void</span>**)&amp;ske_arr); CHKERRQ(ierr);</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160; </div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    <a class="code" href="logging_8h.html#a5fe7257f46131945aacf9a35e9de5874">PROFILE_FUNCTION_END</a>;</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    PetscFunctionReturn(0);</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="postprocessing__kernels_8c_a37ee1aa2e642bbfd24a6faf33a92568c_icgraph.svg" width="535" height="38"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="avariables_8h_html_a443db716c1f9b5d3046639bd63241a93"><div class="ttname"><a href="variables_8h.html#a443db716c1f9b5d3046639bd63241a93">ScalingCtx::L_ref</a></div><div class="ttdeci">PetscReal L_ref</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00520">variables.h:520</a></div></div>
<div class="ttc" id="avariables_8h_html_ad032e456f7f4b32b9ac0d94be05de204"><div class="ttname"><a href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">Cmpnts::y</a></div><div class="ttdeci">PetscScalar y</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00101">variables.h:101</a></div></div>
<div class="ttc" id="avariables_8h_html_a69c3a361d1aac3bdc14f971bda57e032"><div class="ttname"><a href="variables_8h.html#a69c3a361d1aac3bdc14f971bda57e032">UserCtx::Ucont</a></div><div class="ttdeci">Vec Ucont</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00684">variables.h:684</a></div></div>
<div class="ttc" id="avariables_8h_html_a322702c716e6e140d71515d0b3e111b1"><div class="ttname"><a href="variables_8h.html#a322702c716e6e140d71515d0b3e111b1">UserCtx::simCtx</a></div><div class="ttdeci">SimCtx * simCtx</div><div class="ttdoc">Back-pointer to the master simulation context.</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00660">variables.h:660</a></div></div>
<div class="ttc" id="alogging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a></div><div class="ttdeci">@ LOG_DEBUG</div><div class="ttdoc">Detailed debugging information.</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00033">logging.h:33</a></div></div>
<div class="ttc" id="avariables_8h_html_a718a09fbedf450248eaf7019a980e139"><div class="ttname"><a href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">Cmpnts::x</a></div><div class="ttdeci">PetscScalar x</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00101">variables.h:101</a></div></div>
<div class="ttc" id="avariables_8h_html_a5a73aa2bc6be44bc1ff8847cf0a1b6af"><div class="ttname"><a href="variables_8h.html#a5a73aa2bc6be44bc1ff8847cf0a1b6af">UserCtx::P</a></div><div class="ttdeci">Vec P</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00684">variables.h:684</a></div></div>
<div class="ttc" id="alogging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9a8f6fe15bfe15104da6d1b360194a5400"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a8f6fe15bfe15104da6d1b360194a5400">LOG_WARNING</a></div><div class="ttdeci">@ LOG_WARNING</div><div class="ttdoc">Non-critical issues that warrant attention.</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00030">logging.h:30</a></div></div>
<div class="ttc" id="avariables_8h_html_structSimCtx"><div class="ttname"><a href="variables_8h.html#structSimCtx">SimCtx</a></div><div class="ttdoc">The master context for the entire simulation.</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00538">variables.h:538</a></div></div>
<div class="ttc" id="avariables_8h_html_ace2eeedc863d73caaf51bb83aa993e44"><div class="ttname"><a href="variables_8h.html#ace2eeedc863d73caaf51bb83aa993e44">UserCtx::lUcat</a></div><div class="ttdeci">Vec lUcat</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00684">variables.h:684</a></div></div>
<div class="ttc" id="alogging_8h_html_a3758dd5d300a594312c95bc393378df0"><div class="ttname"><a href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a></div><div class="ttdeci">#define LOCAL</div><div class="ttdoc">Logging scope definitions for controlling message output.</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00044">logging.h:44</a></div></div>
<div class="ttc" id="avariables_8h_html_ad4296b10d8eb7b065165582f5cc85897"><div class="ttname"><a href="variables_8h.html#ad4296b10d8eb7b065165582f5cc85897">UserCtx::lEta</a></div><div class="ttdeci">Vec lEta</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00700">variables.h:700</a></div></div>
<div class="ttc" id="avariables_8h_html_ad1904cdee33ebeffba809c883f7e9641"><div class="ttname"><a href="variables_8h.html#ad1904cdee33ebeffba809c883f7e9641">UserCtx::IM</a></div><div class="ttdeci">PetscInt IM</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00666">variables.h:666</a></div></div>
<div class="ttc" id="avariables_8h_html_a529f45c4ddf21ba85640423978d30ada"><div class="ttname"><a href="variables_8h.html#a529f45c4ddf21ba85640423978d30ada">PostProcessParams::reference</a></div><div class="ttdeci">PetscInt reference[3]</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00477">variables.h:477</a></div></div>
<div class="ttc" id="alogging_8h_html_a5fe7257f46131945aacf9a35e9de5874"><div class="ttname"><a href="logging_8h.html#a5fe7257f46131945aacf9a35e9de5874">PROFILE_FUNCTION_END</a></div><div class="ttdeci">#define PROFILE_FUNCTION_END</div><div class="ttdoc">Marks the end of a profiled code block.</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00731">logging.h:731</a></div></div>
<div class="ttc" id="avariables_8h_html_aa24a988353f69e0cf76b358d10fd374a"><div class="ttname"><a href="variables_8h.html#aa24a988353f69e0cf76b358d10fd374a">SimCtx::scaling</a></div><div class="ttdeci">ScalingCtx scaling</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00586">variables.h:586</a></div></div>
<div class="ttc" id="avariables_8h_html_a0d09ddf5e31ea3cfcab2c6bbc59b64cd"><div class="ttname"><a href="variables_8h.html#a0d09ddf5e31ea3cfcab2c6bbc59b64cd">UserCtx::P_nodal</a></div><div class="ttdeci">Vec P_nodal</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00729">variables.h:729</a></div></div>
<div class="ttc" id="avariables_8h_html_acb5123619f6844033498dbbd1f46b8d0"><div class="ttname"><a href="variables_8h.html#acb5123619f6844033498dbbd1f46b8d0">UserCtx::lAj</a></div><div class="ttdeci">Vec lAj</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00700">variables.h:700</a></div></div>
<div class="ttc" id="avariables_8h_html_acf6d729ae4d0d996d6b056ccc5438995"><div class="ttname"><a href="variables_8h.html#acf6d729ae4d0d996d6b056ccc5438995">SimCtx::pps</a></div><div class="ttdeci">PostProcessParams * pps</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00644">variables.h:644</a></div></div>
<div class="ttc" id="avariables_8h_html_structPostProcessParams"><div class="ttname"><a href="variables_8h.html#structPostProcessParams">PostProcessParams</a></div><div class="ttdoc">Holds all configuration parameters for a post-processing run.</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00452">variables.h:452</a></div></div>
<div class="ttc" id="alogging_8h_html_a672ff9c400e2307306b36415d4fefcb9"><div class="ttname"><a href="logging_8h.html#a672ff9c400e2307306b36415d4fefcb9">LOG</a></div><div class="ttdeci">#define LOG(scope, level, fmt,...)</div><div class="ttdoc">Logging macro for PETSc-based applications with scope control.</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00083">logging.h:83</a></div></div>
<div class="ttc" id="avariables_8h_html_a2f213dcdaf9617bfb44e4f22857f2e56"><div class="ttname"><a href="variables_8h.html#a2f213dcdaf9617bfb44e4f22857f2e56">UserCtx::lNvert</a></div><div class="ttdeci">Vec lNvert</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00684">variables.h:684</a></div></div>
<div class="ttc" id="alogging_8h_html_a3de33738fd3c7e77bffbcfaefc3e7645"><div class="ttname"><a href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a></div><div class="ttdeci">#define GLOBAL</div><div class="ttdoc">Scope for global logging across all processes.</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00045">logging.h:45</a></div></div>
<div class="ttc" id="avariables_8h_html_structCmpnts"><div class="ttname"><a href="variables_8h.html#structCmpnts">Cmpnts</a></div><div class="ttdoc">A 3D point or vector with PetscScalar components.</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00100">variables.h:100</a></div></div>
<div class="ttc" id="avariables_8h_html_aecd5e36365d3d40c5e7e707a93668e92"><div class="ttname"><a href="variables_8h.html#aecd5e36365d3d40c5e7e707a93668e92">ScalingCtx::U_ref</a></div><div class="ttdeci">PetscReal U_ref</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00521">variables.h:521</a></div></div>
<div class="ttc" id="avariables_8h_html_aa55a2a246e904b3569075eb4de0092a6"><div class="ttname"><a href="variables_8h.html#aa55a2a246e904b3569075eb4de0092a6">UserCtx::JM</a></div><div class="ttdeci">PetscInt JM</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00666">variables.h:666</a></div></div>
<div class="ttc" id="avariables_8h_html_a70969e8333ab8fd8eb60acc1f22f830a"><div class="ttname"><a href="variables_8h.html#a70969e8333ab8fd8eb60acc1f22f830a">UserCtx::Qcrit</a></div><div class="ttdeci">Vec Qcrit</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00731">variables.h:731</a></div></div>
<div class="ttc" id="avariables_8h_html_a5eedf611da6dd4f59cc65753b777b957"><div class="ttname"><a href="variables_8h.html#a5eedf611da6dd4f59cc65753b777b957">SimCtx::np</a></div><div class="ttdeci">PetscInt np</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00612">variables.h:612</a></div></div>
<div class="ttc" id="asetup_8h_html_ad5f82951adcce74b3d37cb5880acf43a"><div class="ttname"><a href="setup_8h.html#ad5f82951adcce74b3d37cb5880acf43a">UpdateLocalGhosts</a></div><div class="ttdeci">PetscErrorCode UpdateLocalGhosts(UserCtx *user, const char *fieldName)</div><div class="ttdoc">Updates the local vector (including ghost points) from its corresponding global vector.</div><div class="ttdef"><b>Definition:</b> <a href="setup_8c_source.html#l00832">setup.c:832</a></div></div>
<div class="ttc" id="apostprocessing__kernels_8c_html_ab72ef98f3a415dddd8e609e95a1aeac6"><div class="ttname"><a href="postprocessing__kernels_8c.html#ab72ef98f3a415dddd8e609e95a1aeac6">DimensionalizeField</a></div><div class="ttdeci">PetscErrorCode DimensionalizeField(UserCtx *user, const char *field_name)</div><div class="ttdoc">Scales a specified field from non-dimensional to dimensional units in-place.</div><div class="ttdef"><b>Definition:</b> <a href="postprocessing__kernels_8c_source.html#l00020">postprocessing_kernels.c:20</a></div></div>
<div class="ttc" id="avariables_8h_html_a69966d928601d61d4f526636f84396c5"><div class="ttname"><a href="variables_8h.html#a69966d928601d61d4f526636f84396c5">UserCtx::fda</a></div><div class="ttdeci">DM fda</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00663">variables.h:663</a></div></div>
<div class="ttc" id="alogging_8h_html_a4a671b0e347e0a22b0df806f246d5d11"><div class="ttname"><a href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a></div><div class="ttdeci">#define LOG_ALLOW(scope, level, fmt,...)</div><div class="ttdoc">Logging macro that checks both the log level and whether the calling function is in the allowed-funct...</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00199">logging.h:199</a></div></div>
<div class="ttc" id="avariables_8h_html_a9f0c002a2c7cde3b6ac843ab9185f4d4"><div class="ttname"><a href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">Cmpnts::z</a></div><div class="ttdeci">PetscScalar z</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00101">variables.h:101</a></div></div>
<div class="ttc" id="alogging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a></div><div class="ttdeci">@ LOG_INFO</div><div class="ttdoc">Informational messages about program execution.</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00032">logging.h:32</a></div></div>
<div class="ttc" id="avariables_8h_html_a1675749ea3b2429f00405a1ee3203d18"><div class="ttname"><a href="variables_8h.html#a1675749ea3b2429f00405a1ee3203d18">UserCtx::swarm</a></div><div class="ttdeci">DM swarm</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00722">variables.h:722</a></div></div>
<div class="ttc" id="avariables_8h_html_aa1823d873982755996b7335f43732af4"><div class="ttname"><a href="variables_8h.html#aa1823d873982755996b7335f43732af4">UserCtx::Ucat</a></div><div class="ttdeci">Vec Ucat</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00684">variables.h:684</a></div></div>
<div class="ttc" id="avariables_8h_html_a95078248cc49ce19d5d05b14e1701888"><div class="ttname"><a href="variables_8h.html#a95078248cc49ce19d5d05b14e1701888">UserCtx::lP</a></div><div class="ttdeci">Vec lP</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00684">variables.h:684</a></div></div>
<div class="ttc" id="avariables_8h_html_a414751d7a391a78834cdce87b52a066f"><div class="ttname"><a href="variables_8h.html#a414751d7a391a78834cdce87b52a066f">UserCtx::lZet</a></div><div class="ttdeci">Vec lZet</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00700">variables.h:700</a></div></div>
<div class="ttc" id="avariables_8h_html_a585521a5dbb55ae244e34a354ac93e3f"><div class="ttname"><a href="variables_8h.html#a585521a5dbb55ae244e34a354ac93e3f">UserCtx::Ucat_nodal</a></div><div class="ttdeci">Vec Ucat_nodal</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00730">variables.h:730</a></div></div>
<div class="ttc" id="avariables_8h_html_a9693ebf5c9ea601d5ebaf6d24cc60721"><div class="ttname"><a href="variables_8h.html#a9693ebf5c9ea601d5ebaf6d24cc60721">UserCtx::lCsi</a></div><div class="ttdeci">Vec lCsi</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00700">variables.h:700</a></div></div>
<div class="ttc" id="avariables_8h_html_ade74d185e7611423c6126ec505309a47"><div class="ttname"><a href="variables_8h.html#ade74d185e7611423c6126ec505309a47">ScalingCtx::P_ref</a></div><div class="ttdeci">PetscReal P_ref</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00523">variables.h:523</a></div></div>
<div class="ttc" id="avariables_8h_html_a49a63fad0d45e1bfc78e69a022c9a9e5"><div class="ttname"><a href="variables_8h.html#a49a63fad0d45e1bfc78e69a022c9a9e5">UserCtx::post_swarm</a></div><div class="ttdeci">DM post_swarm</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00728">variables.h:728</a></div></div>
<div class="ttc" id="alogging_8h_html_ace99f3e207ccb2e46e9b782f9e57732e"><div class="ttname"><a href="logging_8h.html#ace99f3e207ccb2e46e9b782f9e57732e">PROFILE_FUNCTION_BEGIN</a></div><div class="ttdeci">#define PROFILE_FUNCTION_BEGIN</div><div class="ttdoc">Marks the beginning of a profiled code block (typically a function).</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00722">logging.h:722</a></div></div>
<div class="ttc" id="avariables_8h_html_af031acb43b014d5ac788aa9003491e75"><div class="ttname"><a href="variables_8h.html#af031acb43b014d5ac788aa9003491e75">UserCtx::da</a></div><div class="ttdeci">DM da</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00663">variables.h:663</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="postprocessing__kernels_8c.html">postprocessing_kernels.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
