<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>PICurv: interpolation.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PICurv
   &#160;<span id="projectnumber">0.1.0</span>
   </div>
   <div id="projectbrief">A Parallel Particle-In-Cell Solver for Curvilinear LES</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('interpolation_8c.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">interpolation.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &quot;<a class="el" href="interpolation_8h_source.html">interpolation.h</a>&quot;</code><br />
</div><div class="textblock"><div class="dynheader">
Include dependency graph for interpolation.c:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="interpolation_8c__incl.svg" width="100%" height="600"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
</div>
<p><a href="interpolation_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:abec558b5f0fa2eccdaa9a7efc651e93b"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interpolation_8c.html#abec558b5f0fa2eccdaa9a7efc651e93b">NUM_WEIGHTS</a>&#160;&#160;&#160;8</td></tr>
<tr class="separator:abec558b5f0fa2eccdaa9a7efc651e93b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8a60be44abd6bcc3c5912e23b8b940c4"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interpolation_8c.html#a8a60be44abd6bcc3c5912e23b8b940c4">ERROR_MSG_BUFFER_SIZE</a>&#160;&#160;&#160;256</td></tr>
<tr class="separator:a8a60be44abd6bcc3c5912e23b8b940c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae60511a9aa5cbf216a00a1bb81006bc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__scatter__module__internal.html#gae60511a9aa5cbf216a00a1bb81006bc5">__FUNCT__</a>&#160;&#160;&#160;&quot;InterpolateFieldFromCornerToCenter_Vector&quot;</td></tr>
<tr class="separator:gae60511a9aa5cbf216a00a1bb81006bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae60511a9aa5cbf216a00a1bb81006bc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__scatter__module__internal.html#gae60511a9aa5cbf216a00a1bb81006bc5">__FUNCT__</a>&#160;&#160;&#160;&quot;InterpolateFieldFromCornerToCenter_Scalar&quot;</td></tr>
<tr class="separator:gae60511a9aa5cbf216a00a1bb81006bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae60511a9aa5cbf216a00a1bb81006bc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__scatter__module__internal.html#gae60511a9aa5cbf216a00a1bb81006bc5">__FUNCT__</a>&#160;&#160;&#160;&quot;InterpolateFieldFromCenterToCorner_Scalar&quot;</td></tr>
<tr class="separator:gae60511a9aa5cbf216a00a1bb81006bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae60511a9aa5cbf216a00a1bb81006bc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__scatter__module__internal.html#gae60511a9aa5cbf216a00a1bb81006bc5">__FUNCT__</a>&#160;&#160;&#160;&quot;InterpolateFieldFromCenterToCorner_Vector&quot;</td></tr>
<tr class="separator:gae60511a9aa5cbf216a00a1bb81006bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae60511a9aa5cbf216a00a1bb81006bc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__scatter__module__internal.html#gae60511a9aa5cbf216a00a1bb81006bc5">__FUNCT__</a>&#160;&#160;&#160;&quot;InterpolateFieldFromCenterToCorner_Vector_Petsc&quot;</td></tr>
<tr class="separator:gae60511a9aa5cbf216a00a1bb81006bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae60511a9aa5cbf216a00a1bb81006bc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__scatter__module__internal.html#gae60511a9aa5cbf216a00a1bb81006bc5">__FUNCT__</a>&#160;&#160;&#160;&quot;InterpolateFieldFromCenterToCorner_Scalar_Petsc&quot;</td></tr>
<tr class="separator:gae60511a9aa5cbf216a00a1bb81006bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1bce17babc2d6ed81dbea45d49f867c0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interpolation_8c.html#a1bce17babc2d6ed81dbea45d49f867c0">__FUNCT</a>&#160;&#160;&#160;&quot;PiecWiseLinearInterpolation_Scalar&quot;</td></tr>
<tr class="separator:a1bce17babc2d6ed81dbea45d49f867c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1bce17babc2d6ed81dbea45d49f867c0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interpolation_8c.html#a1bce17babc2d6ed81dbea45d49f867c0">__FUNCT</a>&#160;&#160;&#160;&quot;PiecWiseLinearInterpolation_Vector&quot;</td></tr>
<tr class="separator:a1bce17babc2d6ed81dbea45d49f867c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1bce17babc2d6ed81dbea45d49f867c0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interpolation_8c.html#a1bce17babc2d6ed81dbea45d49f867c0">__FUNCT</a>&#160;&#160;&#160;&quot;ComputeTrilinearWeights&quot;</td></tr>
<tr class="separator:a1bce17babc2d6ed81dbea45d49f867c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1bce17babc2d6ed81dbea45d49f867c0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interpolation_8c.html#a1bce17babc2d6ed81dbea45d49f867c0">__FUNCT</a>&#160;&#160;&#160;&quot;TrilinearInterpolation_Scalar&quot;</td></tr>
<tr class="separator:a1bce17babc2d6ed81dbea45d49f867c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1bce17babc2d6ed81dbea45d49f867c0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interpolation_8c.html#a1bce17babc2d6ed81dbea45d49f867c0">__FUNCT</a>&#160;&#160;&#160;&quot;TrilinearInterpolation_Vector&quot;</td></tr>
<tr class="separator:a1bce17babc2d6ed81dbea45d49f867c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1bce17babc2d6ed81dbea45d49f867c0"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interpolation_8c.html#a1bce17babc2d6ed81dbea45d49f867c0">__FUNCT</a>&#160;&#160;&#160;&quot;InterpolateEulerFieldToSwarmForParticle&quot;</td></tr>
<tr class="separator:a1bce17babc2d6ed81dbea45d49f867c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae60511a9aa5cbf216a00a1bb81006bc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__scatter__module__internal.html#gae60511a9aa5cbf216a00a1bb81006bc5">__FUNCT__</a>&#160;&#160;&#160;&quot;InterpolateEulerFieldToSwarm&quot;</td></tr>
<tr class="separator:gae60511a9aa5cbf216a00a1bb81006bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae60511a9aa5cbf216a00a1bb81006bc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__scatter__module__internal.html#gae60511a9aa5cbf216a00a1bb81006bc5">__FUNCT__</a>&#160;&#160;&#160;&quot;InterpolateAllFieldsToSwarm&quot;</td></tr>
<tr class="separator:gae60511a9aa5cbf216a00a1bb81006bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae60511a9aa5cbf216a00a1bb81006bc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__scatter__module__internal.html#gae60511a9aa5cbf216a00a1bb81006bc5">__FUNCT__</a>&#160;&#160;&#160;&quot;GetScatterTargetInfo&quot;</td></tr>
<tr class="separator:gae60511a9aa5cbf216a00a1bb81006bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae60511a9aa5cbf216a00a1bb81006bc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__scatter__module__internal.html#gae60511a9aa5cbf216a00a1bb81006bc5">__FUNCT__</a>&#160;&#160;&#160;&quot;AccumulateParticleField&quot;</td></tr>
<tr class="separator:gae60511a9aa5cbf216a00a1bb81006bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae60511a9aa5cbf216a00a1bb81006bc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__scatter__module__internal.html#gae60511a9aa5cbf216a00a1bb81006bc5">__FUNCT__</a>&#160;&#160;&#160;&quot;NormalizeGridVectorByCount&quot;</td></tr>
<tr class="separator:gae60511a9aa5cbf216a00a1bb81006bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae60511a9aa5cbf216a00a1bb81006bc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__scatter__module__internal.html#gae60511a9aa5cbf216a00a1bb81006bc5">__FUNCT__</a>&#160;&#160;&#160;&quot;ScatterParticleFieldToEulerField_Internal&quot;</td></tr>
<tr class="separator:gae60511a9aa5cbf216a00a1bb81006bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae60511a9aa5cbf216a00a1bb81006bc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__scatter__module__internal.html#gae60511a9aa5cbf216a00a1bb81006bc5">__FUNCT__</a>&#160;&#160;&#160;&quot;ScatterParticleFieldToEulerField&quot;</td></tr>
<tr class="separator:gae60511a9aa5cbf216a00a1bb81006bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae60511a9aa5cbf216a00a1bb81006bc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__scatter__module__internal.html#gae60511a9aa5cbf216a00a1bb81006bc5">__FUNCT__</a>&#160;&#160;&#160;&quot;ScatterAllParticleFieldsToEulerFields&quot;</td></tr>
<tr class="separator:gae60511a9aa5cbf216a00a1bb81006bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae60511a9aa5cbf216a00a1bb81006bc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__scatter__module__internal.html#gae60511a9aa5cbf216a00a1bb81006bc5">__FUNCT__</a>&#160;&#160;&#160;&quot;InterpolateCornerToFaceCenter_Scalar&quot;</td></tr>
<tr class="separator:gae60511a9aa5cbf216a00a1bb81006bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae60511a9aa5cbf216a00a1bb81006bc5"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__scatter__module__internal.html#gae60511a9aa5cbf216a00a1bb81006bc5">__FUNCT__</a>&#160;&#160;&#160;&quot;InterpolateCornerToFaceCenter_Vector&quot;</td></tr>
<tr class="separator:gae60511a9aa5cbf216a00a1bb81006bc5"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a1572054c1f369e31e37b0f44b04828d6"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interpolation_8c.html#a1572054c1f369e31e37b0f44b04828d6">InterpolateFieldFromCornerToCenter_Vector</a> (<a class="el" href="variables_8h.html#structCmpnts">Cmpnts</a> ***field_arr, <a class="el" href="variables_8h.html#structCmpnts">Cmpnts</a> ***centfield_arr, <a class="el" href="variables_8h.html#structUserCtx">UserCtx</a> *user)</td></tr>
<tr class="memdesc:a1572054c1f369e31e37b0f44b04828d6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interpolates a vector field from corner nodes to cell centers.  <a href="interpolation_8c.html#a1572054c1f369e31e37b0f44b04828d6">More...</a><br /></td></tr>
<tr class="separator:a1572054c1f369e31e37b0f44b04828d6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a178ae55ed2a5ace793e5ead8933d5c76"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interpolation_8c.html#a178ae55ed2a5ace793e5ead8933d5c76">InterpolateFieldFromCornerToCenter_Scalar</a> (PetscReal ***field_arr, PetscReal ***centfield_arr, <a class="el" href="variables_8h.html#structUserCtx">UserCtx</a> *user)</td></tr>
<tr class="memdesc:a178ae55ed2a5ace793e5ead8933d5c76"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interpolates a scalar field from corner nodes to cell centers.  <a href="interpolation_8c.html#a178ae55ed2a5ace793e5ead8933d5c76">More...</a><br /></td></tr>
<tr class="separator:a178ae55ed2a5ace793e5ead8933d5c76"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54b7c352fd11a3f0663c1f9d823462da"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interpolation_8c.html#a54b7c352fd11a3f0663c1f9d823462da">InterpolateFieldFromCenterToCorner_Scalar</a> (PetscReal ***centfield_arr, PetscReal ***field_arr, <a class="el" href="variables_8h.html#structUserCtx">UserCtx</a> *user)</td></tr>
<tr class="memdesc:a54b7c352fd11a3f0663c1f9d823462da"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interpolates a scalar field from cell centers to corner nodes.  <a href="interpolation_8c.html#a54b7c352fd11a3f0663c1f9d823462da">More...</a><br /></td></tr>
<tr class="separator:a54b7c352fd11a3f0663c1f9d823462da"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8e20ad6b773e06f8cc29773322297095"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interpolation_8c.html#a8e20ad6b773e06f8cc29773322297095">InterpolateFieldFromCenterToCorner_Vector</a> (<a class="el" href="variables_8h.html#structCmpnts">Cmpnts</a> ***centfield_arr, <a class="el" href="variables_8h.html#structCmpnts">Cmpnts</a> ***field_arr, <a class="el" href="variables_8h.html#structUserCtx">UserCtx</a> *user)</td></tr>
<tr class="memdesc:a8e20ad6b773e06f8cc29773322297095"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interpolates a vector field from cell centers to corner nodes.  <a href="interpolation_8c.html#a8e20ad6b773e06f8cc29773322297095">More...</a><br /></td></tr>
<tr class="separator:a8e20ad6b773e06f8cc29773322297095"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ee27d5d1f4d8e21ce1369bd25372e3f"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interpolation_8c.html#a6ee27d5d1f4d8e21ce1369bd25372e3f">InterpolateFieldFromCenterToCorner_Vector_Petsc</a> (<a class="el" href="variables_8h.html#structCmpnts">Cmpnts</a> ***centfield_arr, <a class="el" href="variables_8h.html#structCmpnts">Cmpnts</a> ***corner_arr, <a class="el" href="variables_8h.html#structUserCtx">UserCtx</a> *user)</td></tr>
<tr class="memdesc:a6ee27d5d1f4d8e21ce1369bd25372e3f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interpolates a vector field from cell centers to corner nodes.  <a href="interpolation_8c.html#a6ee27d5d1f4d8e21ce1369bd25372e3f">More...</a><br /></td></tr>
<tr class="separator:a6ee27d5d1f4d8e21ce1369bd25372e3f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad6bc0706533b2790c66b9f0efa77c13f"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interpolation_8c.html#ad6bc0706533b2790c66b9f0efa77c13f">InterpolateFieldFromCenterToCorner_Scalar_Petsc</a> (PetscReal ***centfield_arr, PetscReal ***corner_arr, <a class="el" href="variables_8h.html#structUserCtx">UserCtx</a> *user)</td></tr>
<tr class="memdesc:ad6bc0706533b2790c66b9f0efa77c13f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interpolates a scalar field from cell centers to corner nodes.  <a href="interpolation_8c.html#ad6bc0706533b2790c66b9f0efa77c13f">More...</a><br /></td></tr>
<tr class="separator:ad6bc0706533b2790c66b9f0efa77c13f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a752363e4cefbc89ac4a51c85224aa88f"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interpolation_8c.html#a752363e4cefbc89ac4a51c85224aa88f">PieceWiseLinearInterpolation_Scalar</a> (const char *fieldName, PetscReal ***fieldScal, PetscInt iCell, PetscInt jCell, PetscInt kCell, PetscReal *val)</td></tr>
<tr class="memdesc:a752363e4cefbc89ac4a51c85224aa88f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieves the scalar value at the cell (iCell, jCell, kCell).  <a href="interpolation_8c.html#a752363e4cefbc89ac4a51c85224aa88f">More...</a><br /></td></tr>
<tr class="separator:a752363e4cefbc89ac4a51c85224aa88f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adf539ffe525330d518e5161d429402b1"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interpolation_8c.html#adf539ffe525330d518e5161d429402b1">PieceWiseLinearInterpolation_Vector</a> (const char *fieldName, <a class="el" href="variables_8h.html#structCmpnts">Cmpnts</a> ***fieldVec, PetscInt iCell, PetscInt jCell, PetscInt kCell, <a class="el" href="variables_8h.html#structCmpnts">Cmpnts</a> *vec)</td></tr>
<tr class="memdesc:adf539ffe525330d518e5161d429402b1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieves the vector (<a class="el" href="variables_8h.html#structCmpnts" title="A 3D point or vector with PetscScalar components.">Cmpnts</a>) at the cell (iCell, jCell, kCell).  <a href="interpolation_8c.html#adf539ffe525330d518e5161d429402b1">More...</a><br /></td></tr>
<tr class="separator:adf539ffe525330d518e5161d429402b1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abb885423e57747be4eb786faf6bb032d"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interpolation_8c.html#abb885423e57747be4eb786faf6bb032d">ComputeTrilinearWeights</a> (PetscReal a1, PetscReal a2, PetscReal a3, PetscReal *w)</td></tr>
<tr class="memdesc:abb885423e57747be4eb786faf6bb032d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Computes the trilinear Interpolatetion weights from the Interpolatetion coefficients.  <a href="interpolation_8c.html#abb885423e57747be4eb786faf6bb032d">More...</a><br /></td></tr>
<tr class="separator:abb885423e57747be4eb786faf6bb032d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a703c00f6badf5c3f0558df315a340579"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interpolation_8c.html#a703c00f6badf5c3f0558df315a340579">TrilinearInterpolation_Scalar</a> (const char *fieldName, PetscReal ***fieldScal, PetscInt i, PetscInt j, PetscInt k, PetscReal a1, PetscReal a2, PetscReal a3, PetscReal *val)</td></tr>
<tr class="memdesc:a703c00f6badf5c3f0558df315a340579"><td class="mdescLeft">&#160;</td><td class="mdescRight">Computes the trilinear Interpolateted scalar at a given point.  <a href="interpolation_8c.html#a703c00f6badf5c3f0558df315a340579">More...</a><br /></td></tr>
<tr class="separator:a703c00f6badf5c3f0558df315a340579"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4373b52d08a935bb4cf8465228effe63"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interpolation_8c.html#a4373b52d08a935bb4cf8465228effe63">TrilinearInterpolation_Vector</a> (const char *fieldName, <a class="el" href="variables_8h.html#structCmpnts">Cmpnts</a> ***fieldVec, PetscInt i, PetscInt j, PetscInt k, PetscReal a1, PetscReal a2, PetscReal a3, <a class="el" href="variables_8h.html#structCmpnts">Cmpnts</a> *vec)</td></tr>
<tr class="memdesc:a4373b52d08a935bb4cf8465228effe63"><td class="mdescLeft">&#160;</td><td class="mdescRight">Computes the trilinear Interpolateted vector (e.g., velocity) at a given point.  <a href="interpolation_8c.html#a4373b52d08a935bb4cf8465228effe63">More...</a><br /></td></tr>
<tr class="separator:a4373b52d08a935bb4cf8465228effe63"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a556572fc2b40494da8bdb48d977dbaa1"><td class="memItemLeft" align="right" valign="top">static PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interpolation_8c.html#a556572fc2b40494da8bdb48d977dbaa1">InterpolateEulerFieldToSwarmForParticle</a> (const char *fieldName, void *fieldPtr, PetscInt iCell, PetscInt jCell, PetscInt kCell, PetscReal a1, PetscReal a2, PetscReal a3, void *swarmOut, PetscInt p, PetscInt blockSize)</td></tr>
<tr class="memdesc:a556572fc2b40494da8bdb48d977dbaa1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interpolates a single field (scalar or vector) for one particle, storing the result in a swarm array.  <a href="interpolation_8c.html#a556572fc2b40494da8bdb48d977dbaa1">More...</a><br /></td></tr>
<tr class="separator:a556572fc2b40494da8bdb48d977dbaa1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad200d31b74c511e4388b757fb0359001"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interpolation_8c.html#ad200d31b74c511e4388b757fb0359001">InterpolateEulerFieldToSwarm</a> (<a class="el" href="variables_8h.html#structUserCtx">UserCtx</a> *user, Vec fieldLocal_cellCentered, const char *fieldName, const char *swarmOutFieldName)</td></tr>
<tr class="memdesc:ad200d31b74c511e4388b757fb0359001"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interpolates a cell-centered field (scalar or vector) onto DMSwarm particles, using a robust, PETSc-idiomatic two-stage process.  <a href="interpolation_8c.html#ad200d31b74c511e4388b757fb0359001">More...</a><br /></td></tr>
<tr class="separator:ad200d31b74c511e4388b757fb0359001"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a25d384c0bcf5426864f90ab568e37511"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interpolation_8c.html#a25d384c0bcf5426864f90ab568e37511">InterpolateAllFieldsToSwarm</a> (<a class="el" href="variables_8h.html#structUserCtx">UserCtx</a> *user)</td></tr>
<tr class="memdesc:a25d384c0bcf5426864f90ab568e37511"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interpolates all relevant fields from the DMDA to the DMSwarm.  <a href="interpolation_8c.html#a25d384c0bcf5426864f90ab568e37511">More...</a><br /></td></tr>
<tr class="separator:a25d384c0bcf5426864f90ab568e37511"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga16dc04f7710ac752691f269400381913"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__scatter__module__internal.html#ga16dc04f7710ac752691f269400381913">GetScatterTargetInfo</a> (<a class="el" href="variables_8h.html#structUserCtx">UserCtx</a> *user, const char *particleFieldName, DM *targetDM, PetscInt *expected_dof)</td></tr>
<tr class="memdesc:ga16dc04f7710ac752691f269400381913"><td class="mdescLeft">&#160;</td><td class="mdescRight">Determines the target Eulerian DM and expected DOF for scattering a given particle field.  <a href="group__scatter__module__internal.html#ga16dc04f7710ac752691f269400381913">More...</a><br /></td></tr>
<tr class="separator:ga16dc04f7710ac752691f269400381913"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa0d28beb3e582a9140180983a227bc1c"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__scatter__module__internal.html#gaa0d28beb3e582a9140180983a227bc1c">AccumulateParticleField</a> (DM swarm, const char *particleFieldName, DM gridSumDM, Vec gridSumVec)</td></tr>
<tr class="memdesc:gaa0d28beb3e582a9140180983a227bc1c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Accumulates a particle field (scalar or vector) into a target grid sum vector.  <a href="group__scatter__module__internal.html#gaa0d28beb3e582a9140180983a227bc1c">More...</a><br /></td></tr>
<tr class="separator:gaa0d28beb3e582a9140180983a227bc1c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga95939f29ec3dfbb729bcceee7f138958"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__scatter__module__internal.html#ga95939f29ec3dfbb729bcceee7f138958">NormalizeGridVectorByCount</a> (DM countDM, Vec countVec, DM dataDM, Vec sumVec, Vec avgVec)</td></tr>
<tr class="memdesc:ga95939f29ec3dfbb729bcceee7f138958"><td class="mdescLeft">&#160;</td><td class="mdescRight">Normalizes a grid vector of sums by a grid vector of counts to produce an average.  <a href="group__scatter__module__internal.html#ga95939f29ec3dfbb729bcceee7f138958">More...</a><br /></td></tr>
<tr class="separator:ga95939f29ec3dfbb729bcceee7f138958"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac35f52bb41ee862f912a146e86f1affd"><td class="memItemLeft" align="right" valign="top">static PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__scatter__module__internal.html#gac35f52bb41ee862f912a146e86f1affd">ScatterParticleFieldToEulerField_Internal</a> (<a class="el" href="variables_8h.html#structUserCtx">UserCtx</a> *user, const char *particleFieldName, DM targetDM, PetscInt expected_dof, Vec eulerFieldAverageVec)</td></tr>
<tr class="memdesc:gac35f52bb41ee862f912a146e86f1affd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Internal helper function to orchestrate the scatter operation (accumulate + normalize).  <a href="group__scatter__module__internal.html#gac35f52bb41ee862f912a146e86f1affd">More...</a><br /></td></tr>
<tr class="separator:gac35f52bb41ee862f912a146e86f1affd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa6642e53fe1be75dcc180dab3cf3f692"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__scatter__module.html#gaa6642e53fe1be75dcc180dab3cf3f692">ScatterParticleFieldToEulerField</a> (<a class="el" href="variables_8h.html#structUserCtx">UserCtx</a> *user, const char *particleFieldName, Vec eulerFieldAverageVec)</td></tr>
<tr class="memdesc:gaa6642e53fe1be75dcc180dab3cf3f692"><td class="mdescLeft">&#160;</td><td class="mdescRight">Scatters a particle field (scalar or vector) to the corresponding Eulerian field average.  <a href="group__scatter__module.html#gaa6642e53fe1be75dcc180dab3cf3f692">More...</a><br /></td></tr>
<tr class="separator:gaa6642e53fe1be75dcc180dab3cf3f692"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga84b852e1186804ff34e9228fab1764c6"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__scatter__module.html#ga84b852e1186804ff34e9228fab1764c6">ScatterAllParticleFieldsToEulerFields</a> (<a class="el" href="variables_8h.html#structUserCtx">UserCtx</a> *user)</td></tr>
<tr class="memdesc:ga84b852e1186804ff34e9228fab1764c6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Scatters a predefined set of particle fields to their corresponding Eulerian fields.  <a href="group__scatter__module.html#ga84b852e1186804ff34e9228fab1764c6">More...</a><br /></td></tr>
<tr class="separator:ga84b852e1186804ff34e9228fab1764c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac3e3d9d03447563e1062d257af6046d2"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interpolation_8c.html#ac3e3d9d03447563e1062d257af6046d2">InterpolateCornerToFaceCenter_Scalar</a> (PetscReal ***corner_arr, PetscReal ***faceX_arr, PetscReal ***faceY_arr, PetscReal ***faceZ_arr, <a class="el" href="variables_8h.html#structUserCtx">UserCtx</a> *user)</td></tr>
<tr class="memdesc:ac3e3d9d03447563e1062d257af6046d2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interpolates a scalar field from corner nodes to all face centers.  <a href="interpolation_8c.html#ac3e3d9d03447563e1062d257af6046d2">More...</a><br /></td></tr>
<tr class="separator:ac3e3d9d03447563e1062d257af6046d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a173e2e54a5c09762ab6868eb78889886"><td class="memItemLeft" align="right" valign="top">PetscErrorCode&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="interpolation_8c.html#a173e2e54a5c09762ab6868eb78889886">InterpolateCornerToFaceCenter_Vector</a> (<a class="el" href="variables_8h.html#structCmpnts">Cmpnts</a> ***corner_arr, <a class="el" href="variables_8h.html#structCmpnts">Cmpnts</a> ***faceX_arr, <a class="el" href="variables_8h.html#structCmpnts">Cmpnts</a> ***faceY_arr, <a class="el" href="variables_8h.html#structCmpnts">Cmpnts</a> ***faceZ_arr, <a class="el" href="variables_8h.html#structUserCtx">UserCtx</a> *user)</td></tr>
<tr class="memdesc:a173e2e54a5c09762ab6868eb78889886"><td class="mdescLeft">&#160;</td><td class="mdescRight">Interpolates a vector field from corner nodes to all face centers.  <a href="interpolation_8c.html#a173e2e54a5c09762ab6868eb78889886">More...</a><br /></td></tr>
<tr class="separator:a173e2e54a5c09762ab6868eb78889886"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a id="abec558b5f0fa2eccdaa9a7efc651e93b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abec558b5f0fa2eccdaa9a7efc651e93b">&#9670;&nbsp;</a></span>NUM_WEIGHTS</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define NUM_WEIGHTS&#160;&#160;&#160;8</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="interpolation_8c_source.html#l00013">13</a> of file <a class="el" href="interpolation_8c_source.html">interpolation.c</a>.</p>

</div>
</div>
<a id="a8a60be44abd6bcc3c5912e23b8b940c4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8a60be44abd6bcc3c5912e23b8b940c4">&#9670;&nbsp;</a></span>ERROR_MSG_BUFFER_SIZE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define ERROR_MSG_BUFFER_SIZE&#160;&#160;&#160;256</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="interpolation_8c_source.html#l00016">16</a> of file <a class="el" href="interpolation_8c_source.html">interpolation.c</a>.</p>

</div>
</div>
<a id="a1bce17babc2d6ed81dbea45d49f867c0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1bce17babc2d6ed81dbea45d49f867c0">&#9670;&nbsp;</a></span>__FUNCT <span class="overload">[1/6]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __FUNCT&#160;&#160;&#160;&quot;PiecWiseLinearInterpolation_Scalar&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="interpolation_8c_source.html#l01106">1106</a> of file <a class="el" href="interpolation_8c_source.html">interpolation.c</a>.</p>

</div>
</div>
<a id="a1bce17babc2d6ed81dbea45d49f867c0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1bce17babc2d6ed81dbea45d49f867c0">&#9670;&nbsp;</a></span>__FUNCT <span class="overload">[2/6]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __FUNCT&#160;&#160;&#160;&quot;PiecWiseLinearInterpolation_Vector&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="interpolation_8c_source.html#l01106">1106</a> of file <a class="el" href="interpolation_8c_source.html">interpolation.c</a>.</p>

</div>
</div>
<a id="a1bce17babc2d6ed81dbea45d49f867c0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1bce17babc2d6ed81dbea45d49f867c0">&#9670;&nbsp;</a></span>__FUNCT <span class="overload">[3/6]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __FUNCT&#160;&#160;&#160;&quot;ComputeTrilinearWeights&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="interpolation_8c_source.html#l01106">1106</a> of file <a class="el" href="interpolation_8c_source.html">interpolation.c</a>.</p>

</div>
</div>
<a id="a1bce17babc2d6ed81dbea45d49f867c0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1bce17babc2d6ed81dbea45d49f867c0">&#9670;&nbsp;</a></span>__FUNCT <span class="overload">[4/6]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __FUNCT&#160;&#160;&#160;&quot;TrilinearInterpolation_Scalar&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="interpolation_8c_source.html#l01106">1106</a> of file <a class="el" href="interpolation_8c_source.html">interpolation.c</a>.</p>

</div>
</div>
<a id="a1bce17babc2d6ed81dbea45d49f867c0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1bce17babc2d6ed81dbea45d49f867c0">&#9670;&nbsp;</a></span>__FUNCT <span class="overload">[5/6]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __FUNCT&#160;&#160;&#160;&quot;TrilinearInterpolation_Vector&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="interpolation_8c_source.html#l01106">1106</a> of file <a class="el" href="interpolation_8c_source.html">interpolation.c</a>.</p>

</div>
</div>
<a id="a1bce17babc2d6ed81dbea45d49f867c0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1bce17babc2d6ed81dbea45d49f867c0">&#9670;&nbsp;</a></span>__FUNCT <span class="overload">[6/6]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define __FUNCT&#160;&#160;&#160;&quot;InterpolateEulerFieldToSwarmForParticle&quot;</td>
        </tr>
      </table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="interpolation_8c_source.html#l01106">1106</a> of file <a class="el" href="interpolation_8c_source.html">interpolation.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="a1572054c1f369e31e37b0f44b04828d6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1572054c1f369e31e37b0f44b04828d6">&#9670;&nbsp;</a></span>InterpolateFieldFromCornerToCenter_Vector()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode InterpolateFieldFromCornerToCenter_Vector </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structCmpnts">Cmpnts</a> ***&#160;</td>
          <td class="paramname"><em>field_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structCmpnts">Cmpnts</a> ***&#160;</td>
          <td class="paramname"><em>centfield_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Interpolates a vector field from corner nodes to cell centers. </p>
<p>Safely interpolate a vector field from corner nodes (from the coordinate DM) to cell centers (from the cell-centered DM) using the provided <a class="el" href="variables_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a>.</p>
<p>This function estimates the value of a vector field at the center of each computational cell (whose origin node is owned by this rank) by averaging the values from the 8 corner nodes defining that cell.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">field_arr</td><td>Input: 3D array view (ghosted) of vector data at nodes, obtained from a Vec associated with user-&gt;fda. Accessed via GLOBAL node indices. Ghost values must be up-to-date. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">centfield_arr</td><td>Output: 3D local array (0-indexed) where interpolated cell center values are stored. Sized [zm_cell_local][ym_cell_local][xm_cell_local] by the caller. centfield_arr[k_loc][j_loc][i_loc] stores the value for the cell corresponding to the (i_loc, j_loc, k_loc)-th owned cell origin. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">user</td><td>User context containing DMDA information (fda, IM, JM, KM).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode 0 on success. </dd></dl>

<p class="definition">Definition at line <a class="el" href="interpolation_8c_source.html#l00039">39</a> of file <a class="el" href="interpolation_8c_source.html">interpolation.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;{</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;    PetscErrorCode ierr;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;    PetscMPIInt    rank;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;    PetscFunctionBeginUser;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    <a class="code" href="logging_8h.html#ace99f3e207ccb2e46e9b782f9e57732e">PROFILE_FUNCTION_BEGIN</a>;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160; </div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    ierr = MPI_Comm_rank(PETSC_COMM_WORLD, &amp;rank); CHKERRQ(ierr);</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <a class="code" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;                   <span class="stringliteral">&quot;Rank %d starting InterpolateFieldFromCornerToCenter_Vector.\n&quot;</span>, rank);</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160; </div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="comment">// Get local info based on the NODE-based DMDA (user-&gt;fda)</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="comment">// This DM defines the ownership of the nodes from which we interpolate,</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="comment">// and thus defines the cells whose centers we will compute.</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    DMDALocalInfo info_nodes_fda;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    ierr = DMDAGetLocalInfo(user-&gt;<a class="code" href="variables_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, &amp;info_nodes_fda); CHKERRQ(ierr);</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160; </div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="comment">// Determine owned CELL ranges based on owning their origin NODES (from user-&gt;fda)</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;    PetscInt xs_cell_global_i, xm_cell_local_i; <span class="comment">// Global start cell index, local count of owned cells</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;    PetscInt ys_cell_global_j, ym_cell_local_j;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;    PetscInt zs_cell_global_k, zm_cell_local_k;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160; </div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    </div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;    ierr = <a class="code" href="setup_8h.html#a9b17552f79ebe16d0363986217a01ff3">GetOwnedCellRange</a>(&amp;info_nodes_fda, 0, &amp;xs_cell_global_i, &amp;xm_cell_local_i); CHKERRQ(ierr);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;    ierr = <a class="code" href="setup_8h.html#a9b17552f79ebe16d0363986217a01ff3">GetOwnedCellRange</a>(&amp;info_nodes_fda, 1, &amp;ys_cell_global_j, &amp;ym_cell_local_j); CHKERRQ(ierr);</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    ierr = <a class="code" href="setup_8h.html#a9b17552f79ebe16d0363986217a01ff3">GetOwnedCellRange</a>(&amp;info_nodes_fda, 2, &amp;zs_cell_global_k, &amp;zm_cell_local_k); CHKERRQ(ierr);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160; </div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="comment">// Exclusive end global cell indices</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;    PetscInt xe_cell_global_i_excl = xs_cell_global_i + xm_cell_local_i;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    PetscInt ye_cell_global_j_excl = ys_cell_global_j + ym_cell_local_j;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    PetscInt ze_cell_global_k_excl = zs_cell_global_k + zm_cell_local_k;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160; </div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Rank %d : Processing Owned Cells (global indices) k=%d..%d (count %d), j=%d..%d (count %d), i=%d..%d (count %d)\n&quot;</span>,</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;              rank,</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;              zs_cell_global_k, ze_cell_global_k_excl -1, zm_cell_local_k,</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;              ys_cell_global_j, ye_cell_global_j_excl -1, ym_cell_local_j,</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;              xs_cell_global_i, xe_cell_global_i_excl -1, xm_cell_local_i);</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160; </div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    <span class="comment">// Loop over the GLOBAL indices of the CELLS whose origin nodes are owned by this processor</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;    <span class="comment">// (according to user-&gt;fda partitioning)</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    <span class="keywordflow">for</span> (PetscInt k_glob_cell = zs_cell_global_k; k_glob_cell &lt; ze_cell_global_k_excl; k_glob_cell++) {</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        PetscInt k_local = k_glob_cell - zs_cell_global_k; <span class="comment">// 0-based local index for centfield_arr</span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160; </div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        <span class="keywordflow">for</span> (PetscInt j_glob_cell = ys_cell_global_j; j_glob_cell &lt; ye_cell_global_j_excl; j_glob_cell++) {</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;            PetscInt j_local = j_glob_cell - ys_cell_global_j; <span class="comment">// 0-based local index</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160; </div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;            <span class="keywordflow">for</span> (PetscInt i_glob_cell = xs_cell_global_i; i_glob_cell &lt; xe_cell_global_i_excl; i_glob_cell++) {</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                PetscInt i_local = i_glob_cell - xs_cell_global_i; <span class="comment">// 0-based local index</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160; </div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                <a class="code" href="variables_8h.html#structCmpnts">Cmpnts</a> sum = {0.0, 0.0, 0.0};</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                <span class="comment">// Count is always 8 for a hexahedral cell</span></div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                <span class="comment">// PetscInt count = 0; // Not strictly needed if we assume 8 corners</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160; </div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                <span class="comment">// Loop over the 8 corner NODES that define cell C(i_glob_cell, j_glob_cell, k_glob_cell)</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                <span class="keywordflow">for</span> (PetscInt dk = 0; dk &lt; 2; dk++) {</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                    <span class="keywordflow">for</span> (PetscInt dj = 0; dj &lt; 2; dj++) {</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                        <span class="keywordflow">for</span> (PetscInt di = 0; di &lt; 2; di++) {</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                            PetscInt ni_glob = i_glob_cell + di; <span class="comment">// Global NODE index i or i+1</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                            PetscInt nj_glob = j_glob_cell + dj; <span class="comment">// Global NODE index j or j+1</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                            PetscInt nk_glob = k_glob_cell + dk; <span class="comment">// Global NODE index k or k+1</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160; </div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                            <span class="comment">// Access the input &#39;field_arr&#39; (node values) using GLOBAL node indices.</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                            <span class="comment">// Ghosts in field_arr must be valid.</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                            <span class="comment">// DMDAVecGetArrayRead handles mapping global indices to local memory.</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                            sum.<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> += field_arr[nk_glob][nj_glob][ni_glob].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                            sum.<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> += field_arr[nk_glob][nj_glob][ni_glob].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                            sum.<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> += field_arr[nk_glob][nj_glob][ni_glob].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                            <span class="comment">// count++;</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                        }</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                    }</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                }</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160; </div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                <span class="comment">// Calculate average value representing the cell center</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                <a class="code" href="variables_8h.html#structCmpnts">Cmpnts</a> center_value;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                center_value.<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = sum.<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> / 8.0;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                center_value.<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = sum.<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> / 8.0;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                center_value.<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = sum.<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> / 8.0;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160; </div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                <span class="comment">// Store result into the local, 0-indexed output array &#39;centfield_arr&#39;</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                <span class="comment">// Defensive check (should not be strictly necessary if caller allocated centfield_arr</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                <span class="comment">// with dimensions xm_cell_local_i, ym_cell_local_j, zm_cell_local_k)</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                <span class="keywordflow">if</span> (i_local &lt; 0 || i_local &gt;= xm_cell_local_i ||</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                    j_local &lt; 0 || j_local &gt;= ym_cell_local_j ||</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                    k_local &lt; 0 || k_local &gt;= zm_cell_local_k) {</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                    SETERRQ(PETSC_COMM_SELF, PETSC_ERR_PLIB, <span class="stringliteral">&quot;Local index out of bounds for centfield_arr write!&quot;</span>);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                }</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                centfield_arr[k_local][j_local][i_local] = center_value;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160; </div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;            } <span class="comment">// End loop i_glob_cell</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        } <span class="comment">// End loop j_glob_cell</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    } <span class="comment">// End loop k_glob_cell</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160; </div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <a class="code" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                   <span class="stringliteral">&quot;Rank %d completed InterpolateFieldFromCornerToCenter_Vector.\n&quot;</span>, rank);</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    </div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <a class="code" href="logging_8h.html#a5fe7257f46131945aacf9a35e9de5874">PROFILE_FUNCTION_END</a>;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160; </div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    PetscFunctionReturn(0);</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="interpolation_8c_a1572054c1f369e31e37b0f44b04828d6_cgraph.svg" width="414" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a178ae55ed2a5ace793e5ead8933d5c76"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a178ae55ed2a5ace793e5ead8933d5c76">&#9670;&nbsp;</a></span>InterpolateFieldFromCornerToCenter_Scalar()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode InterpolateFieldFromCornerToCenter_Scalar </td>
          <td>(</td>
          <td class="paramtype">PetscReal ***&#160;</td>
          <td class="paramname"><em>field_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal ***&#160;</td>
          <td class="paramname"><em>centfield_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Interpolates a scalar field from corner nodes to cell centers. </p>
<p>Safely interpolate a scalar field from corner nodes (from the coordinate DM) to cell centers (from the cell-centered DM) using the provided <a class="el" href="variables_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a>.</p>
<p>This function estimates the value of a scalar field at the center of each computational cell (whose origin node is owned by this rank) by averaging the values from the 8 corner nodes defining that cell.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">field_arr</td><td>Input: 3D array view (ghosted) of scalar data at nodes, obtained from a Vec associated with user-&gt;da. Accessed via GLOBAL node indices. Ghost values must be up-to-date. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">centfield_arr</td><td>Output: 3D local array (0-indexed) where interpolated cell center values are stored. Sized [zm_cell_local][ym_cell_local][xm_cell_local] by the caller. centfield_arr[k_loc][j_loc][i_loc] stores the value for the cell corresponding to the (i_loc, j_loc, k_loc)-th owned cell origin. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">user</td><td>User context containing DMDA information (da, IM, JM, KM).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode 0 on success. </dd></dl>

<p class="definition">Definition at line <a class="el" href="interpolation_8c_source.html#l00166">166</a> of file <a class="el" href="interpolation_8c_source.html">interpolation.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;{</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    PetscErrorCode ierr;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    PetscMPIInt    rank;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    PetscFunctionBeginUser;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <a class="code" href="logging_8h.html#ace99f3e207ccb2e46e9b782f9e57732e">PROFILE_FUNCTION_BEGIN</a>;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    ierr = MPI_Comm_rank(PETSC_COMM_WORLD, &amp;rank); CHKERRQ(ierr);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <a class="code" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                   <span class="stringliteral">&quot;Rank %d starting InterpolateFieldFromCornerToCenter_Scalar.\n&quot;</span>, rank);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160; </div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    <span class="comment">// Get local info based on user-&gt;da (which is node-based but defines cell origins)</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    DMDALocalInfo info_da_nodes;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    ierr = DMDAGetLocalInfo(user-&gt;<a class="code" href="variables_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;info_da_nodes); CHKERRQ(ierr);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160; </div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="comment">// Determine owned CELL ranges based on owning their origin NODES (from user-&gt;da)</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;    PetscInt xs_cell_global_i, xm_cell_local_i; <span class="comment">// Global start cell index, local count of owned cells</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    PetscInt ys_cell_global_j, ym_cell_local_j;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;    PetscInt zs_cell_global_k, zm_cell_local_k;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160; </div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;    ierr = <a class="code" href="setup_8h.html#a9b17552f79ebe16d0363986217a01ff3">GetOwnedCellRange</a>(&amp;info_da_nodes, 0, &amp;xs_cell_global_i, &amp;xm_cell_local_i); CHKERRQ(ierr);</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;    ierr = <a class="code" href="setup_8h.html#a9b17552f79ebe16d0363986217a01ff3">GetOwnedCellRange</a>(&amp;info_da_nodes, 1, &amp;ys_cell_global_j, &amp;ym_cell_local_j); CHKERRQ(ierr);</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    ierr = <a class="code" href="setup_8h.html#a9b17552f79ebe16d0363986217a01ff3">GetOwnedCellRange</a>(&amp;info_da_nodes, 2, &amp;zs_cell_global_k, &amp;zm_cell_local_k); CHKERRQ(ierr);</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160; </div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="comment">// Exclusive end global cell indices</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    PetscInt xe_cell_global_i_excl = xs_cell_global_i + xm_cell_local_i;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    PetscInt ye_cell_global_j_excl = ys_cell_global_j + ym_cell_local_j;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    PetscInt ze_cell_global_k_excl = zs_cell_global_k + zm_cell_local_k;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160; </div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Rank %d (IFCTCS): Processing Owned Cells (global indices) k=%d..%d (count %d), j=%d..%d (count %d), i=%d..%d (count %d)\n&quot;</span>,</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;              rank,</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;              zs_cell_global_k, ze_cell_global_k_excl -1, zm_cell_local_k,</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;              ys_cell_global_j, ye_cell_global_j_excl -1, ym_cell_local_j,</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;              xs_cell_global_i, xe_cell_global_i_excl -1, xm_cell_local_i);</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160; </div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    <span class="comment">// Loop over the GLOBAL indices of the CELLS whose origin nodes are owned by this processor</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <span class="comment">// (according to user-&gt;da partitioning)</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keywordflow">for</span> (PetscInt k_glob_cell = zs_cell_global_k; k_glob_cell &lt; ze_cell_global_k_excl; k_glob_cell++) {</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        PetscInt k_local = k_glob_cell - zs_cell_global_k; <span class="comment">// 0-based local index for centfield_arr</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160; </div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;        <span class="keywordflow">for</span> (PetscInt j_glob_cell = ys_cell_global_j; j_glob_cell &lt; ye_cell_global_j_excl; j_glob_cell++) {</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;            PetscInt j_local = j_glob_cell - ys_cell_global_j; <span class="comment">// 0-based local index</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160; </div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            <span class="keywordflow">for</span> (PetscInt i_glob_cell = xs_cell_global_i; i_glob_cell &lt; xe_cell_global_i_excl; i_glob_cell++) {</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                PetscInt i_local = i_glob_cell - xs_cell_global_i; <span class="comment">// 0-based local index</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160; </div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                PetscReal sum = 0.0;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                <span class="comment">// Count is always 8 for a hexahedral cell if all nodes are accessible</span></div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                <span class="comment">// PetscInt count = 0;</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160; </div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                <span class="comment">// Loop over the 8 NODE indices that define cell C(i_glob_cell, j_glob_cell, k_glob_cell)</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                <span class="keywordflow">for</span> (PetscInt dk = 0; dk &lt; 2; dk++) {</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                    <span class="keywordflow">for</span> (PetscInt dj = 0; dj &lt; 2; dj++) {</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                        <span class="keywordflow">for</span> (PetscInt di = 0; di &lt; 2; di++) {</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                            PetscInt ni_glob = i_glob_cell + di; <span class="comment">// Global NODE index for corner</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                            PetscInt nj_glob = j_glob_cell + dj; <span class="comment">// Global NODE index for corner</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                            PetscInt nk_glob = k_glob_cell + dk; <span class="comment">// Global NODE index for corner</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160; </div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                            <span class="comment">// Access the input &#39;field_arr&#39; (node values) using GLOBAL node indices.</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                            sum += field_arr[nk_glob][nj_glob][ni_glob];</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                            <span class="comment">// count++;</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                        }</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                    }</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                }</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160; </div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                PetscReal center_value = sum / 8.0;</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160; </div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                <span class="comment">// Store the calculated cell center value into the output array &#39;centfield_arr&#39;</span></div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                <span class="comment">// using the LOCAL 0-based cell index.</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                <span class="comment">// Defensive check (should not be strictly necessary if caller allocated centfield_arr correctly)</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                <span class="keywordflow">if</span> (i_local &lt; 0 || i_local &gt;= xm_cell_local_i ||</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                    j_local &lt; 0 || j_local &gt;= ym_cell_local_j ||</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                    k_local &lt; 0 || k_local &gt;= zm_cell_local_k) {</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                    SETERRQ(PETSC_COMM_SELF, PETSC_ERR_PLIB, <span class="stringliteral">&quot;Local index out of bounds for centfield_arr write in Scalar version!&quot;</span>);</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                }</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                centfield_arr[k_local][j_local][i_local] = center_value;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160; </div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;            } <span class="comment">// End loop i_glob_cell</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;        } <span class="comment">// End loop j_glob_cell</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;    } <span class="comment">// End loop k_glob_cell</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160; </div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    <a class="code" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                   <span class="stringliteral">&quot;Rank %d completed InterpolateFieldFromCornerToCenter_Scalar.\n&quot;</span>, rank);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;    </div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    <a class="code" href="logging_8h.html#a5fe7257f46131945aacf9a35e9de5874">PROFILE_FUNCTION_END</a>;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;              </div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    PetscFunctionReturn(0);</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="interpolation_8c_a178ae55ed2a5ace793e5ead8933d5c76_cgraph.svg" width="414" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a54b7c352fd11a3f0663c1f9d823462da"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a54b7c352fd11a3f0663c1f9d823462da">&#9670;&nbsp;</a></span>InterpolateFieldFromCenterToCorner_Scalar()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode InterpolateFieldFromCenterToCorner_Scalar </td>
          <td>(</td>
          <td class="paramtype">PetscReal ***&#160;</td>
          <td class="paramname"><em>centfield_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal ***&#160;</td>
          <td class="paramname"><em>field_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Interpolates a scalar field from cell centers to corner nodes. </p>
<p>This function estimates the value of a scalar field at each grid node by averaging the values from the cell centers of the cells surrounding that node (up to 8). It handles physical boundaries by averaging only the available adjacent cells.</p>
<p>Assumes input <code>centfield_arr</code> is from a ghosted local vector associated with <code>user-&gt;da</code> (DOF=1, s=2) and output <code>field_arr</code> is from a ghosted local vector also associated with <code>user-&gt;da</code> (DOF=1, s=2). Input array uses GLOBAL cell indices, output array uses GLOBAL node indices.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">centfield_arr</td><td>Input: 3D array (ghosted) of scalar data at cell centers, accessed via GLOBAL cell indices (k=0..KM-1, j=0..JM-1, i=0..IM-1). </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">field_arr</td><td>Output: 3D array (ghosted) where interpolated node values are stored, accessed via GLOBAL node indices (k=0..KM, j=0..JM, i=0..IM). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">user</td><td>User context containing DMDA information (da).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode 0 on success. </dd></dl>

<p class="definition">Definition at line <a class="el" href="interpolation_8c_source.html#l00281">281</a> of file <a class="el" href="interpolation_8c_source.html">interpolation.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;{</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;    PetscErrorCode ierr;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;    PetscMPIInt    rank;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160; </div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;    PetscFunctionBeginUser;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160; </div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;    <a class="code" href="logging_8h.html#ace99f3e207ccb2e46e9b782f9e57732e">PROFILE_FUNCTION_BEGIN</a>;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160; </div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;    ierr = MPI_Comm_rank(PETSC_COMM_WORLD, &amp;rank); CHKERRQ(ierr);</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;    <a class="code" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      <span class="stringliteral">&quot;Rank %d starting interpolation.\n&quot;</span>, rank);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160; </div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;    <span class="comment">// Get local info based on the DMDA (da). This info primarily describes owned nodes.</span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    DMDALocalInfo info;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;    ierr = DMDAGetLocalInfo(user-&gt;<a class="code" href="variables_8h.html#af031acb43b014d5ac788aa9003491e75">da</a>, &amp;info); CHKERRQ(ierr);</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160; </div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    <span class="comment">// Define the range of NODES owned by this processor using GLOBAL indices</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;    PetscInt xs_node = info.xs;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    PetscInt xm_node = info.xm;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    PetscInt xe_node = xs_node + xm_node;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;    PetscInt ys_node = info.ys;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    PetscInt ym_node = info.ym;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    PetscInt ye_node = ys_node + ym_node;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    PetscInt zs_node = info.zs;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    PetscInt zm_node = info.zm;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    PetscInt ze_node = zs_node + zm_node;</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160; </div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <span class="comment">// Get Global dimensions (number of cells IM, JM, KM)</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    PetscInt IM = info.mx - 1;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;    PetscInt JM = info.my - 1;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;    PetscInt KM = info.mz - 1;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160; </div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160; </div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Rank %d: Interpolating for owned NODES k=%d..%d, j=%d..%d, i=%d..%d\n&quot;</span>,</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;              rank, zs_node, ze_node, ys_node, ye_node, xs_node, xe_node);</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160; </div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <span class="comment">// Loop over the GLOBAL indices of the NODES owned by this processor</span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    <span class="keywordflow">for</span> (PetscInt k = zs_node; k &lt; ze_node; k++) { <span class="comment">// Global NODE index k (0..KM)</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;        <span class="keywordflow">for</span> (PetscInt j = ys_node; j &lt; ye_node; j++) { <span class="comment">// Global NODE index j (0..JM)</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;            <span class="keywordflow">for</span> (PetscInt i = xs_node; i &lt; xe_node; i++) { <span class="comment">// Global NODE index i (0..IM)</span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160; </div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;                PetscReal sum = 0.0;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                PetscInt count = 0;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160; </div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;                <span class="comment">// Loop over the potential 8 CELL indices surrounding node (i,j,k)</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;                <span class="comment">// Cell indices are (i &amp; i-1), (j &amp; j-1), (k &amp; k-1)</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;                <span class="keywordflow">for</span> (PetscInt dk = -1; dk &lt;= 0; dk++) { <span class="comment">// Relative cell k-index offset</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                    <span class="keywordflow">for</span> (PetscInt dj = -1; dj &lt;= 0; dj++) { <span class="comment">// Relative cell j-index offset</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                        <span class="keywordflow">for</span> (PetscInt di = -1; di &lt;= 0; di++) { <span class="comment">// Relative cell i-index offset</span></div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160; </div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                            PetscInt ci = i + di; <span class="comment">// Global CELL index of neighbor</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                            PetscInt cj = j + dj; <span class="comment">// Global CELL index of neighbor</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                            PetscInt ck = k + dk; <span class="comment">// Global CELL index of neighbor</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160; </div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                            <span class="comment">// Check if this CELL index is within the valid global cell range (0..IM-1, etc.)</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                            <span class="keywordflow">if</span> (ci &gt;= 0 &amp;&amp; ci &lt;= IM-1 &amp;&amp;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                                cj &gt;= 0 &amp;&amp; cj &lt;= JM-1 &amp;&amp;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                                ck &gt;= 0 &amp;&amp; ck &lt;= KM-1)</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                            {</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                                <span class="comment">// Access the input &#39;centfield_arr&#39; using GLOBAL cell indices.</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                                <span class="comment">// Relies on centfield_arr being from a ghosted local vector.</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                                sum += centfield_arr[ck][cj][ci];</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                                count++;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                                <span class="comment">// Optional Debug Log</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                                <span class="comment">// LOG_LOOP_ALLOW(GLOBAL, LOG_DEBUG, i*j*k, 10000,</span></div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;                                <span class="comment">// &quot; Rank %d | Node(i,j,k)=%d,%d,%d | Using Cell(ci,cj,ck)=%d,%d,%d | Value=%.3f | Count=%d\n&quot;,</span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                                <span class="comment">// rank, i, j, k, ci, cj, ck, centfield_arr[ck][cj][ci], count);</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                            }</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                        } <span class="comment">// end di loop</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                    } <span class="comment">// end dj loop</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                } <span class="comment">// end dk loop</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160; </div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                <span class="comment">// Calculate average and store in the output &#39;field_arr&#39; at the NODE index (i,j,k)</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                <span class="keywordflow">if</span> (count &gt; 0) {</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                    <span class="comment">// Store the result using the GLOBAL node index [k][j][i]</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                    field_arr[k][j][i] = sum / (PetscReal)count;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                    <span class="comment">// This indicates an issue - a node should always be adjacent to at least one cell</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                    <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>,</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                              <span class="stringliteral">&quot;Rank %d: Node (i=%d,j=%d,k=%d) had count=0 surrounding cells! Check logic/ghosting.\n&quot;</span>, rank, i, j, k);</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                    <span class="comment">// Assign a default value or handle error</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                    field_arr[k][j][i] = 0.0; <span class="comment">// Defaulting to zero might hide issues</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                }</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;            } <span class="comment">// End loop i (nodes)</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        } <span class="comment">// End loop j (nodes)</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    } <span class="comment">// End loop k (nodes)</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160; </div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <a class="code" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;              <span class="stringliteral">&quot;Rank %d completed interpolation.\n&quot;</span>, rank);</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;    </div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    </div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <a class="code" href="logging_8h.html#a5fe7257f46131945aacf9a35e9de5874">PROFILE_FUNCTION_END</a>;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160; </div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;    PetscFunctionReturn(0);</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a8e20ad6b773e06f8cc29773322297095"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8e20ad6b773e06f8cc29773322297095">&#9670;&nbsp;</a></span>InterpolateFieldFromCenterToCorner_Vector()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode InterpolateFieldFromCenterToCorner_Vector </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structCmpnts">Cmpnts</a> ***&#160;</td>
          <td class="paramname"><em>centfield_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structCmpnts">Cmpnts</a> ***&#160;</td>
          <td class="paramname"><em>field_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Interpolates a vector field from cell centers to corner nodes. </p>
<p>This function estimates the value of a vector field at each grid node by averaging the vector values from the cell centers of the cells surrounding that node (up to 8). It handles physical boundaries by averaging only the available adjacent cells.</p>
<p>Assumes input <code>centfield_arr</code> is from a ghosted local vector (e.g., representing ucat, stored using node-indexing convention) and output <code>field_arr</code> is a ghosted local vector associated with <code>user-&gt;fda</code> (DOF=3, s=2), accessed using global node indices.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">centfield_arr</td><td>Input: 3D array (ghosted) of vector data conceptually at cell centers, accessed via GLOBAL indices respecting the storage convention (e.g., <code>ucat[k][j][i]</code> uses node index <code>i</code> but represents cell <code>C(i,j,k)</code> for interior). </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">field_arr</td><td>Output: 3D array (ghosted) where interpolated node values are stored, accessed via GLOBAL node indices (k=0..KM, j=0..JM, i=0..IM). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">user</td><td>User context containing DMDA information (da and fda).</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode 0 on success. </dd></dl>

<p class="definition">Definition at line <a class="el" href="interpolation_8c_source.html#l00408">408</a> of file <a class="el" href="interpolation_8c_source.html">interpolation.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;{</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;    PetscErrorCode ierr;</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;    PetscMPIInt    rank;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    PetscFunctionBeginUser;</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <a class="code" href="logging_8h.html#ace99f3e207ccb2e46e9b782f9e57732e">PROFILE_FUNCTION_BEGIN</a>;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160; </div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;    ierr = MPI_Comm_rank(PETSC_COMM_WORLD, &amp;rank); CHKERRQ(ierr);</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160; </div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    DMDALocalInfo info_nodes;</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    ierr = DMDAGetLocalInfo(user-&gt;<a class="code" href="variables_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, &amp;info_nodes); CHKERRQ(ierr);</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160; </div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <span class="comment">// Node ownership range (GLOBAL indices)</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    PetscInt xs_node = info_nodes.xs, xm_node = info_nodes.xm, xe_node = xs_node + xm_node;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;    PetscInt ys_node = info_nodes.ys, ym_node = info_nodes.ym, ye_node = ys_node + ym_node;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;    PetscInt zs_node = info_nodes.zs, zm_node = info_nodes.zm, ze_node = zs_node + zm_node;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160; </div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;    <span class="comment">// Global grid dimensions (NODES) - Used for global cell index check</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    PetscInt MX_node = user-&gt;<a class="code" href="variables_8h.html#ad1904cdee33ebeffba809c883f7e9641">IM</a>; <span class="comment">//info_nodes.mx;</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;    PetscInt MY_node = user-&gt;<a class="code" href="variables_8h.html#aa55a2a246e904b3569075eb4de0092a6">JM</a>; <span class="comment">//info_nodes.my;</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;    PetscInt MZ_node = user-&gt;<a class="code" href="variables_8h.html#a3f5ec0e4536c9ccaa3d663f14d47f904">KM</a>; <span class="comment">//info_nodes.mz;</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;    PetscInt IM = MX_node - 1; <span class="comment">// Max cell index i</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;    PetscInt JM = MY_node - 1; <span class="comment">// Max cell index j</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;    PetscInt KM = MZ_node - 1; <span class="comment">// Max cell index k</span></div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160; </div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160; </div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    <span class="comment">// Valid range for accessing the INPUT ghosted array (using NODE indices)</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    PetscInt gxs_node = info_nodes.gxs, gxm_node = info_nodes.gxm, gxe_node = gxs_node + gxm_node;</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;    PetscInt gys_node = info_nodes.gys, gym_node = info_nodes.gym, gye_node = gys_node + gym_node;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    PetscInt gzs_node = info_nodes.gzs, gzm_node = info_nodes.gzm, gze_node = gzs_node + gzm_node;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160; </div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;    <span class="comment">// Log only if this function is allowed by the list set in main()</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Rank %d: Interpolating for owned NODES k=%d..%d, j=%d..%d, i=%d..%d\n&quot;</span>,</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;              rank, zs_node, ze_node-1, ys_node, ye_node-1, xs_node, xe_node-1);</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160; </div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>,<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;[%d] Dumping DM state (user-&gt;fda) BEFORE GetArray:\n&quot;</span>, rank);</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160; </div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    </div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="logging_8h.html#a9585f583c260f40a73f2490914edc689">get_log_level</a>() == <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a> &amp;&amp; <a class="code" href="logging_8h.html#a2358badbcda33fc9d80ebd6a59d2a2cd">is_function_allowed</a>(__func__)){</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    DMView(user-&gt;<a class="code" href="variables_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, PETSC_VIEWER_STDOUT_SELF);</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <span class="comment">// Inside InterpolateFieldFromCenterToCorner_Vector, before the loops:</span></div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    </div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    PetscMPIInt    rank_check;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    MPI_Comm_rank(PETSC_COMM_WORLD, &amp;rank_check);</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="keywordflow">if</span> (rank_check == 1) { <span class="comment">// Only for Rank 1</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;      <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;[1] Attempting test read of OWNED INTERIOR centfield_arr[3][1][1]\n&quot;</span>);</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;      <a class="code" href="variables_8h.html#structCmpnts">Cmpnts</a> test_val_owned_interior = centfield_arr[7][1][1];</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;      <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;[1] SUCCESS reading owned interior: x=%f\n&quot;</span>, test_val_owned_interior.<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>);</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;      </div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;      <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;[1] Attempting test read of OWNED BOUNDARY centfield_arr[3][0][0]\n&quot;</span>);</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;      <a class="code" href="variables_8h.html#structCmpnts">Cmpnts</a> test_val_owned_boundary = centfield_arr[7][0][0];</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;      <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;[1] SUCCESS reading owned boundary: x=%f\n&quot;</span>, test_val_owned_boundary.<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>);</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160; </div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;      <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;[1] Attempting test read of GHOST centfield_arr[2][0][0]\n&quot;</span>);</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;      <a class="code" href="variables_8h.html#structCmpnts">Cmpnts</a> test_val_ghost = centfield_arr[7][0][0]; <span class="comment">// This is the line that likely crashes</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;      <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;[1] SUCCESS reading ghost: x=%f\n&quot;</span>, test_val_ghost.<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>);</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;      </div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;      }</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;    }</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160; </div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    ierr =  PetscBarrier(NULL);    </div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    </div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    <span class="comment">// Proceed with the original loops...</span></div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;    <span class="comment">// Loop over the GLOBAL indices of the NODES owned by this processor (k, j, i)</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;    <span class="keywordflow">for</span> (PetscInt k = zs_node; k &lt; ze_node; k++) {</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;        <span class="keywordflow">for</span> (PetscInt j = ys_node; j &lt; ye_node; j++) {</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;            <span class="keywordflow">for</span> (PetscInt i = xs_node; i &lt; xe_node; i++) {</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;          <span class="comment">/*</span></div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="comment">              if(get_log_level() == LOG_DEBUG &amp;&amp; is_function_allowed(__func__)){</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="comment">          // --- TEMPORARY TEST --- WORKS ONLY WHEN IM,JM,KM=5 !!!</span></div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="comment">          if (rank == 1 &amp;&amp; k == 3 &amp;&amp; j == 0 &amp;&amp; i == 0) {</span></div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;<span class="comment">        LOG_ALLOW(GLOBAL,LOG_DEBUG, &quot;[1] Test read inside loop for (3,0,0): Accessing centfield_arr[2][0][0]\n&quot;);</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;<span class="comment">        Cmpnts test_val_loop = centfield_arr[2][0][0]; // The crashing access</span></div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;<span class="comment">        LOG_ALLOW(GLOBAL,LOG_DEBUG, &quot;[1] Test read inside loop SUCCESS: x=%f\n&quot;, test_val_loop.x);</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;<span class="comment">            }</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;<span class="comment">          // --- END TEMPORARY TEST ---</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;<span class="comment">          }</span></div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;<span class="comment">          */</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;          </div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                <a class="code" href="variables_8h.html#structCmpnts">Cmpnts</a> sum = {0.0, 0.0, 0.0};</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                PetscInt count = 0;</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                PetscBool attempted_read = PETSC_FALSE; <span class="comment">// Flag to track if read was tried</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160; </div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                <span class="comment">// Loop over the 8 potential cells surrounding node N(k,j,i)</span></div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                <span class="keywordflow">for</span> (PetscInt dk_offset = -1; dk_offset &lt;= 0; dk_offset++) {</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                    <span class="keywordflow">for</span> (PetscInt dj_offset = -1; dj_offset &lt;= 0; dj_offset++) {</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                        <span class="keywordflow">for</span> (PetscInt di_offset = -1; di_offset &lt;= 0; di_offset++) {</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160; </div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                            <span class="comment">// Calculate the NODE index where the relevant cell&#39;s data is stored</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                            PetscInt node_idx_k = k + dk_offset;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                            PetscInt node_idx_j = j + dj_offset;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                            PetscInt node_idx_i = i + di_offset;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160; </div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;                </div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;                            <span class="comment">// Check if this NODE index corresponds to a valid GLOBAL cell index</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;                            PetscInt cell_idx_k = node_idx_k; <span class="comment">// Cell index is same as node index for storage</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                            PetscInt cell_idx_j = node_idx_j;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                            PetscInt cell_idx_i = node_idx_i;</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                </div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160; </div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                </div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;                            <span class="keywordflow">if</span> (cell_idx_i &gt;= 0 &amp;&amp; cell_idx_i &lt;= MX_node &amp;&amp; <span class="comment">// Cell index check</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                                cell_idx_j &gt;= 0 &amp;&amp; cell_idx_j &lt;= MY_node &amp;&amp;</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                                cell_idx_k &gt;= 0 &amp;&amp; cell_idx_k &lt;= MZ_node)</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                            {</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;                            </div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;                  <span class="comment">/*</span></div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;<span class="comment">                // Check if this NODE index is valid within the GLOBAL node domain (0..Mx-1)</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;<span class="comment">                            // This implicitly checks if the corresponding cell is valid (0..Mx-2)</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;<span class="comment">                            if (node_idx_i &gt;= 0 &amp;&amp; node_idx_i &lt; MX_node -1 &amp;&amp;</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;<span class="comment">                                node_idx_j &gt;= 0 &amp;&amp; node_idx_j &lt; MY_node -1 &amp;&amp;</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;<span class="comment">                                node_idx_k &gt;= 0 &amp;&amp; node_idx_k &lt; MZ_node -1)</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;<span class="comment">                            {</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;<span class="comment">                */</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;                  </div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;                <span class="comment">// Check if the NODE index is within the accessible LOCAL+GHOST range of centfield_arr</span></div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;                                <span class="keywordflow">if</span> (node_idx_i &gt;= gxs_node &amp;&amp; node_idx_i &lt; gxe_node &amp;&amp;</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;                                    node_idx_j &gt;= gys_node &amp;&amp; node_idx_j &lt; gye_node &amp;&amp;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;                                    node_idx_k &gt;= gzs_node &amp;&amp; node_idx_k &lt; gze_node)</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;                                {</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                                    <span class="comment">// Log attempt just before read</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                  <a class="code" href="logging_8h.html#aa987297fa072943c2409f3b2cc4e31f9">LOG_LOOP_ALLOW_EXACT</a>(<a class="code" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,k,6,<span class="stringliteral">&quot;PRE-READ: Rank %d targeting Node(k,j,i)=%d,%d,%d. Reading input centfield_arr[%d][%d][%d] (for cell C(%d,%d,%d))\n&quot;</span>,</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                          rank,</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                          k,j,i,</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;                          node_idx_k,node_idx_j,node_idx_i,</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;                          cell_idx_k, cell_idx_j, cell_idx_i);</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160; </div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                    attempted_read = PETSC_TRUE; <span class="comment">// Mark that we are attempting a read</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                                    </div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;                                    <span class="comment">// Convert GLOBAL neighbor index to LOCAL index for reading from the ghosted array</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                                    PetscInt k_local_read = node_idx_k - gzs_node;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;                                    PetscInt j_local_read = node_idx_j - gys_node;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                                    PetscInt i_local_read = node_idx_i - gxs_node;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                                    <span class="comment">// ---&gt; READ &lt;---</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;                                    <a class="code" href="variables_8h.html#structCmpnts">Cmpnts</a> cell_val = centfield_arr[k_local_read][j_local_read][i_local_read];</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="comment">//                                  Cmpnts cell_val = centfield_arr[node_idx_k][node_idx_j][node_idx_i];</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160; </div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;                                    <span class="comment">// Log success immediately after read</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                                    <a class="code" href="logging_8h.html#aa987297fa072943c2409f3b2cc4e31f9">LOG_LOOP_ALLOW_EXACT</a>(<a class="code" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,k,6,<span class="stringliteral">&quot;POST-READ: Rank %d successful read from [%d][%d][%d] -&gt; (%.2f, %.2f, %.2f)\n&quot;</span>,</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                          rank,</div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                          node_idx_k,node_idx_j,node_idx_i,</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                          cell_val.<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>, cell_val.<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>, cell_val.<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160; </div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;                                    sum.<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> += cell_val.<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;                                    sum.<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> += cell_val.<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;                                    sum.<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> += cell_val.<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;                                    count++;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160; </div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                                     <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a8f6fe15bfe15104da6d1b360194a5400">LOG_WARNING</a>, <span class="comment">/* ... Ghost range warning ... */</span>);</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                                }</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                            } <span class="comment">// end global cell check</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                        } <span class="comment">// end di_offset</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                    } <span class="comment">// end dj_offset</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                } <span class="comment">// end dk_offset</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160; </div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;        <span class="comment">// ---&gt; Convert GLOBAL node indices (k,j,i) to LOCAL indices for field_arr &lt;---</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;        <span class="comment">// field_arr is dimensioned nx * ny * nz (local node dimensions)</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;        <span class="comment">// Global indices (k,j,i) range from (zs,ys,xs) to (ze-1, ye-1, xe-1)</span></div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        <span class="comment">// Local indices range from 0 to (zm-1, ym-1, xm-1)</span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        PetscInt k_local = k - zs_node; <span class="comment">// Offset by the starting global index</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        PetscInt j_local = j - ys_node;</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        PetscInt i_local = i - xs_node;</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;                <span class="comment">// Calculate average and write to output node (k,j,i)</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                <span class="keywordflow">if</span> (count &gt; 0) {</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;          <a class="code" href="logging_8h.html#aa987297fa072943c2409f3b2cc4e31f9">LOG_LOOP_ALLOW_EXACT</a>(<a class="code" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,k,6,<span class="stringliteral">&quot;PRE-WRITE: Rank %d targeting Node(k,j,i)=%d,%d,%d. Writing avg (count=%d)\n&quot;</span>, rank,k,j,i, count);</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160; </div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                     <span class="comment">// --- Defensive check (optional but recommended) ---</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;                     <span class="keywordflow">if</span> (k_local &lt; 0 || k_local &gt;= info_nodes.zm ||</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;                         j_local &lt; 0 || j_local &gt;= info_nodes.ym ||</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;                         i_local &lt; 0 || i_local &gt;= info_nodes.xm) {</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;               SETERRQ(PETSC_COMM_SELF, PETSC_ERR_PLIB, <span class="stringliteral">&quot;Calculated local write index out of bounds!&quot;</span>);</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;                     }</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                     <span class="comment">// --- End check ---</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160; </div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                     <span class="comment">// ---&gt; Write using LOCAL indices &lt;---</span></div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                     field_arr[k_local][j_local][i_local].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = sum.<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> / (PetscReal)count;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                     field_arr[k_local][j_local][i_local].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = sum.<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> / (PetscReal)count;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                     field_arr[k_local][j_local][i_local].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = sum.<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> / (PetscReal)count;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160; </div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                     <a class="code" href="logging_8h.html#aa987297fa072943c2409f3b2cc4e31f9">LOG_LOOP_ALLOW_EXACT</a>(<a class="code" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,k,6,<span class="stringliteral">&quot;POST-WRITE: Rank %d successful write to field_arr[%d][%d][%d] (local)\n&quot;</span>, rank, k_local,j_local,i_local); <span class="comment">// Log local indices</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160; </div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;             </div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160; </div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;                     <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a8f6fe15bfe15104da6d1b360194a5400">LOG_WARNING</a>, <span class="comment">// Use WARNING or ERROR</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;                               <span class="stringliteral">&quot;Rank %d: Node (i=%d,j=%d,k=%d) had count=0 surrounding valid cells! Check logic/ghosting. Writing zero.\n&quot;</span>, rank, i, j, k);</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;                     field_arr[k_local][j_local][i_local] = (<a class="code" href="variables_8h.html#abe7f60605e135192ee23df40cf5d7766">Cmpnts</a>){0.0, 0.0, 0.0};</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;                }</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;                 <span class="comment">// Add a log entry even if count=0 or no read was attempted for this node</span></div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                 <span class="keywordflow">if</span> (!attempted_read &amp;&amp; count==0) {</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                     <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,<span class="stringliteral">&quot;NODE-COMPLETE: Rank %d Node(k,j,i)=%d,%d,%d finished loops, no valid cells/reads attempted.\n&quot;</span>, rank, k, j, i);</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (count == 0 &amp;&amp; attempted_read) {</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                     <span class="comment">// This case should ideally not happen if the ghost region check is correct</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                      <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a>,<span class="stringliteral">&quot;NODE-COMPLETE: Rank %d Node(k,j,i)=%d,%d,%d finished loops, attempted reads but count=0!\n&quot;</span>, rank, k, j, i);</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                 } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;                     <span class="comment">// This is the normal completion case after writing</span></div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;           <a class="code" href="logging_8h.html#aa987297fa072943c2409f3b2cc4e31f9">LOG_LOOP_ALLOW_EXACT</a>(<a class="code" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,k,6,<span class="stringliteral">&quot;NODE-COMPLETE: Rank %d Node(k,j,i)=%d,%d,%d finished loops and write.\n&quot;</span>, rank, k, j, i);</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                 }</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160; </div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;            } <span class="comment">// End loop node i</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        } <span class="comment">// End loop node j</span></div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;    } <span class="comment">// End loop node k</span></div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160; </div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;    <a class="code" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="comment">// Use INFO for completion</span></div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;              <span class="stringliteral">&quot;Rank %d completed interpolation function.\n&quot;</span>, rank); <span class="comment">// Changed message slightly</span></div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;    </div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    <a class="code" href="logging_8h.html#a5fe7257f46131945aacf9a35e9de5874">PROFILE_FUNCTION_END</a>;</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;              </div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;    PetscFunctionReturn(0);</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="interpolation_8c_a8e20ad6b773e06f8cc29773322297095_cgraph.svg" width="408" height="88"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a6ee27d5d1f4d8e21ce1369bd25372e3f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6ee27d5d1f4d8e21ce1369bd25372e3f">&#9670;&nbsp;</a></span>InterpolateFieldFromCenterToCorner_Vector_Petsc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode InterpolateFieldFromCenterToCorner_Vector_Petsc </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structCmpnts">Cmpnts</a> ***&#160;</td>
          <td class="paramname"><em>centfield_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structCmpnts">Cmpnts</a> ***&#160;</td>
          <td class="paramname"><em>corner_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Interpolates a vector field from cell centers to corner nodes. </p>
<p>This version is adapted to write directly into a ghosted local array obtained from DMDAVecGetArray(), which allows using GLOBAL indices for writing to the OWNED portion of the array.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">centfield_arr</td><td>Input: 3D array (ghosted) of cell-centered data, accessed via GLOBAL indices. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">corner_arr</td><td>Output: 3D array (ghosted) where interpolated node values are stored, also accessed via GLOBAL indices for the owned part. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">user</td><td>User context containing DMDA information.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode 0 on success. </dd></dl>

<p class="definition">Definition at line <a class="el" href="interpolation_8c_source.html#l00638">638</a> of file <a class="el" href="interpolation_8c_source.html">interpolation.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;{</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    PetscErrorCode ierr;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    DMDALocalInfo  info_nodes;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;    PetscMPIInt    rank;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <a class="code" href="logging_8h.html#ace99f3e207ccb2e46e9b782f9e57732e">PROFILE_FUNCTION_BEGIN</a>;</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    ierr = MPI_Comm_rank(PETSC_COMM_WORLD,&amp;rank);</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    ierr = DMDAGetLocalInfo(user-&gt;<a class="code" href="variables_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, &amp;info_nodes); CHKERRQ(ierr);</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160; </div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <span class="comment">// Node ownership range (GLOBAL indices)</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    PetscInt xs_node = info_nodes.xs, xm_node = info_nodes.xm, xe_node = xs_node + xm_node;</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    PetscInt ys_node = info_nodes.ys, ym_node = info_nodes.ym, ye_node = ys_node + ym_node;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    PetscInt zs_node = info_nodes.zs, zm_node = info_nodes.zm, ze_node = zs_node + zm_node;</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160; </div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    <span class="comment">// Global grid dimensions (used for valid cell check)</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    PetscInt IM = info_nodes.mx; <span class="comment">// Total nodes in i-direction</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    PetscInt JM = info_nodes.my; <span class="comment">// Total nodes in j-direction</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;    PetscInt KM = info_nodes.mz; <span class="comment">// Total nodes in k-direction</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160; </div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <span class="comment">// Ghosted array starting indices (from the same info struct)</span></div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    PetscInt gxs = info_nodes.gxs;</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    PetscInt gys = info_nodes.gys;</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    PetscInt gzs = info_nodes.gzs;</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160; </div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    <span class="comment">// Loop over the GLOBAL indices of the NODES owned by this processor</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    <span class="keywordflow">for</span> (PetscInt k = zs_node; k &lt; ze_node; k++) {</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        <span class="keywordflow">for</span> (PetscInt j = ys_node; j &lt; ye_node; j++) {</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;            <span class="keywordflow">for</span> (PetscInt i = xs_node; i &lt; xe_node; i++) {</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                <a class="code" href="variables_8h.html#structCmpnts">Cmpnts</a> sum = {0.0, 0.0, 0.0};</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                PetscInt count = 0;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;        </div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                <span class="comment">// Loop over the 8 potential cells surrounding node N(k,j,i)</span></div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                <span class="keywordflow">for</span> (PetscInt dk_offset = -1; dk_offset &lt;= 0; dk_offset++) {</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                    <span class="keywordflow">for</span> (PetscInt dj_offset = -1; dj_offset &lt;= 0; dj_offset++) {</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                        <span class="keywordflow">for</span> (PetscInt di_offset = -1; di_offset &lt;= 0; di_offset++) {</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160; </div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;                <span class="comment">// These are still GLOBAL cell indices</span></div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;                            PetscInt global_cell_k = k + dk_offset;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;                            PetscInt global_cell_j = j + dj_offset;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;                            PetscInt global_cell_i = i + di_offset;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160; </div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;                            <span class="comment">// Check if this corresponds to a valid GLOBAL cell index</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;                            <span class="keywordflow">if</span> (global_cell_i &gt;= 0 &amp;&amp; global_cell_i &lt; IM - 1 &amp;&amp;</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;                                global_cell_j &gt;= 0 &amp;&amp; global_cell_j &lt; JM - 1 &amp;&amp;</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;                                global_cell_k &gt;= 0 &amp;&amp; global_cell_k &lt; KM - 1)</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;                            {</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;                  </div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;                                <span class="comment">// Now, read from the local array using the local index</span></div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;                                <a class="code" href="variables_8h.html#structCmpnts">Cmpnts</a> cell_val = centfield_arr[global_cell_k][global_cell_j][global_cell_i];</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160; </div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;                <a class="code" href="logging_8h.html#aa987297fa072943c2409f3b2cc4e31f9">LOG_LOOP_ALLOW_EXACT</a>(<a class="code" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,k,6,<span class="stringliteral">&quot;[Rank %d] successful read from [%d][%d][%d] -&gt; (%.2f, %.2f, %.2f)\n&quot;</span>,</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                             rank,global_cell_k,global_cell_j,global_cell_i,cell_val.<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>, cell_val.<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>, cell_val.<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;                </div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                                sum.<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> += cell_val.<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;                                sum.<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> += cell_val.<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;                                sum.<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> += cell_val.<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                                count++;</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;                            }</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;                        }</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                    }</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;                }</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160; </div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                <span class="comment">// --- MODIFICATION: Write using GLOBAL indices ---</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;                <span class="comment">// The calculation of i_local, j_local, k_local is removed.</span></div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;                <span class="comment">// We write directly into the array using the global loop indices.</span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;                <span class="keywordflow">if</span> (count &gt; 0) {</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;                    corner_arr[k][j][i].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = sum.<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> / (PetscReal)count;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;                    corner_arr[k][j][i].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = sum.<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> / (PetscReal)count;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;                    corner_arr[k][j][i].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = sum.<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> / (PetscReal)count;</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;                    <span class="comment">// This case should ideally not happen for a valid owned node, but as a failsafe:</span></div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;                    corner_arr[k][j][i] = (<a class="code" href="variables_8h.html#abe7f60605e135192ee23df40cf5d7766">Cmpnts</a>){0.0, 0.0, 0.0};</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;                }</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160; </div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        <a class="code" href="logging_8h.html#aa987297fa072943c2409f3b2cc4e31f9">LOG_LOOP_ALLOW_EXACT</a>(<a class="code" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,k,6,<span class="stringliteral">&quot;[Rank %d] Node(k,j,i)=%d,%d,%d finished loops and write.\n&quot;</span>, rank, k, j, i);</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;            }</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;        }</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    }</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    <a class="code" href="logging_8h.html#a5fe7257f46131945aacf9a35e9de5874">PROFILE_FUNCTION_END</a>;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="ad6bc0706533b2790c66b9f0efa77c13f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad6bc0706533b2790c66b9f0efa77c13f">&#9670;&nbsp;</a></span>InterpolateFieldFromCenterToCorner_Scalar_Petsc()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode InterpolateFieldFromCenterToCorner_Scalar_Petsc </td>
          <td>(</td>
          <td class="paramtype">PetscReal ***&#160;</td>
          <td class="paramname"><em>centfield_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal ***&#160;</td>
          <td class="paramname"><em>corner_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Interpolates a scalar field from cell centers to corner nodes. </p>
<p>This version is adapted to write directly into a ghosted local array obtained from DMDAVecGetArray(), which allows using GLOBAL indices for writing to the OWNED portion of the array.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">centfield_arr</td><td>Input: 3D array (ghosted) of scalar data at cell centers, accessed via GLOBAL indices. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">corner_arr</td><td>Output: 3D array (ghosted) where interpolated node values are stored, also accessed via GLOBAL indices for the owned part. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">user</td><td>User context containing DMDA information.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode 0 on success. </dd></dl>

<p class="definition">Definition at line <a class="el" href="interpolation_8c_source.html#l00739">739</a> of file <a class="el" href="interpolation_8c_source.html">interpolation.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;{</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    PetscErrorCode ierr;</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;    DMDALocalInfo  info_nodes;</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    <a class="code" href="logging_8h.html#ace99f3e207ccb2e46e9b782f9e57732e">PROFILE_FUNCTION_BEGIN</a>;</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    ierr = DMDAGetLocalInfo(user-&gt;<a class="code" href="variables_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, &amp;info_nodes); CHKERRQ(ierr);</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160; </div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;    <span class="comment">// Node ownership range (GLOBAL indices)</span></div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    PetscInt xs_node = info_nodes.xs, xe_node = info_nodes.xs + info_nodes.xm;</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;    PetscInt ys_node = info_nodes.ys, ye_node = info_nodes.ys + info_nodes.ym;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;    PetscInt zs_node = info_nodes.zs, ze_node = info_nodes.zs + info_nodes.zm;</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160; </div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;    <span class="comment">// Global grid dimensions (number of nodes)</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;    PetscInt IM = info_nodes.mx;</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    PetscInt JM = info_nodes.my;</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;    PetscInt KM = info_nodes.mz;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160; </div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    <span class="comment">// Loop over the GLOBAL indices of the NODES owned by this processor</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    <span class="keywordflow">for</span> (PetscInt k = zs_node; k &lt; ze_node; k++) {</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        <span class="keywordflow">for</span> (PetscInt j = ys_node; j &lt; ye_node; j++) {</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;            <span class="keywordflow">for</span> (PetscInt i = xs_node; i &lt; xe_node; i++) {</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;                PetscReal sum = 0.0;</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;                PetscInt count = 0;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160; </div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;                <span class="comment">// Loop over the 8 potential cells surrounding node N(k,j,i)</span></div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;                <span class="keywordflow">for</span> (PetscInt dk_offset = -1; dk_offset &lt;= 0; dk_offset++) {</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;                    <span class="keywordflow">for</span> (PetscInt dj_offset = -1; dj_offset &lt;= 0; dj_offset++) {</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                        <span class="keywordflow">for</span> (PetscInt di_offset = -1; di_offset &lt;= 0; di_offset++) {</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;                            <span class="comment">// This is the global index of the cell-centered data point</span></div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;                            PetscInt cell_idx_k = k + dk_offset;</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;                            PetscInt cell_idx_j = j + dj_offset;</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;                            PetscInt cell_idx_i = i + di_offset;</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160; </div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;                            <span class="comment">// Check if this corresponds to a valid GLOBAL cell index.</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;                            <span class="comment">// Cell indices run from 0 to NumberOfNodes-2.</span></div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;                            <span class="keywordflow">if</span> (cell_idx_i &gt;= 0 &amp;&amp; cell_idx_i &lt; IM - 1 &amp;&amp;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;                                cell_idx_j &gt;= 0 &amp;&amp; cell_idx_j &lt; JM - 1 &amp;&amp;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;                                cell_idx_k &gt;= 0 &amp;&amp; cell_idx_k &lt; KM - 1)</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;                            {</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;                                sum += centfield_arr[cell_idx_k][cell_idx_j][cell_idx_i];</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;                                count++;</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;                            }</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;                        }</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;                    }</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;                }</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160; </div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;                <span class="comment">// Calculate average and write to the output array using GLOBAL indices</span></div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;                <span class="keywordflow">if</span> (count &gt; 0) {</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;                    corner_arr[k][j][i] = sum / (PetscReal)count;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;                    corner_arr[k][j][i] = 0.0; <span class="comment">// Failsafe</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;                }</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;            }</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        }</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;    }</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    <a class="code" href="logging_8h.html#a5fe7257f46131945aacf9a35e9de5874">PROFILE_FUNCTION_END</a>;</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="a752363e4cefbc89ac4a51c85224aa88f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a752363e4cefbc89ac4a51c85224aa88f">&#9670;&nbsp;</a></span>PieceWiseLinearInterpolation_Scalar()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode PieceWiseLinearInterpolation_Scalar </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fieldName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal ***&#160;</td>
          <td class="paramname"><em>fieldScal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>iCell</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>jCell</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>kCell</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal *&#160;</td>
          <td class="paramname"><em>val</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieves the scalar value at the cell (iCell, jCell, kCell). </p>
<p>This function does a simple piecewise (zerothorder) Interpolatetion by returning fieldScal[kCell][jCell][iCell], ignoring any fractional coordinates.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">fieldName</td><td>A string identifying the field (e.g. "temperature"). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fieldScal</td><td>3D array of PetscReal (indexed as [k][j][i]). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">iCell,jCell,kCell</td><td>Integral cell indices to sample. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">val</td><td>Pointer to a PetscReal that receives the sampled scalar.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode 0 on success </dd></dl>

<p class="definition">Definition at line <a class="el" href="interpolation_8c_source.html#l00817">817</a> of file <a class="el" href="interpolation_8c_source.html">interpolation.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;{</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;  PetscFunctionBegin;</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;  *val = fieldScal[kCell][jCell][iCell];</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;  </div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;  <span class="comment">// Optional logging</span></div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;  <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;      <span class="stringliteral">&quot;PieceWiseLinearInterpolation_Scalar: Field &#39;%s&#39; at (i=%d, j=%d, k=%d) =&gt; val=%.6f\n&quot;</span>,</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;      fieldName, iCell, jCell, kCell, *val);</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160; </div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;  PetscFunctionReturn(0);</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="adf539ffe525330d518e5161d429402b1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adf539ffe525330d518e5161d429402b1">&#9670;&nbsp;</a></span>PieceWiseLinearInterpolation_Vector()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode PieceWiseLinearInterpolation_Vector </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fieldName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structCmpnts">Cmpnts</a> ***&#160;</td>
          <td class="paramname"><em>fieldVec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>iCell</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>jCell</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>kCell</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structCmpnts">Cmpnts</a> *&#160;</td>
          <td class="paramname"><em>vec</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Retrieves the vector (<a class="el" href="variables_8h.html#structCmpnts" title="A 3D point or vector with PetscScalar components.">Cmpnts</a>) at the cell (iCell, jCell, kCell). </p>
<p>This function simply sets: vec-&gt;x = fieldVec[kCell][jCell][iCell].x vec-&gt;y = fieldVec[kCell][jCell][iCell].y vec-&gt;z = fieldVec[kCell][jCell][iCell].z effectively a nearestcell or piecewise approach.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">fieldName</td><td>String identifying the field (e.g. "velocity"). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fieldVec</td><td>3D array of <a class="el" href="variables_8h.html#structCmpnts" title="A 3D point or vector with PetscScalar components.">Cmpnts</a> (indexed as [k][j][i]). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">iCell,jCell,kCell</td><td>Integral cell indices to sample. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">vec</td><td>Pointer to a <a class="el" href="variables_8h.html#structCmpnts" title="A 3D point or vector with PetscScalar components.">Cmpnts</a> struct that receives the sampled vector.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode 0 on success </dd></dl>

<p class="definition">Definition at line <a class="el" href="interpolation_8c_source.html#l00854">854</a> of file <a class="el" href="interpolation_8c_source.html">interpolation.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;{</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;  PetscFunctionBegin;</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;  vec-&gt;<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = fieldVec[kCell][jCell][iCell].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;  vec-&gt;<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = fieldVec[kCell][jCell][iCell].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;  vec-&gt;<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = fieldVec[kCell][jCell][iCell].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160; </div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;  <span class="comment">// Optional logging</span></div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;  <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;      <span class="stringliteral">&quot;PieceWiseLinearInterpolation_Vector: Field &#39;%s&#39; at (i=%d, j=%d, k=%d) =&gt; (x=%.6f, y=%.6f, z=%.6f)\n&quot;</span>,</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;      fieldName, iCell, jCell, kCell, vec-&gt;<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>, vec-&gt;<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>, vec-&gt;<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>);</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160; </div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;  PetscFunctionReturn(0);</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;}</div>
</div><!-- fragment -->
</div>
</div>
<a id="abb885423e57747be4eb786faf6bb032d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abb885423e57747be4eb786faf6bb032d">&#9670;&nbsp;</a></span>ComputeTrilinearWeights()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void ComputeTrilinearWeights </td>
          <td>(</td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>a1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>a2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>a3</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal *&#160;</td>
          <td class="paramname"><em>w</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Computes the trilinear Interpolatetion weights from the Interpolatetion coefficients. </p>
<p>This function computes the weights for trilinear Interpolatetion at the eight corners of a cell using the Interpolatetion coefficients provided along the x, y, and z directions.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">a1</td><td>Interpolation coefficient along the x-direction (normalized coordinate within the cell). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">a2</td><td>Interpolation coefficient along the y-direction (normalized coordinate within the cell). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">a3</td><td>Interpolation coefficient along the z-direction (normalized coordinate within the cell). </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">w</td><td>Array of 8 weights, each corresponding to one corner of the cell.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section note"><dt>Note</dt><dd><ul>
<li>The coefficients <code>a1</code>, <code>a2</code>, and <code>a3</code> should be in the range [0, 1].</li>
<li>The order of weights corresponds to the eight corners of a hexahedral cell. </li>
</ul>
</dd></dl>

<p class="definition">Definition at line <a class="el" href="interpolation_8c_source.html#l00894">894</a> of file <a class="el" href="interpolation_8c_source.html">interpolation.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;                                                                                                   {</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;    <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Computing weights for a1=%f, a2=%f, a3=%f.\n&quot;</span>, a1, a2, a3);</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160; </div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    <span class="comment">// Ensure a1, a2, a3 are within [0,1]</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    a1 = PetscMax(0.0, PetscMin(1.0, a1));</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;    a2 = PetscMax(0.0, PetscMin(1.0, a2));</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;    a3 = PetscMax(0.0, PetscMin(1.0, a3));</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160; </div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;    <span class="keyword">const</span> PetscReal oa1 = 1.0 - a1;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;    <span class="keyword">const</span> PetscReal oa2 = 1.0 - a2;</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;    <span class="keyword">const</span> PetscReal oa3 = 1.0 - a3;</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160; </div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;    w[0] = oa1 * oa2 * oa3;  <span class="comment">/* cornerOffsets[0] =&gt; (0,0,0) */</span></div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;    w[1] = a1  * oa2 * oa3;  <span class="comment">/* cornerOffsets[1] =&gt; (1,0,0) */</span></div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    w[2] = oa1 * a2  * oa3;  <span class="comment">/* cornerOffsets[2] =&gt; (0,1,0) */</span></div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    w[3] = a1  * a2  * oa3;  <span class="comment">/* cornerOffsets[3] =&gt; (1,1,0) */</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;    w[4] = oa1 * oa2 * a3;   <span class="comment">/* cornerOffsets[4] =&gt; (0,0,1) */</span></div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;    w[5] = a1  * oa2 * a3;   <span class="comment">/* cornerOffsets[5] =&gt; (1,0,1) */</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    w[6] = oa1 * a2  * a3;   <span class="comment">/* cornerOffsets[6] =&gt; (0,1,1) */</span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    w[7] = a1  * a2  * a3;   <span class="comment">/* cornerOffsets[7] =&gt; (1,1,1) */</span></div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160; </div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;    <span class="comment">// Log the computed weights for debugging</span></div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;    <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;Weights computed - &quot;</span></div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;        <span class="stringliteral">&quot;w0=%f, w1=%f, w2=%f, w3=%f, w4=%f, w5=%f, w6=%f, w7=%f. \n&quot;</span>,</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;        w[0], w[1], w[2], w[3], w[4], w[5], w[6], w[7]);</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="interpolation_8c_abb885423e57747be4eb786faf6bb032d_icgraph.svg" width="404" height="118"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a703c00f6badf5c3f0558df315a340579"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a703c00f6badf5c3f0558df315a340579">&#9670;&nbsp;</a></span>TrilinearInterpolation_Scalar()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode TrilinearInterpolation_Scalar </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fieldName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal ***&#160;</td>
          <td class="paramname"><em>fieldScal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>j</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>k</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>a1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>a2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>a3</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal *&#160;</td>
          <td class="paramname"><em>val</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Computes the trilinear Interpolateted scalar at a given point. </p>
<p>Computes the trilinear interpolated scalar at a given point.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">fieldName</td><td>A string representing the name of the scalar field (e.g., "temperature"). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fieldScal</td><td>3D array of the field from a DMDA (indexed as [k][j][i]), each cell a PetscReal. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">i,j,k</td><td>Integral cell indices (the "lower" corner in each dimension). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">a1,a2,a3</td><td>Normalized coordinates within the cell ([0,1] range). </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">val</td><td>Pointer to a PetscReal that will store the Interpolateted scalar.</td></tr>
  </table>
  </dd>
</dl>
<p>This function uses the standard 8-corner trilinear formula via <code><a class="el" href="interpolation_8c.html#abb885423e57747be4eb786faf6bb032d" title="Computes the trilinear Interpolatetion weights from the Interpolatetion coefficients.">ComputeTrilinearWeights()</a></code>. If a different scheme is desired, implement a new function with the same PetscInterface. </p>

<p class="definition">Definition at line <a class="el" href="interpolation_8c_source.html#l00937">937</a> of file <a class="el" href="interpolation_8c_source.html">interpolation.c</a>.</p>
<div class="fragment"><div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;{</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    PetscFunctionBegin; <span class="comment">// PETSc macro for error/stack tracing</span></div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160; </div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    <span class="comment">// Compute the 8 corner weights</span></div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    PetscReal wcorner[8];</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;    <a class="code" href="interpolation_8c.html#abb885423e57747be4eb786faf6bb032d">ComputeTrilinearWeights</a>(a1, a2, a3, wcorner);</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160; </div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    <span class="comment">// Offsets for cell corners</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;    PetscInt i1 = i + 1;</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    PetscInt j1 = j + 1;</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    PetscInt k1 = k + 1;</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160; </div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;    <span class="comment">// Initialize the output scalar</span></div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    PetscReal sum = 0.0;</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160; </div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    <span class="comment">// Corner 0 =&gt; (i, j, k)</span></div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;    sum += wcorner[0] * fieldScal[k ][j ][i ];</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    <span class="comment">// Corner 1 =&gt; (i+1, j, k)</span></div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;    sum += wcorner[1] * fieldScal[k ][j ][i1];</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;    <span class="comment">// Corner 2 =&gt; (i, j+1, k)</span></div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;    sum += wcorner[2] * fieldScal[k ][j1][i ];</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;    <span class="comment">// Corner 3 =&gt; (i+1, j+1, k)</span></div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;    sum += wcorner[3] * fieldScal[k ][j1][i1];</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    <span class="comment">// Corner 4 =&gt; (i, j, k+1)</span></div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;    sum += wcorner[4] * fieldScal[k1][j ][i ];</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;    <span class="comment">// Corner 5 =&gt; (i+1, j, k+1)</span></div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;    sum += wcorner[5] * fieldScal[k1][j ][i1];</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;    <span class="comment">// Corner 6 =&gt; (i, j+1, k+1)</span></div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;    sum += wcorner[6] * fieldScal[k1][j1][i ];</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;    <span class="comment">// Corner 7 =&gt; (i+1, j+1, k+1)</span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    sum += wcorner[7] * fieldScal[k1][j1][i1];</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160; </div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    *val = sum;</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160; </div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;    <span class="comment">// Logging (optional)</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;        <span class="stringliteral">&quot;TrilinearInterpolation_Scalar: Field &#39;%s&#39; at (i=%d, j=%d, k=%d), &quot;</span></div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;        <span class="stringliteral">&quot;a1=%.6f, a2=%.6f, a3=%.6f -&gt; val=%.6f.\n&quot;</span>,</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;        fieldName, i, j, k, a1, a2, a3, *val);</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160; </div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    <span class="comment">// LOG_ALLOW_SYNC(GLOBAL, LOG_INFO,</span></div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;    <span class="comment">//    &quot;TrilinearInterpolation_Scalar: Completed Interpolatetion for field &#39;%s&#39; across local cells.\n&quot;,</span></div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;      <span class="comment">//    fieldName);</span></div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160; </div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;    PetscFunctionReturn(0);</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="interpolation_8c_a703c00f6badf5c3f0558df315a340579_cgraph.svg" width="404" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a4373b52d08a935bb4cf8465228effe63"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4373b52d08a935bb4cf8465228effe63">&#9670;&nbsp;</a></span>TrilinearInterpolation_Vector()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode TrilinearInterpolation_Vector </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fieldName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structCmpnts">Cmpnts</a> ***&#160;</td>
          <td class="paramname"><em>fieldVec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>i</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>j</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>k</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>a1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>a2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>a3</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structCmpnts">Cmpnts</a> *&#160;</td>
          <td class="paramname"><em>vec</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Computes the trilinear Interpolateted vector (e.g., velocity) at a given point. </p>
<p>Computes the trilinear interpolated vector (e.g., velocity) at a given point.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">fieldName</td><td>A string representing the name of the vector field (e.g., "velocity"). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fieldVec</td><td>3D array of the field from a DMDA (indexed as [k][j][i]), each cell of type <a class="el" href="variables_8h.html#structCmpnts" title="A 3D point or vector with PetscScalar components.">Cmpnts</a>. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">i,j,k</td><td>Integral cell indices (the "lower" corner in each dimension). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">a1,a2,a3</td><td>Normalized coordinates within the cell ([0,1] range). </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">vec</td><td>Pointer to a <a class="el" href="variables_8h.html#structCmpnts" title="A 3D point or vector with PetscScalar components.">Cmpnts</a> struct that will store the Interpolateted vector (x, y, z).</td></tr>
  </table>
  </dd>
</dl>
<p>This function uses the standard 8-corner trilinear formula via <code><a class="el" href="interpolation_8c.html#abb885423e57747be4eb786faf6bb032d" title="Computes the trilinear Interpolatetion weights from the Interpolatetion coefficients.">ComputeTrilinearWeights()</a></code>. If a different scheme is desired, implement a new function with the same PetscInterface.</p>
<p>Computes the trilinear Interpolateted vector at a given point, with partial weighting if corners go out of range.</p>
<p>If any of the 8 corners (i or i+1, j or j+1, k or k+1) is out of [0..mx), [0..my), [0..mz), that corner is skipped and the corresponding weight is omitted. The total is normalized by the sum of used weights, so we get a partial Interpolatetion near boundaries. </p>

<p class="definition">Definition at line <a class="el" href="interpolation_8c_source.html#l01017">1017</a> of file <a class="el" href="interpolation_8c_source.html">interpolation.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;{</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;  PetscFunctionBegin; <span class="comment">// PETSc macro for error/stack tracing</span></div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160; </div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;  <span class="comment">// Compute the 8 corner weights</span></div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;  PetscErrorCode ierr;</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;  PetscReal wcorner[8];</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;  PetscMPIInt rank;</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160; </div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;  ierr = MPI_Comm_rank(PETSC_COMM_WORLD,&amp;rank);CHKERRQ(ierr);</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;  </div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;  <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,<span class="stringliteral">&quot;[Rank %d] Computing Trilinear Weights.\n&quot;</span>,rank);</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;  <a class="code" href="interpolation_8c.html#abb885423e57747be4eb786faf6bb032d">ComputeTrilinearWeights</a>(a1, a2, a3, wcorner);</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;  </div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;  <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,<span class="stringliteral">&quot;[Rank %d]  Trilinear weights computed for local cell %d,%d,%d.\n&quot;</span>,rank,i,j,k);</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160; </div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;  <span class="comment">// For partial Interpolatetion, we&#39;ll keep track of how many corners are valid</span></div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;  <span class="comment">// and how much sum of weights is used. Then we do a final normalization.</span></div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;  PetscReal sumW = 0.0;</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;  <a class="code" href="variables_8h.html#structCmpnts">Cmpnts</a>    accum = {0.0, 0.0, 0.0};</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160; </div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;  <span class="comment">// The eight corner indices, with their weights:</span></div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;  <span class="comment">// corners: (i,j,k), (i+1,j,k), (i,j+1,k), (i+1,j+1,k), etc.</span></div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;  <span class="comment">// We store them in an array to iterate cleanly.</span></div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;  <span class="keyword">const</span> PetscInt cornerOffsets[8][3] = {</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;    {0, 0, 0},</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;    {1, 0, 0},</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    {0, 1, 0},</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;    {1, 1, 0},</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    {0, 0, 1},</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;    {1, 0, 1},</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;    {0, 1, 1},</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;    {1, 1, 1}</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;  };</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160; </div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;  <span class="comment">// Weighted partial sum</span></div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;  <span class="keywordflow">for</span> (PetscInt c = 0; c &lt; 8; c++) {</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;    <span class="keyword">const</span> PetscInt di = cornerOffsets[c][0];</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;    <span class="keyword">const</span> PetscInt dj = cornerOffsets[c][1];</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    <span class="keyword">const</span> PetscInt dk = cornerOffsets[c][2];</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;    PetscInt iC = i + di;</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;    PetscInt jC = j + dj;</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;    PetscInt kC = k + dk;</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160; </div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;<span class="comment">    // skip if out of domain</span></div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;<span class="comment">    // (Assuming you know global domain is [0..mx), [0..my), [0..mz).)</span></div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;<span class="comment">    if (iC &lt; 0 || iC &gt;= (PetscInt)userGlobalMx ||</span></div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;<span class="comment">        jC &lt; 0 || jC &gt;= (PetscInt)userGlobalMy ||</span></div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;<span class="comment">        kC &lt; 0 || kC &gt;= (PetscInt)userGlobalMz)</span></div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;<span class="comment">    {</span></div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;<span class="comment">      // skip this corner</span></div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;<span class="comment">      continue;</span></div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;<span class="comment">    */</span></div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160; </div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;    <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,<span class="stringliteral">&quot;[Rank %d] %s[%d][%d][%d] = (%.4f,%.4f,%.4f).\n&quot;</span>,rank,fieldName,kC,jC,iC,fieldVec[kC][jC][iC].x,fieldVec[kC][jC][iC].y,fieldVec[kC][jC][iC].z);</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;    </div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;    <span class="comment">// Otherwise, accumulate</span></div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    accum.<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> += wcorner[c] * fieldVec[kC][jC][iC].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    accum.<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> += wcorner[c] * fieldVec[kC][jC][iC].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    accum.<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> += wcorner[c] * fieldVec[kC][jC][iC].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;    sumW += wcorner[c];</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;  }</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160; </div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;  <span class="comment">// If sumW=0 =&gt; out-of-range or zero weighting =&gt; set (0,0,0)</span></div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;  <span class="keywordflow">if</span> (sumW &gt; 1.0e-14) {</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    vec-&gt;<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = accum.<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> / sumW;</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;    vec-&gt;<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = accum.<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> / sumW;</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;    vec-&gt;<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = accum.<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> / sumW;</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;    vec-&gt;<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = 0.0;  vec-&gt;<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = 0.0;  vec-&gt;<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = 0.0;</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;  }</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160; </div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;  PetscFunctionReturn(0);</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="interpolation_8c_a4373b52d08a935bb4cf8465228effe63_cgraph.svg" width="404" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a556572fc2b40494da8bdb48d977dbaa1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a556572fc2b40494da8bdb48d977dbaa1">&#9670;&nbsp;</a></span>InterpolateEulerFieldToSwarmForParticle()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static PetscErrorCode InterpolateEulerFieldToSwarmForParticle </td>
          <td>(</td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fieldName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>fieldPtr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>iCell</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>jCell</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>kCell</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>a1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>a2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal&#160;</td>
          <td class="paramname"><em>a3</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>swarmOut</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>p</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscInt&#160;</td>
          <td class="paramname"><em>blockSize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Interpolates a single field (scalar or vector) for one particle, storing the result in a swarm array. </p>
<p>This helper function is used inside a larger loop over local particles.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">fieldName</td><td>A string identifying the field (e.g. "velocity", "temperature", etc.). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fieldPtr</td><td>A Pointer to the local DMDA array for the field:<ul>
<li>(PetscReal ***) if scalar (blockSize = 1)</li>
<li>(<a class="el" href="variables_8h.html#structCmpnts" title="A 3D point or vector with PetscScalar components.">Cmpnts</a> ***) if vector (blockSize = 3) </li>
</ul>
</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">iCell,jCell,kCell</td><td>The cell indices for this particle (already clamped if needed). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">a1,a2,a3</td><td>Interpolation coefficients in [0..1]. If using PiecewiseLinearInterpolation, these are currently ignored. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">swarmOut</td><td>A Pointer to the DMSwarm output array:<ul>
<li>(PetscReal*) if scalar dof=1</li>
<li>(PetscReal*) if vector dof=3 (storing x,y,z in consecutive reals)</li>
<li>or (Cmpnts*) if you store the result as a <a class="el" href="variables_8h.html#structCmpnts" title="A 3D point or vector with PetscScalar components.">Cmpnts</a> struct </li>
</ul>
</td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">p</td><td>The local particle index (used to compute the correct offset in swarmOut). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">blockSize</td><td>The number of degrees of freedom (1 =&gt; scalar, 3 =&gt; vector).</td></tr>
  </table>
  </dd>
</dl>
<p>This routine demonstrates a switch between:</p><ul>
<li>PiecewiseLinearInterpolation (zeroth order / nearest cell)</li>
<li>TrilinearInterpolation (8-corner weighted).</li>
</ul>
<p>By default, PiecewiseLinearInterpolation is active, while the TrilinearInterpolation calls are commented out. To switch to trilinear, simply comment/uncomment appropriately.</p>
<p>Logging calls are provided (LOG_ALLOW) that you can adapt to your existing logging system.</p>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode 0 on success, non-zero on error. </dd></dl>

<p class="definition">Definition at line <a class="el" href="interpolation_8c_source.html#l01137">1137</a> of file <a class="el" href="interpolation_8c_source.html">interpolation.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;{</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;  PetscErrorCode ierr;</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;  PetscFunctionBegin;</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160; </div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;  <a class="code" href="logging_8h.html#ace99f3e207ccb2e46e9b782f9e57732e">PROFILE_FUNCTION_BEGIN</a>;</div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160; </div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;  <span class="comment">// Optional logging at start</span></div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;  <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    <span class="stringliteral">&quot;InterpolateEulerFieldToSwarmForParticle: field=&#39;%s&#39;, blockSize=%d, &quot;</span></div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    <span class="stringliteral">&quot;cell IDs=(%d,%d,%d), weights=(%.4f,%.4f,%.4f)\n&quot;</span>,</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;    fieldName, blockSize, iCell, jCell, kCell, a1, a2, a3);</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160; </div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;  <span class="comment">/*</span></div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;<span class="comment">     If blockSize=1, we PetscInterpret the fieldPtr as a 3D array of PetscReal (scalar).</span></div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;<span class="comment">     If blockSize=3, we PetscInterpret the fieldPtr as a 3D array of Cmpnts (vector).</span></div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;<span class="comment">   */</span></div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;  <span class="keywordflow">if</span> (blockSize == 1) {</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    <span class="comment">/* Scalar field: Cast fieldPtr to (PetscReal ***). */</span></div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    PetscReal ***fieldScal = (PetscReal ***) fieldPtr;</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    PetscReal val;</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160; </div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    <span class="comment">// Currently using trilinear.</span></div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    ierr = <a class="code" href="interpolation_8h.html#a028d693bd5e99242092b027c7e46f3a4">TrilinearInterpolation</a>(fieldName, fieldScal,</div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;                                   iCell, jCell, kCell,</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;                                   a1, a2, a3,</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;                                   &amp;val);</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;     CHKERRQ(ierr);</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160; </div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;    <span class="comment">// Alternative (commented) call to PiecewiseLinearInterpolation (zeroth order) :</span></div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    <span class="comment">//   PetscErrorCode ierr = PiecewiseLinearInterpolation(fieldName,</span></div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;    <span class="comment">//                                                   fieldScal,</span></div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;    <span class="comment">//                                                   iCell, jCell, kCell,</span></div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;    <span class="comment">//                                                   &amp;val);</span></div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;    <span class="comment">// CHKERRQ(ierr);</span></div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160; </div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;    <span class="comment">// Write the scalar result to the swarm output at index [p].</span></div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;    ((PetscReal*)swarmOut)[p] = val;</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160; </div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;    <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;      <span class="stringliteral">&quot;InterpolateEulerFieldToSwarmForParticle [Scalar]: field=&#39;%s&#39;, result=%.6f &quot;</span></div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;      <span class="stringliteral">&quot;stored at swarmOut index p=%d.\n&quot;</span>, fieldName, val, (PetscInt)p);</div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;  }</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;  <span class="keywordflow">else</span> <span class="keywordflow">if</span> (blockSize == 3) {</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;    <span class="comment">/* Vector field: Cast fieldPtr to (Cmpnts ***). */</span></div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;    <a class="code" href="variables_8h.html#structCmpnts">Cmpnts</a> ***fieldVec = (<a class="code" href="variables_8h.html#structCmpnts">Cmpnts</a> ***) fieldPtr;</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    <a class="code" href="variables_8h.html#structCmpnts">Cmpnts</a> vec;</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160; </div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160; </div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;    </div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;    </div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    <span class="comment">// Piecewise Interpolatetion (zeroth order).</span></div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;    <span class="comment">//  PetscErrorCode ierr = PieceWiseLinearInterpolation(fieldName,</span></div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;    <span class="comment">//                                                   fieldVec,</span></div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;    <span class="comment">//                                                   iCell, jCell, kCell,</span></div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;    <span class="comment">//                                                   &amp;vec);</span></div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;    <span class="comment">// CHKERRQ(ierr);</span></div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160; </div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;    <span class="comment">// Alternative (commented) call to trilinear:</span></div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;     ierr = <a class="code" href="interpolation_8h.html#a028d693bd5e99242092b027c7e46f3a4">TrilinearInterpolation</a>(fieldName, fieldVec,</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;                                   iCell, jCell, kCell,</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;                                   a1, a2, a3,</div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;                                   &amp;vec);</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;     CHKERRQ(ierr);</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160; </div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;    <span class="comment">// If swarmOut is an array of 3 reals per particle:</span></div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;    ((PetscReal*)swarmOut)[3*p + 0] = vec.<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;    ((PetscReal*)swarmOut)[3*p + 1] = vec.<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;    ((PetscReal*)swarmOut)[3*p + 2] = vec.<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160; </div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;    <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;      <span class="stringliteral">&quot;InterpolateEulerFieldToSwarmForParticle [Vector]: field=&#39;%s&#39;, result=(%.6f,%.6f,%.6f) &quot;</span></div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;      <span class="stringliteral">&quot;stored at swarmOut[3p..3p+2], p=%d.\n&quot;</span>,</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;      fieldName, vec.<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>, vec.<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>, vec.<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>, (PetscInt)p);</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160; </div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;<span class="comment">       If you store the vector result as a Cmpnts in the swarm, do instead:</span></div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;<span class="comment">         ((Cmpnts*)swarmOut)[p] = vec;</span></div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;<span class="comment">       but ensure your DMSwarm field is sized for a Cmpnts struct.</span></div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;<span class="comment">    */</span></div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;  }</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;    <span class="comment">/* If blockSize isn&#39;t 1 or 3, we raise an error. */</span></div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;    SETERRQ(PETSC_COMM_SELF, PETSC_ERR_SUP,</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;      <span class="stringliteral">&quot;InterpolateEulerFieldToSwarmForParticle: only blockSize=1 or 3 supported, got %d.&quot;</span>,</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;      (PetscInt)blockSize);</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;  }</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160; </div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;  <a class="code" href="logging_8h.html#a5fe7257f46131945aacf9a35e9de5874">PROFILE_FUNCTION_END</a>;</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;  PetscFunctionReturn(0);</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="interpolation_8c_a556572fc2b40494da8bdb48d977dbaa1_icgraph.svg" width="100%" height="414"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="ad200d31b74c511e4388b757fb0359001"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad200d31b74c511e4388b757fb0359001">&#9670;&nbsp;</a></span>InterpolateEulerFieldToSwarm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode InterpolateEulerFieldToSwarm </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Vec&#160;</td>
          <td class="paramname"><em>fieldLocal_cellCentered</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>fieldName</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>swarmOutFieldName</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Interpolates a cell-centered field (scalar or vector) onto DMSwarm particles, using a robust, PETSc-idiomatic two-stage process. </p>
<p>This function first converts the cell-centered input data to corner-node data, storing this intermediate result in a PETSc Vec to correctly handle the communication of ghost-point information across parallel ranks. It then performs a final trilinear interpolation from the ghosted corner data to each particle's location.</p>
<p>Workflow:</p><ol type="1">
<li>Create temporary PETSc Vecs (<code>cornerGlobal</code>, <code>cornerLocal</code>) to manage the intermediate corner-node data, using the existing nodal DMDA (<code>user-&gt;fda</code>).</li>
<li>Call a dispatch macro that uses the runtime block size (<code>bs</code>) to select the correct underlying center-to-corner function, writing results into <code>cornerGlobal</code>.</li>
<li>Perform a ghost-point exchange (<code>DMGlobalToLocal</code>) to transfer the boundary data from <code>cornerGlobal</code> into the ghost regions of <code>cornerLocal</code>.</li>
<li>Loop over all local particles. For each particle: a. Convert its global cell index to a local index relative to the ghosted array. b. Check if the particle's interpolation stencil is fully contained within the owned+ghost region. If not, log a warning and set the result to zero. c. Perform the final trilinear interpolation using the ghosted <code>cornerLocal</code> data.</li>
<li>Restore all PETSc objects to prevent memory leaks.</li>
</ol>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">user</td><td>User context with DMDA, DMSwarm, etc. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fieldGlobal_cellCentered</td><td>Vec (from fda) with cell-centered data (e.g., Ucat). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fieldName</td><td>Human-readable field name for logging (e.g., "Ucat"). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">swarmOutFieldName</td><td>Name of the DMSwarm field where interpolation results go.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode 0 on success. </dd></dl>

<p class="definition">Definition at line <a class="el" href="interpolation_8c_source.html#l01273">1273</a> of file <a class="el" href="interpolation_8c_source.html">interpolation.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;{</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;    PetscErrorCode ierr;</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;    DM             fda = user-&gt;<a class="code" href="variables_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>;</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;    DM             swarm = user-&gt;<a class="code" href="variables_8h.html#a1675749ea3b2429f00405a1ee3203d18">swarm</a>;</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;    PetscInt       bs;</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;    DMDALocalInfo  info;</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;    PetscMPIInt    rank;</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160; </div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;    <span class="comment">// Intermediate vectors to manage corner data and its ghosts</span></div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;    Vec cornerGlobal, cornerLocal;</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160; </div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;    <span class="comment">// Generic pointers to the raw data arrays</span></div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;    <span class="keywordtype">void</span> *cellCenterPtr_read;</div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;    <span class="keywordtype">void</span> *cornerPtr_read_with_ghosts;</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160; </div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    <span class="comment">// Swarm-related pointers</span></div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;    PetscInt  *cellIDs = NULL;</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;    PetscReal *weights = NULL;</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;    PetscInt  *pids = NULL; <span class="comment">// For logging particle IDs in warnings</span></div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;    <span class="keywordtype">void</span>      *swarmOut = NULL;</div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;    PetscInt   nLocal;</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160; </div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;    PetscFunctionBegin;</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;    <a class="code" href="logging_8h.html#ace99f3e207ccb2e46e9b782f9e57732e">PROFILE_FUNCTION_BEGIN</a>;</div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;    ierr = MPI_Comm_rank(PETSC_COMM_WORLD, &amp;rank); CHKERRQ(ierr);</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;    ierr = DMDAGetLocalInfo(fda, &amp;info); CHKERRQ(ierr);</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;    ierr = VecGetBlockSize(fieldLocal_cellCentered, &amp;bs); CHKERRQ(ierr);</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;    <span class="keywordflow">if</span> (bs != 1 &amp;&amp; bs != 3) SETERRQ(PETSC_COMM_SELF, PETSC_ERR_SUP, <span class="stringliteral">&quot;BlockSize must be 1 or 3.&quot;</span>);</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160; </div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;    <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;Starting for field &#39;%s&#39;... \n&quot;</span>, fieldName);</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160; </div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;    <span class="comment">/* STAGE 1: Center-to-Corner Calculation with Communication */</span></div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160; </div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;    <span class="comment">// (A) Get temporary Vecs from the DMDA pool to manage corner data</span></div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;    ierr = DMGetGlobalVector(fda, &amp;cornerGlobal); CHKERRQ(ierr);</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;    ierr = DMGetLocalVector(fda, &amp;cornerLocal); CHKERRQ(ierr);</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160; </div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;    ierr = VecSet(cornerGlobal,0.0); CHKERRQ(ierr);</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;    ierr = VecSet(cornerLocal,0.0); CHKERRQ(ierr);</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160; </div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;    <span class="comment">// (B) Get a read-only array from the input cell-centered vector</span></div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;    ierr = DMDAVecGetArrayRead(fda, fieldLocal_cellCentered, &amp;cellCenterPtr_read); CHKERRQ(ierr);</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160; </div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;    <span class="comment">// (C) Perform the center-to-corner interpolation directly into the global corner vector</span></div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;    <span class="keywordtype">void</span> *cornerPtr_write = NULL;</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;    ierr = DMDAVecGetArray(fda, cornerLocal, &amp;cornerPtr_write); CHKERRQ(ierr);</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160; </div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;    <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;[Rank %d] Starting center-to-corner interpolation for &#39;%s&#39;.\n&quot;</span>, rank, fieldName);</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;        </div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;    <span class="comment">// SINGLE, CLEAN CALL SITE: The macro handles the runtime dispatch based on &#39;bs&#39;.</span></div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;    ierr = <a class="code" href="interpolation_8h.html#a60d783e6b448175916bd9125648ba8af">InterpolateFieldFromCenterToCorner</a>(bs, cellCenterPtr_read, cornerPtr_write, user); CHKERRQ(ierr);</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160; </div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;    <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;[Rank %d] Finished center-to-corner interpolation for &#39;%s&#39;.\n&quot;</span>, rank, fieldName);</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;    ierr = DMDAVecRestoreArray(fda, cornerLocal, &amp;cornerPtr_write); CHKERRQ(ierr);</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;    </div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;    ierr = DMDAVecRestoreArrayRead(fda, fieldLocal_cellCentered, &amp;cellCenterPtr_read); CHKERRQ(ierr);</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;<span class="comment">    //////////// DEBUG</span></div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;<span class="comment"></span>    <span class="comment">/*</span></div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;<span class="comment">        // Log a synchronized header message from all ranks.</span></div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;<span class="comment">    LOG_ALLOW_SYNC(GLOBAL, LOG_DEBUG, &quot;DEBUG: Dumping cornerGlobal BEFORE ghost exchange...\n&quot;);</span></div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;<span class="comment">    // VecView prints to a PETSc viewer. PETSC_VIEWER_STDOUT_WORLD is a global, synchronized viewer.</span></div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;<span class="comment">    // We only need to call it if logging is active for this function.</span></div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;<span class="comment">    if (is_function_allowed(__func__) &amp;&amp; (int)(LOG_DEBUG) &lt;= (int)get_log_level()) {</span></div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;<span class="comment">        ierr = VecView(cornerGlobal, PETSC_VIEWER_STDOUT_WORLD); CHKERRQ(ierr);</span></div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;<span class="comment">    </span></div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;<span class="comment">    // Log a synchronized footer message.</span></div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;<span class="comment">    LOG_ALLOW_SYNC(GLOBAL, LOG_DEBUG, &quot;DEBUG: Finished dumping cornerGlobal.\n&quot;);</span></div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;<span class="comment">    */</span><span class="comment"></span></div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;<span class="comment">    ////////// DEBUG</span></div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;    <span class="comment">// ierr = PetscBarrier((PetscObject)cornerGlobal); CHKERRQ(ierr);</span></div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;    </div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;    <span class="comment">// (D) CRITICAL STEP: Communicate the newly computed corner data to fill ghost regions</span></div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;    <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;[Rank %d] Beginning ghost exchange for corner data...\n&quot;</span>, rank);</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;    ierr = DMLocalToGlobalBegin(fda, cornerLocal, INSERT_VALUES, cornerGlobal); CHKERRQ(ierr);</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;    ierr = DMLocalToGlobalEnd(fda, cornerLocal, INSERT_VALUES, cornerGlobal); CHKERRQ(ierr);</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160; </div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;    ierr = DMGlobalToLocalBegin(fda, cornerGlobal, INSERT_VALUES, cornerLocal); CHKERRQ(ierr);</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;    ierr = DMGlobalToLocalEnd(fda, cornerGlobal, INSERT_VALUES, cornerLocal); CHKERRQ(ierr);</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;    </div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;    <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;[Rank %d] Ghost exchange for corner data complete.\n&quot;</span>, rank);</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160; </div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;    <a class="code" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;DEBUG: About to get array from FDA on all ranks.\n&quot;</span>);</div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;       <span class="keywordflow">if</span> (<a class="code" href="logging_8h.html#a2358badbcda33fc9d80ebd6a59d2a2cd">is_function_allowed</a>(__func__) &amp;&amp; (<span class="keywordtype">int</span>)(<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>) &lt;= (<span class="keywordtype">int</span>)<a class="code" href="logging_8h.html#a9585f583c260f40a73f2490914edc689">get_log_level</a>()) {</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;     ierr = DMView(user-&gt;<a class="code" href="variables_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, PETSC_VIEWER_STDOUT_WORLD); CHKERRQ(ierr);</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;       }</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;    <a class="code" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>, <span class="stringliteral">&quot;DEBUG: Finished DMView.\n&quot;</span>);</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;    <span class="comment"></span></div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;<span class="comment">    /////// DEBUG</span></div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;<span class="comment"></span>    <span class="comment">/*</span></div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;<span class="comment">        // Log a synchronized header message from all ranks.</span></div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;<span class="comment">    LOG_ALLOW_SYNC(GLOBAL, LOG_DEBUG, &quot;DEBUG: Dumping cornerLocal AFTER ghost exchange...\n&quot;);</span></div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;<span class="comment">    // Here, we want each rank to print its own local vector.</span></div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;<span class="comment">    // PETSC_VIEWER_STDOUT_SELF is the correct tool for this. The LOG_ALLOW_SYNC</span></div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;<span class="comment">    // wrapper will ensure the output from each rank is printed sequentially.</span></div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;<span class="comment">    if (is_function_allowed(__func__) &amp;&amp; (int)(LOG_DEBUG) &lt;= (int)get_log_level()) {</span></div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;<span class="comment">        PetscMPIInt rank_d;</span></div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;<span class="comment">        ierr = MPI_Comm_rank(PETSC_COMM_WORLD, &amp;rank_d); CHKERRQ(ierr);</span></div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;<span class="comment">        </span></div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;<span class="comment">        // Use a synchronized print to create a clean header for each rank&#39;s output</span></div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;<span class="comment">        PetscSynchronizedPrintf(PETSC_COMM_WORLD, &quot;\n--- cornerLocal (Rank %d) ---\n&quot;, rank_d);</span></div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;<span class="comment">        PetscSynchronizedFlush(PETSC_COMM_WORLD, PETSC_STDOUT);</span></div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;<span class="comment">        // Print the local vector&#39;s contents for this rank</span></div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;<span class="comment">        ierr = VecView(cornerLocal, PETSC_VIEWER_STDOUT_SELF); CHKERRQ(ierr);</span></div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;<span class="comment">        // Use a synchronized print to create a clean footer</span></div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;<span class="comment">        PetscSynchronizedPrintf(PETSC_COMM_WORLD, &quot;--- End cornerLocal (Rank %d) ---\n&quot;, rank_d);</span></div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;<span class="comment">        PetscSynchronizedFlush(PETSC_COMM_WORLD, PETSC_STDOUT);</span></div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;<span class="comment">    }</span></div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;<span class="comment">    LOG_ALLOW_SYNC(GLOBAL, LOG_DEBUG, &quot;DEBUG: Finished dumping cornerLocal.\n&quot;);</span></div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;<span class="comment">    */</span><span class="comment"></span></div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;<span class="comment">    ///// DEBUG</span></div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;<span class="comment"></span>    </div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;    <span class="comment">/* STAGE 2: Particle Interpolation using Ghosted Corner Data */</span></div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160; </div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;    <span class="comment">// (E) Get the local, GHOSTED array of corner data for the final interpolation step</span></div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;    ierr = DMDAVecGetArrayRead(fda, cornerLocal, &amp;cornerPtr_read_with_ghosts); CHKERRQ(ierr);</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160; </div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;    <span class="comment">// (F) Retrieve swarm fields for the particle loop</span></div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    ierr = DMSwarmGetLocalSize(swarm, &amp;nLocal); CHKERRQ(ierr);</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;    ierr = DMSwarmGetField(swarm, <span class="stringliteral">&quot;DMSwarm_CellID&quot;</span>, NULL, NULL, (<span class="keywordtype">void</span>**)&amp;cellIDs); CHKERRQ(ierr);</div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;    ierr = DMSwarmGetField(swarm, <span class="stringliteral">&quot;DMSwarm_pid&quot;</span>, NULL, NULL, (<span class="keywordtype">void</span>**)&amp;pids); CHKERRQ(ierr);</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;    ierr = DMSwarmGetField(swarm, <span class="stringliteral">&quot;weight&quot;</span>, NULL, NULL, (<span class="keywordtype">void</span>**)&amp;weights); CHKERRQ(ierr);</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;    ierr = DMSwarmGetField(swarm, swarmOutFieldName, NULL, NULL, &amp;swarmOut); CHKERRQ(ierr);</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160; </div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;    <span class="comment">// (G) Loop over each local particle</span></div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;    <span class="keywordflow">for</span> (PetscInt p = 0; p &lt; nLocal; p++) {</div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;        PetscInt iCell_global = cellIDs[3 * p + 0];</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;        PetscInt jCell_global = cellIDs[3 * p + 1];</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;        PetscInt kCell_global = cellIDs[3 * p + 2];</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160; </div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;        <span class="comment">// Convert GLOBAL cell index to LOCAL GHOSTED index for the corner array</span></div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;        PetscInt iCell_local = iCell_global;<span class="comment">//- info.gxs;</span></div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;        PetscInt jCell_local = jCell_global;<span class="comment">//- info.gys;</span></div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;        PetscInt kCell_local = kCell_global;<span class="comment">//- info.gzs;</span></div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160; </div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;        <span class="comment">// Safety check: Ensure the entire 8-node stencil is within the valid memory</span></div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;        <span class="comment">// region (owned + ghosts) of the local array.</span></div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160; </div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;    <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>,<a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,<span class="stringliteral">&quot; The ghosted max of current rank %d are: %d,%d,%d.\n&quot;</span>,rank,info.gxs + info.gxm,info.gys+info.gym,info.gzs+info.gzm);</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;    </div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;        <span class="keywordflow">if</span> (iCell_local &lt; 0 || iCell_local &gt;= info.gxs + info.gxm - 1 ||</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;            jCell_local &lt; 0 || jCell_local &gt;= info.gys + info.gym - 1 ||</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;            kCell_local &lt; 0 || kCell_local &gt;= info.gzs + info.gzm - 1)</div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;        {</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;            <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a8f6fe15bfe15104da6d1b360194a5400">LOG_WARNING</a>,</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;                      <span class="stringliteral">&quot;[Rank %d] Particle PID %lld in global cell (%d,%d,%d) is in an un-interpolatable region (requires ghosts of ghosts or is out of bounds). Zeroing field &#39;%s&#39;.\n&quot;</span>,</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;                      rank, (<span class="keywordtype">long</span> <span class="keywordtype">long</span>)pids[p], iCell_global, jCell_global, kCell_global, fieldName);</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160; </div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;            <span class="keywordflow">if</span> (bs == 3) {</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;                ((PetscReal*)swarmOut)[3*p + 0] = 0.0;</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;                ((PetscReal*)swarmOut)[3*p + 1] = 0.0;</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;                ((PetscReal*)swarmOut)[3*p + 2] = 0.0;</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;                 ((PetscReal*)swarmOut)[p] = 0.0;</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;            }</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;            <span class="keywordflow">continue</span>;</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;        }</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160; </div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;        PetscReal a1 = weights[3 * p + 0];</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;        PetscReal a2 = weights[3 * p + 1];</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;        PetscReal a3 = weights[3 * p + 2];</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160; </div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;        ierr = <a class="code" href="interpolation_8c.html#a556572fc2b40494da8bdb48d977dbaa1">InterpolateEulerFieldToSwarmForParticle</a>(</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;                  fieldName,</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;                  cornerPtr_read_with_ghosts,</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;                  iCell_local, jCell_local, kCell_local,</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;                  a1, a2, a3,</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;                  swarmOut, p, bs);</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;        CHKERRQ(ierr);</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;    }</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160; </div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;    <span class="comment">/* (H) Restore all retrieved arrays and vectors */</span></div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;    ierr = DMDAVecRestoreArrayRead(fda, cornerLocal, &amp;cornerPtr_read_with_ghosts); CHKERRQ(ierr);</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;    ierr = DMSwarmRestoreField(swarm, swarmOutFieldName, NULL, NULL, &amp;swarmOut); CHKERRQ(ierr);</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;    ierr = DMSwarmRestoreField(swarm, <span class="stringliteral">&quot;weight&quot;</span>, NULL, NULL, (<span class="keywordtype">void</span>**)&amp;weights); CHKERRQ(ierr);</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;    ierr = DMSwarmRestoreField(swarm, <span class="stringliteral">&quot;DMSwarm_pid&quot;</span>, NULL, NULL, (<span class="keywordtype">void</span>**)&amp;pids); CHKERRQ(ierr);</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;    ierr = DMSwarmRestoreField(swarm, <span class="stringliteral">&quot;DMSwarm_CellID&quot;</span>, NULL, NULL, (<span class="keywordtype">void</span>**)&amp;cellIDs); CHKERRQ(ierr);</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160; </div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;    ierr = DMRestoreLocalVector(fda, &amp;cornerLocal); CHKERRQ(ierr);</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;    ierr = DMRestoreGlobalVector(fda, &amp;cornerGlobal); CHKERRQ(ierr);</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160; </div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;    <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>, <span class="stringliteral">&quot;Finished for field &#39;%s&#39;.\n&quot;</span>, fieldName);</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;    <a class="code" href="logging_8h.html#a5fe7257f46131945aacf9a35e9de5874">PROFILE_FUNCTION_END</a>;</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;    PetscFunctionReturn(0);</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="interpolation_8c_ad200d31b74c511e4388b757fb0359001_cgraph.svg" width="488" height="155"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="interpolation_8c_ad200d31b74c511e4388b757fb0359001_icgraph.svg" width="100%" height="414"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="a25d384c0bcf5426864f90ab568e37511"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a25d384c0bcf5426864f90ab568e37511">&#9670;&nbsp;</a></span>InterpolateAllFieldsToSwarm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode InterpolateAllFieldsToSwarm </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Interpolates all relevant fields from the DMDA to the DMSwarm. </p>
<p>Currently, it Interpolatetes:</p><ul>
<li>user-&gt;Ucat (vector field) into the DMSwarm field "swarmVelocity".</li>
</ul>
<p>To add more fields, duplicate the call to InterpolateOneFieldOverSwarm and provide:</p><ul>
<li>The global Vec for that field (e.g. user-&gt;Tcat for temperature),</li>
<li>A human-readable field name (for logging),</li>
<li>A DMSwarm output field name (e.g. "swarmTemperature").</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in,out]</td><td class="paramname">user</td><td>Pointer to a <a class="el" href="variables_8h.html#structUserCtx" title="User-defined context containing data specific to a single computational grid level.">UserCtx</a> containing:<ul>
<li>user-&gt;da (DM for the grid),</li>
<li>user-&gt;swarm (DMSwarm for particles),.</li>
<li>user-&gt;Ucat (Vec for the vector field),</li>
<li>possibly more fields like user-&gt;Tcat, user-&gt;Pcat, etc.</li>
</ul>
</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode Returns 0 on success, non-zero on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="interpolation_8c_source.html#l01492">1492</a> of file <a class="el" href="interpolation_8c_source.html">interpolation.c</a>.</p>
<div class="fragment"><div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;{</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;  PetscErrorCode ierr;</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;  PetscMPIInt rank;</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;  PetscFunctionBegin;</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160; </div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;  <a class="code" href="logging_8h.html#ace99f3e207ccb2e46e9b782f9e57732e">PROFILE_FUNCTION_BEGIN</a>;</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160; </div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;  ierr = MPI_Comm_rank(PETSC_COMM_WORLD,&amp;rank); CHKERRQ(ierr);</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160; </div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;  <span class="comment">/* </span></div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;<span class="comment">     1) Interpolate the &#39;velocity&#39; field (user-&gt;Ucat) into DMSwarm&#39;s &quot;swarmVelocity&quot;.</span></div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;<span class="comment">        - The function InterpolateOneFieldOverSwarm() loops over all local particles,</span></div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;<span class="comment">          retrieves iCell, jCell, kCell, (a1,a2,a3) from the DMSwarm,</span></div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;<span class="comment">          and calls the appropriate trilinear Interpolatetion routine.</span></div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;<span class="comment">        - &quot;velocity&quot; =&gt; just a label used in logging or debugging.</span></div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;<span class="comment">        - &quot;swarmVelocity&quot; =&gt; the DMSwarm field name where we store the result</span></div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;<span class="comment">          (assume dof=3 if user-&gt;Ucat has blockSize=3).</span></div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;<span class="comment">  */</span></div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160; </div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;  <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;         <span class="stringliteral">&quot;InterpolateteAllFieldsToSwarm: Interpolation of ucat to velocity begins on rank %d.\n&quot;</span>,rank);</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;  <span class="comment">// Make sure to pass the *GLOBAL* Vector to the function below! </span></div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;  ierr = <a class="code" href="interpolation_8c.html#ad200d31b74c511e4388b757fb0359001">InterpolateEulerFieldToSwarm</a>(user, user-&gt;<a class="code" href="variables_8h.html#ace2eeedc863d73caaf51bb83aa993e44">lUcat</a>, </div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;                                      <span class="stringliteral">&quot;Ucat&quot;</span>, </div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;                                      <span class="stringliteral">&quot;velocity&quot;</span>); CHKERRQ(ierr);</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;  <span class="comment">/* </span></div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;<span class="comment">     2) (OPTIONAL) If you have more fields, you can Interpolatete them similarly.</span></div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;<span class="comment">     For example, if user-&gt;Tcat is a scalar Vec for &quot;temperature&quot; and the DMSwarm</span></div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;<span class="comment">     has a field &quot;Temperature&quot; (with dof=1), you could do:</span></div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;<span class="comment">         ierr = InterpolateOneFieldOverSwarm(user, user-&gt;Tcat,</span></div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;<span class="comment">                                             &quot;temperature&quot;,</span></div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;<span class="comment">                                             &quot;swarmTemperature&quot;); CHKERRQ(ierr);</span></div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;<span class="comment">     For pressure:</span></div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;<span class="comment">         ierr = InterpolateOneFieldOverSwarm(user, user-&gt;Pcat,</span></div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;<span class="comment">                                             &quot;pressure&quot;,</span></div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;<span class="comment">                                             &quot;swarmPressure&quot;); CHKERRQ(ierr);</span></div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;<span class="comment">     </span></div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;<span class="comment">     ...and so forth.</span></div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;<span class="comment">   */</span></div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160; </div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;  <span class="comment">/* </span></div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;<span class="comment">     3) Optionally, synchronize or log that all fields are done </span></div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;<span class="comment">  */</span></div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160;  ierr = MPI_Barrier(PETSC_COMM_WORLD); CHKERRQ(ierr);</div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;  <a class="code" href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a>(<a class="code" href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a>,</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;        <span class="stringliteral">&quot;[rank %d]Completed Interpolateting all fields to the swarm.\n&quot;</span>,rank);</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160; </div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;  <a class="code" href="logging_8h.html#a5fe7257f46131945aacf9a35e9de5874">PROFILE_FUNCTION_END</a>;</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160; </div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;  PetscFunctionReturn(0);</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="interpolation_8c_a25d384c0bcf5426864f90ab568e37511_cgraph.svg" width="100%" height="416"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><div class="zoom"><iframe scrolling="no" frameborder="0" src="interpolation_8c_a25d384c0bcf5426864f90ab568e37511_icgraph.svg" width="100%" height="414"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div></div>
</div>

</div>
</div>
<a id="ac3e3d9d03447563e1062d257af6046d2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac3e3d9d03447563e1062d257af6046d2">&#9670;&nbsp;</a></span>InterpolateCornerToFaceCenter_Scalar()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode InterpolateCornerToFaceCenter_Scalar </td>
          <td>(</td>
          <td class="paramtype">PetscReal ***&#160;</td>
          <td class="paramname"><em>corner_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal ***&#160;</td>
          <td class="paramname"><em>faceX_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal ***&#160;</td>
          <td class="paramname"><em>faceY_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">PetscReal ***&#160;</td>
          <td class="paramname"><em>faceZ_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Interpolates a scalar field from corner nodes to all face centers. </p>
<p>This routine computes the average of the four corner-node values defining each face of a hexahedral cell:</p><ul>
<li>X-faces (perpendicular to X): face between (i-1,i) in X-dir</li>
<li>Y-faces (perpendicular to Y): face between (j-1,j) in Y-dir</li>
<li>Z-faces (perpendicular to Z): face between (k-1,k) in Z-dir</li>
</ul>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">corner_arr</td><td>Ghosted node-centered array (global indexing) from user-&gt;fda. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">faceX_arr</td><td>Local array for X-faces sized [zm][ym][xm+1]. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">faceY_arr</td><td>Local array for Y-faces sized [zm][ym+1][xm]. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">faceZ_arr</td><td>Local array for Z-faces sized [zm+1][ym][xm]. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">user</td><td>User context containing DMDA 'fda' and GetOwnedCellRange.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode 0 on success, non-zero on failure. </dd></dl>

<p class="definition">Definition at line <a class="el" href="interpolation_8c_source.html#l02215">2215</a> of file <a class="el" href="interpolation_8c_source.html">interpolation.c</a>.</p>
<div class="fragment"><div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;{</div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;    PetscErrorCode ierr;</div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;    DMDALocalInfo info;</div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160; </div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;    PetscFunctionBeginUser;</div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160; </div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;    <a class="code" href="logging_8h.html#ace99f3e207ccb2e46e9b782f9e57732e">PROFILE_FUNCTION_BEGIN</a>;</div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160; </div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;    ierr = DMDAGetLocalInfo(user-&gt;<a class="code" href="variables_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, &amp;info); CHKERRQ(ierr);</div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160; </div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;    <span class="comment">// Determine owned-cell ranges based on corner-node ownership</span></div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;    PetscInt xs, xm, ys, ym, zs, zm;</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;    ierr = <a class="code" href="setup_8h.html#a9b17552f79ebe16d0363986217a01ff3">GetOwnedCellRange</a>(&amp;info, 0, &amp;xs, &amp;xm); CHKERRQ(ierr);</div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;    ierr = <a class="code" href="setup_8h.html#a9b17552f79ebe16d0363986217a01ff3">GetOwnedCellRange</a>(&amp;info, 1, &amp;ys, &amp;ym); CHKERRQ(ierr);</div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;    ierr = <a class="code" href="setup_8h.html#a9b17552f79ebe16d0363986217a01ff3">GetOwnedCellRange</a>(&amp;info, 2, &amp;zs, &amp;zm); CHKERRQ(ierr);</div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160; </div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;    <span class="comment">// Global exclusive end indices for cells</span></div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;    PetscInt xe = xs + xm;</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;    PetscInt ye = ys + ym;</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;    PetscInt ze = zs + zm;</div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160; </div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;    <span class="comment">// --- Xfaces: loops k=zs..ze-1, j=ys..ye-1, i=xs..xe (xm+1 faces per row) ---</span></div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;    <span class="keywordflow">for</span> (PetscInt k = zs; k &lt; ze; ++k) {</div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;        PetscInt k_loc = k - zs;</div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;        <span class="keywordflow">for</span> (PetscInt j = ys; j &lt; ye; ++j) {</div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;            PetscInt j_loc = j - ys;</div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;            <span class="keywordflow">for</span> (PetscInt i = xs; i &lt;= xe; ++i) {</div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;                PetscInt i_loc = i - xs; <span class="comment">// 0..xm</span></div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160;                <span class="comment">// Average the four corners of the Y-Z face at X = i</span></div>
<div class="line"><a name="l02250"></a><span class="lineno"> 2250</span>&#160;                PetscReal sum = corner_arr[k  ][j  ][i]</div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;                              + corner_arr[k+1][j  ][i]</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;                              + corner_arr[k  ][j+1][i]</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;                              + corner_arr[k+1][j+1][i];</div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;                faceX_arr[k_loc][j_loc][i_loc] = sum * 0.25;</div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;            }</div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;        }</div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;    }</div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160; </div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;    <span class="comment">// --- Yfaces: loops k=zs..ze-1, j=ys..ye (ym+1 faces), i=xs..xe-1 ---</span></div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;    <span class="keywordflow">for</span> (PetscInt k = zs; k &lt; ze; ++k) {</div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;        PetscInt k_loc = k - zs;</div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;        <span class="keywordflow">for</span> (PetscInt j = ys; j &lt;= ye; ++j) {</div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;            PetscInt j_loc = j - ys; <span class="comment">// 0..ym</span></div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;            <span class="keywordflow">for</span> (PetscInt i = xs; i &lt; xe; ++i) {</div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;                PetscInt i_loc = i - xs;</div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;                <span class="comment">// Average the four corners of the X-Z face at Y = j</span></div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;                PetscReal sum = corner_arr[k  ][j][i  ]</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;                              + corner_arr[k+1][j][i  ]</div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;                              + corner_arr[k  ][j][i+1]</div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;                              + corner_arr[k+1][j][i+1];</div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;                faceY_arr[k_loc][j_loc][i_loc] = sum * 0.25;</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;            }</div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;        }</div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;    }</div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160; </div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;    <span class="comment">// --- Zfaces: loops k=zs..ze (zm+1), j=ys..ye-1, i=xs..xe-1 ---</span></div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;    <span class="keywordflow">for</span> (PetscInt k = zs; k &lt;= ze; ++k) {</div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;        PetscInt k_loc = k - zs;</div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;        <span class="keywordflow">for</span> (PetscInt j = ys; j &lt; ye; ++j) {</div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;            PetscInt j_loc = j - ys;</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;            <span class="keywordflow">for</span> (PetscInt i = xs; i &lt; xe; ++i) {</div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;                PetscInt i_loc = i - xs;</div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;                <span class="comment">// Average the four corners of the X-Y face at Z = k</span></div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;                PetscReal sum = corner_arr[k][j  ][i  ]</div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160;                              + corner_arr[k][j  ][i+1]</div>
<div class="line"><a name="l02286"></a><span class="lineno"> 2286</span>&#160;                              + corner_arr[k][j+1][i  ]</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;                              + corner_arr[k][j+1][i+1];</div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;                faceZ_arr[k_loc][j_loc][i_loc] = sum * 0.25;</div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;            }</div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;        }</div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;    }</div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160; </div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;    <a class="code" href="logging_8h.html#a5fe7257f46131945aacf9a35e9de5874">PROFILE_FUNCTION_END</a>;</div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160; </div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;    PetscFunctionReturn(0);</div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="interpolation_8c_ac3e3d9d03447563e1062d257af6046d2_cgraph.svg" width="438" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
<a id="a173e2e54a5c09762ab6868eb78889886"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a173e2e54a5c09762ab6868eb78889886">&#9670;&nbsp;</a></span>InterpolateCornerToFaceCenter_Vector()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">PetscErrorCode InterpolateCornerToFaceCenter_Vector </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structCmpnts">Cmpnts</a> ***&#160;</td>
          <td class="paramname"><em>corner_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structCmpnts">Cmpnts</a> ***&#160;</td>
          <td class="paramname"><em>faceX_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structCmpnts">Cmpnts</a> ***&#160;</td>
          <td class="paramname"><em>faceY_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structCmpnts">Cmpnts</a> ***&#160;</td>
          <td class="paramname"><em>faceZ_arr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="variables_8h.html#structUserCtx">UserCtx</a> *&#160;</td>
          <td class="paramname"><em>user</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Interpolates a vector field from corner nodes to all face centers. </p>
<p>Identical to the scalar version, except it averages each component of the <a class="el" href="variables_8h.html#structCmpnts" title="A 3D point or vector with PetscScalar components.">Cmpnts</a> struct at the four corner-nodes per face.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">corner_arr</td><td>Ghosted 3-component array (global node indices). </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">faceX_arr</td><td>Local array of <a class="el" href="variables_8h.html#structCmpnts" title="A 3D point or vector with PetscScalar components.">Cmpnts</a> for X-faces sized [zm][ym][xm+1]. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">faceY_arr</td><td>Local array of <a class="el" href="variables_8h.html#structCmpnts" title="A 3D point or vector with PetscScalar components.">Cmpnts</a> for Y-faces sized [zm][ym+1][xm]. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">faceZ_arr</td><td>Local array of <a class="el" href="variables_8h.html#structCmpnts" title="A 3D point or vector with PetscScalar components.">Cmpnts</a> for Z-faces sized [zm+1][ym][xm]. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">user</td><td>User context containing DMDA 'fda'.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>PetscErrorCode 0 on success. </dd></dl>

<p class="definition">Definition at line <a class="el" href="interpolation_8c_source.html#l02315">2315</a> of file <a class="el" href="interpolation_8c_source.html">interpolation.c</a>.</p>
<div class="fragment"><div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160;{</div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;    PetscErrorCode ierr;</div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;    DMDALocalInfo info;</div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;    PetscMPIInt rank;</div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160; </div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;    PetscFunctionBeginUser;</div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160; </div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;    <a class="code" href="logging_8h.html#ace99f3e207ccb2e46e9b782f9e57732e">PROFILE_FUNCTION_BEGIN</a>;</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160; </div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;    ierr = MPI_Comm_rank(PETSC_COMM_WORLD, &amp;rank); CHKERRQ(ierr);</div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;    <a class="code" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,</div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;                   <span class="stringliteral">&quot;Rank %d starting InterpolateFieldFromCornerToFaceCenter_Vector.\n&quot;</span>, rank);</div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;    </div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;    ierr = DMDAGetLocalInfo(user-&gt;<a class="code" href="variables_8h.html#a69966d928601d61d4f526636f84396c5">fda</a>, &amp;info); CHKERRQ(ierr);</div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160; </div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;    PetscInt xs, xm, ys, ym, zs, zm;</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;    ierr = <a class="code" href="setup_8h.html#a9b17552f79ebe16d0363986217a01ff3">GetOwnedCellRange</a>(&amp;info, 0, &amp;xs, &amp;xm); CHKERRQ(ierr);</div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;    ierr = <a class="code" href="setup_8h.html#a9b17552f79ebe16d0363986217a01ff3">GetOwnedCellRange</a>(&amp;info, 1, &amp;ys, &amp;ym); CHKERRQ(ierr);</div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;    ierr = <a class="code" href="setup_8h.html#a9b17552f79ebe16d0363986217a01ff3">GetOwnedCellRange</a>(&amp;info, 2, &amp;zs, &amp;zm); CHKERRQ(ierr);</div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160; </div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160;    PetscInt xe = xs + xm;</div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;    PetscInt ye = ys + ym;</div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;    PetscInt ze = zs + zm;</div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160; </div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160;    <span class="comment">// X-faces</span></div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;    <span class="keywordflow">for</span> (PetscInt k = zs; k &lt; ze; ++k) {</div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;        PetscInt k_loc = k - zs;</div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;        <span class="keywordflow">for</span> (PetscInt j = ys; j &lt; ye; ++j) {</div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;            PetscInt j_loc = j - ys;</div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;            <span class="keywordflow">for</span> (PetscInt i = xs; i &lt;= xe; ++i) {</div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;                PetscInt i_loc = i - xs;</div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;                <a class="code" href="variables_8h.html#structCmpnts">Cmpnts</a> sum = {0,0,0};</div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;                sum.<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = corner_arr[k  ][j  ][i].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + corner_arr[k+1][j  ][i].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a></div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;                      + corner_arr[k  ][j+1][i].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + corner_arr[k+1][j+1][i].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;                sum.<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = corner_arr[k  ][j  ][i].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + corner_arr[k+1][j  ][i].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a></div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;                      + corner_arr[k  ][j+1][i].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + corner_arr[k+1][j+1][i].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;                sum.<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = corner_arr[k  ][j  ][i].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + corner_arr[k+1][j  ][i].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a></div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;                      + corner_arr[k  ][j+1][i].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + corner_arr[k+1][j+1][i].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;                faceX_arr[k_loc][j_loc][i_loc].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = sum.<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> * 0.25;</div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;                faceX_arr[k_loc][j_loc][i_loc].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = sum.<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> * 0.25;</div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;                faceX_arr[k_loc][j_loc][i_loc].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = sum.<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> * 0.25;</div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;            }</div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;        }</div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;    }</div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160; </div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;    <a class="code" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,</div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;                   <span class="stringliteral">&quot;Rank %d x-face Interpolation complete.\n&quot;</span>, rank);</div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;    </div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;    <span class="comment">// Y-faces</span></div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160;    <span class="keywordflow">for</span> (PetscInt k = zs; k &lt; ze; ++k) {</div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;        PetscInt k_loc = k - zs;</div>
<div class="line"><a name="l02372"></a><span class="lineno"> 2372</span>&#160;        <span class="keywordflow">for</span> (PetscInt j = ys; j &lt;= ye; ++j) {</div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;            PetscInt j_loc = j - ys;</div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;            <span class="keywordflow">for</span> (PetscInt i = xs; i &lt; xe; ++i) {</div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;                PetscInt i_loc = i - xs;</div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;                <a class="code" href="variables_8h.html#structCmpnts">Cmpnts</a> sum = {0,0,0};</div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;                sum.<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = corner_arr[k  ][j][i  ].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + corner_arr[k+1][j][i  ].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a></div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;                      + corner_arr[k  ][j][i+1].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + corner_arr[k+1][j][i+1].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160;                sum.<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = corner_arr[k  ][j][i  ].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + corner_arr[k+1][j][i  ].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a></div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;                      + corner_arr[k  ][j][i+1].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + corner_arr[k+1][j][i+1].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;                sum.<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = corner_arr[k  ][j][i  ].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + corner_arr[k+1][j][i  ].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a></div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;                      + corner_arr[k  ][j][i+1].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + corner_arr[k+1][j][i+1].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;                faceY_arr[k_loc][j_loc][i_loc].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = sum.<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> * 0.25;</div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;                faceY_arr[k_loc][j_loc][i_loc].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = sum.<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> * 0.25;</div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;                faceY_arr[k_loc][j_loc][i_loc].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = sum.<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> * 0.25;</div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;            }</div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;        }</div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;    }</div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160; </div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;    <a class="code" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,</div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;                   <span class="stringliteral">&quot;Rank %d y-face Interpolation complete.\n&quot;</span>, rank);</div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;    </div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;    <span class="comment">// Z-faces</span></div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;    <span class="keywordflow">for</span> (PetscInt k = zs; k &lt;= ze; ++k) {</div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;        PetscInt k_loc = k - zs;</div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;        <span class="keywordflow">for</span> (PetscInt j = ys; j &lt; ye; ++j) {</div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;            PetscInt j_loc = j - ys;</div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;            <span class="keywordflow">for</span> (PetscInt i = xs; i &lt; xe; ++i) {</div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;                PetscInt i_loc = i - xs;</div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;                <a class="code" href="variables_8h.html#structCmpnts">Cmpnts</a> sum = {0,0,0};</div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;                sum.<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = corner_arr[k][j  ][i  ].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + corner_arr[k][j  ][i+1].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a></div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;                      + corner_arr[k][j+1][i  ].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> + corner_arr[k][j+1][i+1].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a>;</div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;                sum.<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = corner_arr[k][j  ][i  ].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + corner_arr[k][j  ][i+1].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a></div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;                      + corner_arr[k][j+1][i  ].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> + corner_arr[k][j+1][i+1].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a>;</div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;                sum.<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = corner_arr[k][j  ][i  ].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + corner_arr[k][j  ][i+1].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a></div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;                      + corner_arr[k][j+1][i  ].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> + corner_arr[k][j+1][i+1].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a>;</div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;                faceZ_arr[k_loc][j_loc][i_loc].<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> = sum.<a class="code" href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">x</a> * 0.25;</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;                faceZ_arr[k_loc][j_loc][i_loc].<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> = sum.<a class="code" href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">y</a> * 0.25;</div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;                faceZ_arr[k_loc][j_loc][i_loc].<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> = sum.<a class="code" href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">z</a> * 0.25;</div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;            }</div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;        }</div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;    }</div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160; </div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;    <a class="code" href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a>(<a class="code" href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a>, <a class="code" href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a>,</div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;                   <span class="stringliteral">&quot;Rank %d z-face Interpolation complete.\n&quot;</span>, rank);</div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;    </div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160;    <a class="code" href="logging_8h.html#a5fe7257f46131945aacf9a35e9de5874">PROFILE_FUNCTION_END</a>;</div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;    PetscFunctionReturn(0);</div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;}</div>
</div><!-- fragment --><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><iframe scrolling="no" frameborder="0" src="interpolation_8c_a173e2e54a5c09762ab6868eb78889886_cgraph.svg" width="438" height="52"><p><b>This browser is not able to show SVG: try Firefox, Chrome, Safari, or Opera instead.</b></p></iframe></div>
</div>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div class="ttc" id="avariables_8h_html_ad032e456f7f4b32b9ac0d94be05de204"><div class="ttname"><a href="variables_8h.html#ad032e456f7f4b32b9ac0d94be05de204">Cmpnts::y</a></div><div class="ttdeci">PetscScalar y</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00101">variables.h:101</a></div></div>
<div class="ttc" id="alogging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9ab9f002c6ffbfd511da8090213227454e">LOG_DEBUG</a></div><div class="ttdeci">@ LOG_DEBUG</div><div class="ttdoc">Detailed debugging information.</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00033">logging.h:33</a></div></div>
<div class="ttc" id="avariables_8h_html_a718a09fbedf450248eaf7019a980e139"><div class="ttname"><a href="variables_8h.html#a718a09fbedf450248eaf7019a980e139">Cmpnts::x</a></div><div class="ttdeci">PetscScalar x</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00101">variables.h:101</a></div></div>
<div class="ttc" id="alogging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9a8f6fe15bfe15104da6d1b360194a5400"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a8f6fe15bfe15104da6d1b360194a5400">LOG_WARNING</a></div><div class="ttdeci">@ LOG_WARNING</div><div class="ttdoc">Non-critical issues that warrant attention.</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00030">logging.h:30</a></div></div>
<div class="ttc" id="alogging_8h_html_a2ebe7667b52c478f7ff365f296d4c8ae"><div class="ttname"><a href="logging_8h.html#a2ebe7667b52c478f7ff365f296d4c8ae">LOG_ALLOW_SYNC</a></div><div class="ttdeci">#define LOG_ALLOW_SYNC(scope, level, fmt,...)</div><div class="ttdoc">---- DEBUG --------------------------------------- #define LOG_ALLOW(scope, level,...</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00266">logging.h:266</a></div></div>
<div class="ttc" id="avariables_8h_html_ace2eeedc863d73caaf51bb83aa993e44"><div class="ttname"><a href="variables_8h.html#ace2eeedc863d73caaf51bb83aa993e44">UserCtx::lUcat</a></div><div class="ttdeci">Vec lUcat</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00684">variables.h:684</a></div></div>
<div class="ttc" id="alogging_8h_html_a3758dd5d300a594312c95bc393378df0"><div class="ttname"><a href="logging_8h.html#a3758dd5d300a594312c95bc393378df0">LOCAL</a></div><div class="ttdeci">#define LOCAL</div><div class="ttdoc">Logging scope definitions for controlling message output.</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00044">logging.h:44</a></div></div>
<div class="ttc" id="avariables_8h_html_ad1904cdee33ebeffba809c883f7e9641"><div class="ttname"><a href="variables_8h.html#ad1904cdee33ebeffba809c883f7e9641">UserCtx::IM</a></div><div class="ttdeci">PetscInt IM</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00666">variables.h:666</a></div></div>
<div class="ttc" id="ainterpolation_8c_html_abb885423e57747be4eb786faf6bb032d"><div class="ttname"><a href="interpolation_8c.html#abb885423e57747be4eb786faf6bb032d">ComputeTrilinearWeights</a></div><div class="ttdeci">static void ComputeTrilinearWeights(PetscReal a1, PetscReal a2, PetscReal a3, PetscReal *w)</div><div class="ttdoc">Computes the trilinear Interpolatetion weights from the Interpolatetion coefficients.</div><div class="ttdef"><b>Definition:</b> <a href="interpolation_8c_source.html#l00894">interpolation.c:894</a></div></div>
<div class="ttc" id="alogging_8h_html_a5fe7257f46131945aacf9a35e9de5874"><div class="ttname"><a href="logging_8h.html#a5fe7257f46131945aacf9a35e9de5874">PROFILE_FUNCTION_END</a></div><div class="ttdeci">#define PROFILE_FUNCTION_END</div><div class="ttdoc">Marks the end of a profiled code block.</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00731">logging.h:731</a></div></div>
<div class="ttc" id="alogging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a230506cce5c68c3bac5a821c42ed3473">LOG_ERROR</a></div><div class="ttdeci">@ LOG_ERROR</div><div class="ttdoc">Critical errors that may halt the program.</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00029">logging.h:29</a></div></div>
<div class="ttc" id="ainterpolation_8c_html_ad200d31b74c511e4388b757fb0359001"><div class="ttname"><a href="interpolation_8c.html#ad200d31b74c511e4388b757fb0359001">InterpolateEulerFieldToSwarm</a></div><div class="ttdeci">PetscErrorCode InterpolateEulerFieldToSwarm(UserCtx *user, Vec fieldLocal_cellCentered, const char *fieldName, const char *swarmOutFieldName)</div><div class="ttdoc">Interpolates a cell-centered field (scalar or vector) onto DMSwarm particles, using a robust,...</div><div class="ttdef"><b>Definition:</b> <a href="interpolation_8c_source.html#l01273">interpolation.c:1273</a></div></div>
<div class="ttc" id="alogging_8h_html_a2358badbcda33fc9d80ebd6a59d2a2cd"><div class="ttname"><a href="logging_8h.html#a2358badbcda33fc9d80ebd6a59d2a2cd">is_function_allowed</a></div><div class="ttdeci">PetscBool is_function_allowed(const char *functionName)</div><div class="ttdoc">Checks if a given function is in the allow-list.</div><div class="ttdef"><b>Definition:</b> <a href="logging_8c_source.html#l00149">logging.c:149</a></div></div>
<div class="ttc" id="alogging_8h_html_aa987297fa072943c2409f3b2cc4e31f9"><div class="ttname"><a href="logging_8h.html#aa987297fa072943c2409f3b2cc4e31f9">LOG_LOOP_ALLOW_EXACT</a></div><div class="ttdeci">#define LOG_LOOP_ALLOW_EXACT(scope, level, var, val, fmt,...)</div><div class="ttdoc">Logs a custom message if a variable equals a specific value.</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00347">logging.h:347</a></div></div>
<div class="ttc" id="ainterpolation_8h_html_a028d693bd5e99242092b027c7e46f3a4"><div class="ttname"><a href="interpolation_8h.html#a028d693bd5e99242092b027c7e46f3a4">TrilinearInterpolation</a></div><div class="ttdeci">#define TrilinearInterpolation(fieldName, fieldPtr, i, j, k, a1, a2, a3, outPtr)</div><div class="ttdoc">Macro that calls either the scalar or vector trilinear interpolation function based on the type of th...</div><div class="ttdef"><b>Definition:</b> <a href="interpolation_8h_source.html#l00130">interpolation.h:130</a></div></div>
<div class="ttc" id="asetup_8h_html_a9b17552f79ebe16d0363986217a01ff3"><div class="ttname"><a href="setup_8h.html#a9b17552f79ebe16d0363986217a01ff3">GetOwnedCellRange</a></div><div class="ttdeci">PetscErrorCode GetOwnedCellRange(const DMDALocalInfo *info_nodes, PetscInt dim, PetscInt *xs_cell_global, PetscInt *xm_cell_local)</div><div class="ttdoc">Determines the global starting index and number of CELLS owned by the current processor in a specifie...</div><div class="ttdef"><b>Definition:</b> <a href="setup_8c_source.html#l01409">setup.c:1409</a></div></div>
<div class="ttc" id="alogging_8h_html_a3de33738fd3c7e77bffbcfaefc3e7645"><div class="ttname"><a href="logging_8h.html#a3de33738fd3c7e77bffbcfaefc3e7645">GLOBAL</a></div><div class="ttdeci">#define GLOBAL</div><div class="ttdoc">Scope for global logging across all processes.</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00045">logging.h:45</a></div></div>
<div class="ttc" id="avariables_8h_html_structCmpnts"><div class="ttname"><a href="variables_8h.html#structCmpnts">Cmpnts</a></div><div class="ttdoc">A 3D point or vector with PetscScalar components.</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00100">variables.h:100</a></div></div>
<div class="ttc" id="avariables_8h_html_aa55a2a246e904b3569075eb4de0092a6"><div class="ttname"><a href="variables_8h.html#aa55a2a246e904b3569075eb4de0092a6">UserCtx::JM</a></div><div class="ttdeci">PetscInt JM</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00666">variables.h:666</a></div></div>
<div class="ttc" id="alogging_8h_html_a9585f583c260f40a73f2490914edc689"><div class="ttname"><a href="logging_8h.html#a9585f583c260f40a73f2490914edc689">get_log_level</a></div><div class="ttdeci">LogLevel get_log_level()</div><div class="ttdoc">Retrieves the current logging level from the environment variable LOG_LEVEL.</div><div class="ttdef"><b>Definition:</b> <a href="logging_8c_source.html#l00039">logging.c:39</a></div></div>
<div class="ttc" id="ainterpolation_8c_html_a556572fc2b40494da8bdb48d977dbaa1"><div class="ttname"><a href="interpolation_8c.html#a556572fc2b40494da8bdb48d977dbaa1">InterpolateEulerFieldToSwarmForParticle</a></div><div class="ttdeci">static PetscErrorCode InterpolateEulerFieldToSwarmForParticle(const char *fieldName, void *fieldPtr, PetscInt iCell, PetscInt jCell, PetscInt kCell, PetscReal a1, PetscReal a2, PetscReal a3, void *swarmOut, PetscInt p, PetscInt blockSize)</div><div class="ttdoc">Interpolates a single field (scalar or vector) for one particle, storing the result in a swarm array.</div><div class="ttdef"><b>Definition:</b> <a href="interpolation_8c_source.html#l01137">interpolation.c:1137</a></div></div>
<div class="ttc" id="avariables_8h_html_abe7f60605e135192ee23df40cf5d7766"><div class="ttname"><a href="variables_8h.html#abe7f60605e135192ee23df40cf5d7766">Cmpnts</a></div><div class="ttdeci">struct Cmpnts Cmpnts</div><div class="ttdoc">A 3D point or vector with PetscScalar components.</div></div>
<div class="ttc" id="avariables_8h_html_a3f5ec0e4536c9ccaa3d663f14d47f904"><div class="ttname"><a href="variables_8h.html#a3f5ec0e4536c9ccaa3d663f14d47f904">UserCtx::KM</a></div><div class="ttdeci">PetscInt KM</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00666">variables.h:666</a></div></div>
<div class="ttc" id="ainterpolation_8h_html_a60d783e6b448175916bd9125648ba8af"><div class="ttname"><a href="interpolation_8h.html#a60d783e6b448175916bd9125648ba8af">InterpolateFieldFromCenterToCorner</a></div><div class="ttdeci">#define InterpolateFieldFromCenterToCorner(blockSize, centfield_ptr, corner_ptr, user_ctx)</div><div class="ttdoc">Macro to dispatch to the correct scalar or vector center-to-corner function based on a runtime block ...</div><div class="ttdef"><b>Definition:</b> <a href="interpolation_8h_source.html#l00064">interpolation.h:64</a></div></div>
<div class="ttc" id="avariables_8h_html_a69966d928601d61d4f526636f84396c5"><div class="ttname"><a href="variables_8h.html#a69966d928601d61d4f526636f84396c5">UserCtx::fda</a></div><div class="ttdeci">DM fda</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00663">variables.h:663</a></div></div>
<div class="ttc" id="alogging_8h_html_a4a671b0e347e0a22b0df806f246d5d11"><div class="ttname"><a href="logging_8h.html#a4a671b0e347e0a22b0df806f246d5d11">LOG_ALLOW</a></div><div class="ttdeci">#define LOG_ALLOW(scope, level, fmt,...)</div><div class="ttdoc">Logging macro that checks both the log level and whether the calling function is in the allowed-funct...</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00199">logging.h:199</a></div></div>
<div class="ttc" id="avariables_8h_html_a9f0c002a2c7cde3b6ac843ab9185f4d4"><div class="ttname"><a href="variables_8h.html#a9f0c002a2c7cde3b6ac843ab9185f4d4">Cmpnts::z</a></div><div class="ttdeci">PetscScalar z</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00101">variables.h:101</a></div></div>
<div class="ttc" id="alogging_8h_html_aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837"><div class="ttname"><a href="logging_8h.html#aca1fd1d8935433e6ba2e3918214e07f9a6e98ff471e3ce6c4ef2d75c37ee51837">LOG_INFO</a></div><div class="ttdeci">@ LOG_INFO</div><div class="ttdoc">Informational messages about program execution.</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00032">logging.h:32</a></div></div>
<div class="ttc" id="avariables_8h_html_a1675749ea3b2429f00405a1ee3203d18"><div class="ttname"><a href="variables_8h.html#a1675749ea3b2429f00405a1ee3203d18">UserCtx::swarm</a></div><div class="ttdeci">DM swarm</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00722">variables.h:722</a></div></div>
<div class="ttc" id="alogging_8h_html_ace99f3e207ccb2e46e9b782f9e57732e"><div class="ttname"><a href="logging_8h.html#ace99f3e207ccb2e46e9b782f9e57732e">PROFILE_FUNCTION_BEGIN</a></div><div class="ttdeci">#define PROFILE_FUNCTION_BEGIN</div><div class="ttdoc">Marks the beginning of a profiled code block (typically a function).</div><div class="ttdef"><b>Definition:</b> <a href="logging_8h_source.html#l00722">logging.h:722</a></div></div>
<div class="ttc" id="avariables_8h_html_af031acb43b014d5ac788aa9003491e75"><div class="ttname"><a href="variables_8h.html#af031acb43b014d5ac788aa9003491e75">UserCtx::da</a></div><div class="ttdeci">DM da</div><div class="ttdef"><b>Definition:</b> <a href="variables_8h_source.html#l00663">variables.h:663</a></div></div>
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a class="el" href="interpolation_8c.html">interpolation.c</a></li>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.17 </li>
  </ul>
</div>
</body>
</html>
